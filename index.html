<!DOCTYPE HTML>
<html>
<head >
  <meta charset="utf-8">
  
  <title>zeven&#39;s blog</title>

  
  <meta name="author" content="zeven0707&#39;s blog">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="zeven&#39;s blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  
  
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5005349780815724",
    enable_page_level_ads: true
  });
</script>

  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?223eea22355699157e147870eb124b24";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <link rel="manifest" href="/manifest.json">
  <link href="/favicon.ico" rel="icon">

  <link rel="alternate" href="/atom.xml" title="zeven&#39;s blog" type="application/atom+xml">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">


</head>


<body>
<div class="blog">
  <div class="content">

    

    <header class="header-container" style="background-image: url('/images/blog-bg.jpg');">


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header page-scroll">
          <button type="button" id="tglBtn" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">zeven0707&#39;s blog</a>
        </div>
        <div id="bosenyblog-navbar">
          <div class="navbar-collapse" id="bs-example-navbar-collapse-6">
            <ul class="nav navbar-nav navbar-right">
            
              <li><a href="/">主页</a></li>
            
              <li><a href="/archives">日志</a></li>
            
              <li><a href="/about">关于</a></li>
            
              <li><a href="/tags">标签</a></li>
            
            </ul>
          </div>
        </div>

    </div>
 </nav>
 <div class="gotop-btn">

 </div>
</header>

        
        <div class="container ">
          <div class="row">
            <main class="site-main posts-loop    col-lg-8 col-lg-offset-1
                    col-md-8 col-md-offset-1
                    col-sm-12
                    col-xs-12">
            
  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2020/07/12/confluence部署配置/"><span>[linux] confluence部署配置</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/07/12/confluence部署配置/" rel="bookmark">
        <time class="entry-date published" datetime="2020-07-11T16:15:00.000Z">
          2020-07-12
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h1 id="1、-下载、解压安装包"><a href="#1、-下载、解压安装包" class="headerlink" title="1、 下载、解压安装包"></a>1、 下载、解压安装包</h1><p><code>wget https://product-downloads.atlassian.com/software/confluence/downloads/atlassian-confluence-7.0.2.tar.gz</code><br><code>tar -zxvf atlassian-confluence-7.0.2.tar.gz</code></p>
<h1 id="2、进入解压完之后的路径，修改配置文件"><a href="#2、进入解压完之后的路径，修改配置文件" class="headerlink" title="2、进入解压完之后的路径，修改配置文件"></a>2、进入解压完之后的路径，修改配置文件</h1><p><code>cd /data/soft/atlassian-confluence-7.0.2</code><br>修改配置文件设置confluence启动的家目录<br>vim /data/soft/atlassian-confluence-7.0.2/confluence/WEB-INF/classes/confluence-init.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">由</span><br><span class="line"># confluence.home&#x3D;c:&#x2F;confluence&#x2F;data</span><br><span class="line">修改为</span><br><span class="line">confluence.home&#x3D;&#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2</span><br></pre></td></tr></table></figure>
<p>修改端口，默认端口为8090<br>vim /data/soft/atlassian-confluence-7.0.2/conf/server.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;Server port&#x3D;&quot;8000&quot; shutdown&#x3D;&quot;SHUTDOWN&quot; debug&#x3D;&quot;0&quot;&gt;</span><br><span class="line">    &lt;Service name&#x3D;&quot;Tomcat-Standalone&quot;&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">         &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">         DEFAULT - Direct connector with no proxy, for unproxied HTTP access to Confluence.</span><br><span class="line"></span><br><span class="line">         If using a http&#x2F;https proxy, comment out this connector.</span><br><span class="line">         &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;Connector port&#x3D;&quot;8090&quot; connectionTimeout&#x3D;&quot;20000&quot; redirectPort&#x3D;&quot;8443&quot;</span><br><span class="line">                   maxThreads&#x3D;&quot;48&quot; minSpareThreads&#x3D;&quot;10&quot;</span><br><span class="line">                   enableLookups&#x3D;&quot;false&quot; acceptCount&#x3D;&quot;10&quot; debug&#x3D;&quot;0&quot; URIEncoding&#x3D;&quot;UTF-8&quot;</span><br><span class="line">                   protocol&#x3D;&quot;org.apache.coyote.http11.Http11NioProtocol&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--</span><br></pre></td></tr></table></figure>
<p>server端口修改为5000，连接端口修改为5050</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Server port&#x3D;&quot;5000&quot; shutdown&#x3D;&quot;SHUTDOWN&quot; debug&#x3D;&quot;0&quot;&gt;</span><br><span class="line">  &lt;Service name&#x3D;&quot;Tomcat-Standalone&quot;&gt;</span><br><span class="line">    &lt;Connector port&#x3D;&quot;5050&quot; connectionTimeout&#x3D;&quot;20000&quot; redirectPort&#x3D;&quot;8443&quot;</span><br><span class="line">        maxThreads&#x3D;&quot;48&quot; minSpareThreads&#x3D;&quot;10&quot;</span><br><span class="line">        enableLookups&#x3D;&quot;false&quot; acceptCount&#x3D;&quot;10&quot; debug&#x3D;&quot;0&quot; URIEncoding&#x3D;&quot;UTF-8&quot;</span><br><span class="line">        protocol&#x3D;&quot;org.apache.coyote.http11.Http11NioProtocol&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h1 id="3、启动confluence"><a href="#3、启动confluence" class="headerlink" title="3、启动confluence"></a>3、启动confluence</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master atlassian-confluence-7.0.2]# .&#x2F;bin&#x2F;start-confluence.sh</span><br><span class="line">To run Confluence in the foreground, start the server with start-confluence.sh -fg</span><br><span class="line">executing as current user</span><br><span class="line">If you encounter issues starting up Confluence, please see the Installation guide at http:&#x2F;&#x2F;confluence.atlassian.com&#x2F;display&#x2F;DOC&#x2F;Confluence+Installation+Guide</span><br><span class="line"></span><br><span class="line">Server startup logs are located in &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2&#x2F;logs&#x2F;catalina.out</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">Using Java: &#x2F;data&#x2F;soft&#x2F;jdk1.8.0_201&#x2F;jre&#x2F;bin&#x2F;java</span><br><span class="line">2019-10-08 16:46:05,152 INFO [main] [atlassian.confluence.bootstrap.SynchronyProxyWatchdog] A Context element for $&#123;confluence.context.path&#125;&#x2F;synchrony-proxy is found in &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2&#x2F;conf&#x2F;server.xml. No further action is required</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">Using CATALINA_BASE:   &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2</span><br><span class="line">Using CATALINA_HOME:   &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2</span><br><span class="line">Using CATALINA_TMPDIR: &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2&#x2F;temp</span><br><span class="line">Using JRE_HOME:        &#x2F;data&#x2F;soft&#x2F;jdk1.8.0_201&#x2F;jre</span><br><span class="line">Using CLASSPATH:       &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2&#x2F;bin&#x2F;bootstrap.jar:&#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2&#x2F;bin&#x2F;tomcat-juli.jar</span><br><span class="line">Using CATALINA_PID:    &#x2F;data&#x2F;soft&#x2F;atlassian-confluence-7.0.2&#x2F;work&#x2F;catalina.pid</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure>

<h1 id="4、破解confluence"><a href="#4、破解confluence" class="headerlink" title="4、破解confluence"></a>4、破解confluence</h1><p>上传atlassina-agent.jar破解包，下载链接<br>链接: <a href="https://pan.baidu.com/s/1XslwW8cdGRxVpnt3qigztQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1XslwW8cdGRxVpnt3qigztQ</a> 提取码: utp7</p>
<p>修改环境变量<br>vim conf/setenv.sh<br>`CATALINA_OPTS=”-javaagent:/data/soft/atlassian-agent.jar ${CATALINA_OPTS}”``<br>重新启动confluence</p>
<h1 id="5、开始配置confluence"><a href="#5、开始配置confluence" class="headerlink" title="5、开始配置confluence"></a>5、开始配置confluence</h1><p>选择中文语言，选择产品安装<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/1.png" alt="img1"><br>点击下一步，如果勾选下面的选项，需要额外的破解步骤<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/2.png" alt="img2"><br>拷贝服务器ID，使用破解包，生成授权码<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/3.png" alt="img3"></p>
<p>在服务器端，执行下面步骤<br><code>java -jar /data/soft/atlassian-agent.jar -p conf -m zhangyuliang@new4g.cn -n zeven -o https://zeven0707.github.io -s BVQD-QO0A-IHZE-LJDV</code><br>命令行参数如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-p conf(安装的是confluence产品)</span><br><span class="line">-m aaa@bbb.com(随意写)</span><br><span class="line">-n my_name(随意写)</span><br><span class="line">-o https:&#x2F;&#x2F;zhile.io (随意写</span><br><span class="line">-s B3N1-KDPW-IYEI-14CE (即当前的页面中显示的服务器ID)</span><br></pre></td></tr></table></figure>
<p>生成下面的授权码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master soft]# java -jar &#x2F;data&#x2F;soft&#x2F;atlassian-agent.jar -p conf -m zhangyuliang@new4g.cn -n zeven -o https:&#x2F;&#x2F;zeven0707.github.io -s BVQD-QO0A-IHZE-LJDV</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;        Atlassian Crack Agent         &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;           https:&#x2F;&#x2F;zhile.io           &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;          QQ Group: 30347511          &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Your license code(Don&#39;t copy this line!!!):</span><br><span class="line">AAABSA0ODAoPeJxtUFFrgzAYfM+vCOw5Nto520JgnQpz2LrOtg97S91XDdgoSXRzv35W3R5GIRByl</span><br><span class="line">zvu7m7fAE4yg+kC296Kuit3jv10jx1qL5GvgBtRyYAbYFeE2JTQBQpbXjYDw8681IAC0JkS9YAcZ</span><br><span class="line">CkuwsAHLkUGUgM+dbgwptar2ey7ECVYokKJyrkUejT5Y6EFST3qWbkwRXO6fswqebZ4ZkQLzKgGk</span><br><span class="line">F9J07&#x2F;DDRcl+y64zLumFP31KOHzPrcyOWpSw5UBNSUcoHgMtO9q2PILMD&#x2F;ZbMI3P1rHqHeTBiSXG</span><br><span class="line">YRftVDd1HmxJNTrD5q0UcDiKEjDLYlt16Ou47ru&#x2F;MFZohRUC6qnn467gOwSuibR83tI4pfg+Cu+7</span><br><span class="line">fzaqKzgGv6vPM13BKWvIzljh21zOYFKzgfd44zYqM&#x2F;CbuSZZhp6Drv+ABXDoAYwLAIUeI9iDGYa7</span><br><span class="line">BtHTuFqLI3Wftm0uSsCFEpRGmgeBy1pr+YzJPwhxwfYiqVGX02g8</span><br></pre></td></tr></table></figure>
<p>拷贝授权码到下面空白框<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/4.png" alt="img4"><br>下面配置自己的数据库<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/5.png" alt="img5"></p>
<p>先上传数据库连接工具mysql-connector-java-5.1.42-bin.jar，可以通过官网下载<br>链接: <a href="https://pan.baidu.com/s/1qzhLzqO5mdSyQPoqFPT6KQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1qzhLzqO5mdSyQPoqFPT6KQ</a> 提取码: j5zq<br>配置数据库连接<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/7.png" alt="img6"></p>
<p>根据提示将连接包放到指定的目录<br>cp -rp mysql-connector-java-5.1.42-bin.jar  /data/soft/atlassian-confluence-7.0.2/confluence/WEB-INF/lib/<br>重新启动confluence<br>再次刷新页面，页面如下所示<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/7.png" alt="img7"></p>
<p>创建一个新的数据库字符集必须为utf8、排序规则为utf8_bin,数据库隔离级别为read-commit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set global transaction_isolation&#x3D;&#39;READ-COMMITTED&#39;;</span><br><span class="line">create database confluence default character set utf8 collate utf8_bin;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/8.png" alt="img8"><br>配置成功之后，点击示范站点<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/9.png" alt="img9"><br>点击在confluence中管理用户和组<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/10.png" alt="img10"><br>配置管理员密码<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/11.png" alt="img11"><br>开始使用confluence<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/12.png" alt="img12"><br>查看是否正常破解，点击空间目录<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/13.png" alt="img13"><br>一般配置<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/14.png" alt="img14"><br>授权细节<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/15.png" alt="img15"><br>结果如下所示<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/16.png" alt="img16"></p>
<h1 id="6、衍生–配置博文开启匿名访问"><a href="#6、衍生–配置博文开启匿名访问" class="headerlink" title="6、衍生–配置博文开启匿名访问"></a>6、衍生–配置博文开启匿名访问</h1><p>点击一般配置<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/17.png" alt="img17"><br>全局权限<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/18.png" alt="img18"><br>编辑权限<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/19.png" alt="img19"><br>启用匿名用户可以反问confluence<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/20.png" alt="img20"><br>修改需要对外提供访问的空间（例如nginx）,点击空间管理-权限<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/21.png" alt="img21"><br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/22.png" alt="img22"><br>授予匿名用户查看权限<br><img src="https://raw.githubusercontent.com/zeven0707/picture/master/%E7%9F%A5%E8%AF%86%E5%BA%93confluence/23.png" alt="img23"></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2020/07/12/confluence部署配置/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/nginx配置线程池（thread tool）/"><span>[linux] nginx配置线程池（thread tool）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/nginx配置线程池（thread tool）/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T15:32:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h1 id="1、nginx配置是需要添加–with-threads参数"><a href="#1、nginx配置是需要添加–with-threads参数" class="headerlink" title="1、nginx配置是需要添加–with-threads参数"></a>1、nginx配置是需要添加–with-threads参数</h1><p><code>./configure --with-threads</code></p>
<h1 id="2、在合适的上下文（http、server、location）配置-aio-threads"><a href="#2、在合适的上下文（http、server、location）配置-aio-threads" class="headerlink" title="2、在合适的上下文（http、server、location）配置 aio threads"></a>2、在合适的上下文（http、server、location）配置 aio threads</h1><p>in the ‘main’ context<br><code>thread_pool default threads=32 max_queue=65536;</code><br>in the ‘http’, ‘server’, or ‘location’ context<br><code>aio threads=default;</code><br>上面例子定义了一个名称为default的线程池，线程数为32个，最大任务队列为65536，如果任务队列超过负载，nginx会提示报错<br><code>thread pool &quot;NAME&quot; queue overflow: N tasks waiting</code></p>
<h1 id="3、可以配置多个独立的线程池用于不通的配置文件使用："><a href="#3、可以配置多个独立的线程池用于不通的配置文件使用：" class="headerlink" title="3、可以配置多个独立的线程池用于不通的配置文件使用："></a>3、可以配置多个独立的线程池用于不通的配置文件使用：</h1><p> in the ‘main’ context</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">thread_pool one threads&#x3D;128 max_queue&#x3D;0;</span><br><span class="line">thread_pool two threads&#x3D;32;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        location &#x2F;one &#123;</span><br><span class="line">            aio threads&#x3D;one;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location &#x2F;two &#123;</span><br><span class="line">            aio threads&#x3D;two;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    # ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不指定max_queue，默认值为65536，上面例子设置为0，这种情况线程池只能处理和线程池数相等的任务，没有任务等待。</p>
<h1 id="4、如果服务器有多块硬盘，可以使用分割用户-proxy-cache的方法提高性能"><a href="#4、如果服务器有多块硬盘，可以使用分割用户-proxy-cache的方法提高性能" class="headerlink" title="4、如果服务器有多块硬盘，可以使用分割用户+proxy_cache的方法提高性能"></a>4、如果服务器有多块硬盘，可以使用分割用户+proxy_cache的方法提高性能</h1><p>假设有三块挂载盘/mnt/disk1, /mnt/disk2, or /mnt/disk3<br>in the ‘main’ context</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">thread_pool pool_1 threads&#x3D;16;</span><br><span class="line">thread_pool pool_2 threads&#x3D;16;</span><br><span class="line">thread_pool pool_3 threads&#x3D;16;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    proxy_cache_path &#x2F;mnt&#x2F;disk1 levels&#x3D;1:2 keys_zone&#x3D;cache_1:256m max_size&#x3D;1024G</span><br><span class="line">                     use_temp_path&#x3D;off;</span><br><span class="line">    proxy_cache_path &#x2F;mnt&#x2F;disk2 levels&#x3D;1:2 keys_zone&#x3D;cache_2:256m max_size&#x3D;1024G</span><br><span class="line">                     use_temp_path&#x3D;off;</span><br><span class="line">    proxy_cache_path &#x2F;mnt&#x2F;disk3 levels&#x3D;1:2 keys_zone&#x3D;cache_3:256m max_size&#x3D;1024G</span><br><span class="line">                     use_temp_path&#x3D;off;</span><br><span class="line"></span><br><span class="line">    split_clients $request_uri $disk &#123;</span><br><span class="line">        33.3%     1;</span><br><span class="line">        33.3%     2;</span><br><span class="line">        *         3;</span><br><span class="line">    &#125;  </span><br><span class="line">    server &#123;</span><br><span class="line">        # ...</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;backend;</span><br><span class="line">            proxy_cache_key $request_uri;</span><br><span class="line">            proxy_cache cache_$disk;</span><br><span class="line">            aio threads&#x3D;pool_$disk;</span><br><span class="line">            sendfile on;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/nginx配置线程池（thread tool）/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/nginx默认设置文件大小上传限制报错client intended to send too lar/"><span>[linux] nginx默认设置文件大小上传限制报错client intended to send too large body</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/nginx默认设置文件大小上传限制报错client intended to send too lar/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T15:27:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[error] 15752#15752: *7501 client intended to send too large body: 1439319 bytes, client: 123.58.106.243, server: ebank.cbibank.com, request: &quot;POST &#x2F;innermanage&#x2F;cbRegUploadFile.do?EMP_SID&#x3D;GLFCEOHOJOFFCWDLAXHQJFAJHYDGDUAOCNBHAJCZ HTTP&#x2F;1.1&quot;, host: &quot;ebank.cbibank.com&quot;, referrer: &quot;https:&#x2F;&#x2F;ebank.cbibank.com&#x2F;innermanage&#x2F;cbRegAddDetailInf.do&quot;</span><br></pre></td></tr></table></figure>

<p>打开nginx.conf并在http{}字段里添加 client_max_body_size 64M;</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/nginx默认设置文件大小上传限制报错client intended to send too lar/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/nginx try_files参数含义/"><span>[linux] nginx try_files参数含义</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/nginx try_files参数含义/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T15:26:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p>为了解释它的含义举个栗子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;test &#123;</span><br><span class="line">  try_files $uri $uri&#x2F; &#x2F;index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用try_files的意思就是当用户去请求地址<a href="http://www.test.com/test的路径时，如果存在这个目录，那么就直接将内容发送给用户，如果不存在test这个目录，就将这个请求跳转到http://www.test.com/index.html" target="_blank" rel="noopener">http://www.test.com/test的路径时，如果存在这个目录，那么就直接将内容发送给用户，如果不存在test这个目录，就将这个请求跳转到http://www.test.com/index.html</a></p>
<p>如果指定的原始uri不存在，nginx做一个内部重定向，返回一个/www/data/images/default.gif</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    root &#x2F;www&#x2F;data;</span><br><span class="line">    location &#x2F;images&#x2F; &#123;</span><br><span class="line">        try_files $uri &#x2F;images&#x2F;default.gif;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以指定status code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">    try_files $uri $uri&#x2F; $uri.html &#x3D;404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以指定转到proxy server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">    try_files $uri $uri&#x2F; @backend;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location @backend &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;backend.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/nginx try_files参数含义/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/nginx配置alias注意事项/"><span>[linux]nginx配置alias注意事项</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/nginx配置alias注意事项/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T15:05:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h1 id="1、如果把alias配置在多层localtion下"><a href="#1、如果把alias配置在多层localtion下" class="headerlink" title="1、如果把alias配置在多层localtion下"></a>1、如果把alias配置在多层localtion下</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;inner &#123;</span><br><span class="line">                location ~  &#x2F;pub&#x2F;notice &#123;</span><br><span class="line">                        alias &#x2F;tmp&#x2F;bankuser&#x2F;pub&#x2F;notice&#x2F;;</span><br><span class="line">                        #autoindex on;</span><br><span class="line">                        #autoindex_exact_size off;</span><br><span class="line">                        #autoindex_localtime on;</span><br><span class="line">                &#125;</span><br><span class="line">                root &#x2F;data&#x2F;web;</span><br><span class="line">                index index.html;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-1、在-tmp-bankuser-pub-notice-目录下不能存在index-html文件，如果存在index-html文件会报错"><a href="#1-1、在-tmp-bankuser-pub-notice-目录下不能存在index-html文件，如果存在index-html文件会报错" class="headerlink" title="1.1、在/tmp/bankuser/pub/notice/目录下不能存在index.html文件，如果存在index.html文件会报错"></a>1.1、在/tmp/bankuser/pub/notice/目录下不能存在index.html文件，如果存在index.html文件会报错</h2><p><code>ERR_TOO_MANY_REDIRECTS</code></p>
<h2 id="1-2、如果不存在index-html文件，则会提示403错误"><a href="#1-2、如果不存在index-html文件，则会提示403错误" class="headerlink" title="1.2、如果不存在index.html文件，则会提示403错误"></a>1.2、如果不存在index.html文件，则会提示403错误</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">403 Forbidden</span><br><span class="line">openresty&#x2F;1.13.6.1</span><br></pre></td></tr></table></figure>

<p>日志会提示错误<br><code>directory index of &quot;/tmp/bankuser/pub/notice/&quot; is forbidden</code></p>
<h2 id="1-3、为了不出现上面的错误，需要开启autoindex，配置如下"><a href="#1-3、为了不出现上面的错误，需要开启autoindex，配置如下" class="headerlink" title="1.3、为了不出现上面的错误，需要开启autoindex，配置如下"></a>1.3、为了不出现上面的错误，需要开启autoindex，配置如下</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;inner &#123;</span><br><span class="line">                location ~  &#x2F;pub&#x2F;notice &#123;</span><br><span class="line">                        alias &#x2F;tmp&#x2F;bankuser&#x2F;pub&#x2F;notice&#x2F;;</span><br><span class="line">                        autoindex on;</span><br><span class="line">                        autoindex_exact_size off;</span><br><span class="line">                        autoindex_localtime on;</span><br><span class="line">                &#125;</span><br><span class="line">                root &#x2F;data&#x2F;web;</span><br><span class="line">                index index.html;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4、但是当启用autoindex之后，访问该目录下的路径会出现下面异常"><a href="#1-4、但是当启用autoindex之后，访问该目录下的路径会出现下面异常" class="headerlink" title="1.4、但是当启用autoindex之后，访问该目录下的路径会出现下面异常"></a>1.4、但是当启用autoindex之后，访问该目录下的路径会出现下面异常</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Index of &#x2F;innermanage&#x2F;pub&#x2F;notice&#x2F;test&#x2F;test&#x2F;test&#x2F;test&#x2F;</span><br><span class="line">..&#x2F;</span><br><span class="line">test&#x2F;                                              17-Sep-2019 02:11       -</span><br><span class="line">1.html                                             16-Sep-2019 23:21       4</span><br></pre></td></tr></table></figure>

<p>点击test目录无法进去。。。</p>
<h1 id="2、配置alias在最外层的location"><a href="#2、配置alias在最外层的location" class="headerlink" title="2、配置alias在最外层的location"></a>2、配置alias在最外层的location</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location  &#x2F;pub&#x2F;notice &#123;</span><br><span class="line">                        alias &#x2F;tmp&#x2F;bankuser&#x2F;pub&#x2F;notice&#x2F;;</span><br><span class="line">                        #autoindex on;</span><br><span class="line">                        #autoindex_exact_size off;</span><br><span class="line">                        #autoindex_localtime on;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-1、如果存在index-html文件"><a href="#2-1、如果存在index-html文件" class="headerlink" title="2.1、如果存在index.html文件"></a>2.1、如果存在index.html文件</h2><p><a href="http://localhost/pub/notice可以正常访问" target="_blank" rel="noopener">http://localhost/pub/notice可以正常访问</a><br><a href="http://localhost/pub/notice/1.html可以正常访问" target="_blank" rel="noopener">http://localhost/pub/notice/1.html可以正常访问</a></p>
<h2 id="2-2、如果不存在index-html文件"><a href="#2-2、如果不存在index-html文件" class="headerlink" title="2.2、如果不存在index.html文件"></a>2.2、如果不存在index.html文件</h2><p>localhost/pub/notice访问提示403</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">403 Forbidden</span><br><span class="line">openresty&#x2F;1.13.6.1</span><br></pre></td></tr></table></figure>

<p><a href="http://localhost/pub/notice/1.html可以正常访问" target="_blank" rel="noopener">http://localhost/pub/notice/1.html可以正常访问</a></p>
<h2 id="2-3、修改配置启用autoindex"><a href="#2-3、修改配置启用autoindex" class="headerlink" title="2.3、修改配置启用autoindex"></a>2.3、修改配置启用autoindex</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location  &#x2F;pub&#x2F;notice &#123;</span><br><span class="line">                        alias &#x2F;tmp&#x2F;bankuser&#x2F;pub&#x2F;notice&#x2F;;</span><br><span class="line">                        autoindex on;</span><br><span class="line">                        autoindex_exact_size off;</span><br><span class="line">                        autoindex_localtime on;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4、如果存在index-html"><a href="#2-4、如果存在index-html" class="headerlink" title="2.4、如果存在index.html"></a>2.4、如果存在index.html</h2><p>localhost/pub/notice可以正常访问<br><a href="http://localhost/pub/notice/1.html可以正常访问" target="_blank" rel="noopener">http://localhost/pub/notice/1.html可以正常访问</a></p>
<h2 id="2-5、如果不存在index-html"><a href="#2-5、如果不存在index-html" class="headerlink" title="2.5、如果不存在index.html"></a>2.5、如果不存在index.html</h2><p>localhost/pub/notice访问页面如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Index of &#x2F;pub&#x2F;notice&#x2F;</span><br><span class="line">..&#x2F;</span><br><span class="line">test&#x2F;                                              17-Sep-2019 02:11       -</span><br><span class="line">1.html                                             16-Sep-2019 23:21       4</span><br></pre></td></tr></table></figure>

<p><a href="http://localhost/pub/notice/1.html可以正常访问" target="_blank" rel="noopener">http://localhost/pub/notice/1.html可以正常访问</a></p>
<h1 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h1><p>根据上面实验，如果配置alias参数，建议将放在location的一层结构下，一旦放到多层目录结构内，会出现各种异常。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/nginx配置alias注意事项/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/openresty安装V1.15.8/"><span>[linux] openresty V1.15.8安装</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/openresty安装V1.15.8/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T15:02:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h1 id="1、安装先决条件"><a href="#1、安装先决条件" class="headerlink" title="1、安装先决条件"></a>1、安装先决条件</h1><p>需要安装perl 5.6.1+ libpcre libssl，确保ldconfig命令在PATH环境变量下<br><code>yum -y install epel-release</code><br><code>yum -y install vim wget lrzsz pcre pcre-devel openssl openssl-devel zlib zlib-devel telnet lua luajit gcc gcc-c++ axel curl unzip</code></p>
<h1 id="2、下载软件包"><a href="#2、下载软件包" class="headerlink" title="2、下载软件包"></a>2、下载软件包</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/soft</span><br><span class="line"><span class="built_in">cd</span> /data/soft</span><br><span class="line">wget http://openresty.org/download/openresty-1.15.8.1.tar.gz</span><br><span class="line">tar zxvf openresty-1.15.8.1.tar.gz &amp;&amp; <span class="built_in">cd</span> openresty-1.15.8.1</span><br></pre></td></tr></table></figure>

<h1 id="3、下载第三方包"><a href="#3、下载第三方包" class="headerlink" title="3、下载第三方包"></a>3、下载第三方包</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;soft</span><br><span class="line">wget http:&#x2F;&#x2F;labs.frickle.com&#x2F;files&#x2F;ngx_cache_purge-2.3.tar.gz</span><br><span class="line">tar -zxvf ngx_cache_purge-2.3.tar.gz</span><br><span class="line"></span><br><span class="line">cd &#x2F;data&#x2F;soft</span><br><span class="line">wget https:&#x2F;&#x2F;codeload.github.com&#x2F;yaoweibin&#x2F;nginx_upstream_check_module&#x2F;zip&#x2F;master</span><br><span class="line">unzip master</span><br><span class="line">mv nginx_upstream_check_module-master nginx_upstream_check_module</span><br></pre></td></tr></table></figure>

<h1 id="4、编译安装"><a href="#4、编译安装" class="headerlink" title="4、编译安装"></a>4、编译安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cd openresty-1.15.8.1</span><br><span class="line"></span><br><span class="line">.&#x2F;configure \</span><br><span class="line">    --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty \</span><br><span class="line">    --with-luajit \</span><br><span class="line">    --user&#x3D;nobody \</span><br><span class="line">    --group&#x3D;nobody \</span><br><span class="line">    --with-threads \</span><br><span class="line">    --with-file-aio \</span><br><span class="line">    --with-http_realip_module \</span><br><span class="line">    --with-http_sub_module \</span><br><span class="line">    --with-http_gunzip_module \</span><br><span class="line">    --with-http_gzip_static_module \</span><br><span class="line">    --with-http_auth_request_module \</span><br><span class="line">    --with-http_random_index_module \</span><br><span class="line">    --with-http_secure_link_module \</span><br><span class="line">    --with-http_slice_module \</span><br><span class="line">    --with-http_ssl_module \</span><br><span class="line">    --with-http_stub_status_module \</span><br><span class="line">    --with-stream \</span><br><span class="line">    --with-stream_ssl_module \</span><br><span class="line">    --with-http_v2_module \</span><br><span class="line">    --with-http_flv_module \</span><br><span class="line">    --with-mail&#x3D;dynamic \</span><br><span class="line">    --add-module&#x3D;&#x2F;data&#x2F;soft&#x2F;ngx_cache_purge-2.3 \</span><br><span class="line">    --add-module&#x3D;&#x2F;data&#x2F;soft&#x2F;nginx_upstream_check_module</span><br><span class="line"></span><br><span class="line">shell &gt; gmake &amp;&amp; gmake install</span><br><span class="line">shell &gt; ln -sf &#x2F;usr&#x2F;local&#x2F;openresty&#x2F;bin&#x2F;openresty &#x2F;usr&#x2F;bin&#x2F;openresty</span><br></pre></td></tr></table></figure>

<p>修改linux配置参数</p>
<p><code>sudo sysctl -w net.core.somaxconn=4096</code></p>
<p>在/etc/sysctl.conf末尾追加内容</p>
<p><code>net.core.somaxconn = 4096</code><br><code>echo &quot;net.core.somaxconn = 4096&quot; &gt;&gt; /etc/sysctl.conf</code></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/openresty安装V1.15.8/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/linux 使用mtr排查网络故障/"><span>[linux] linux使用mtr排查网络故障</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/linux 使用mtr排查网络故障/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T14:41:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h1 id="1、mtr参数详解"><a href="#1、mtr参数详解" class="headerlink" title="1、mtr参数详解"></a>1、mtr参数详解</h1><p>mtr工具的主要作用是在于两点丢包时候的异常点排查及路径搜集，是ping和tracert的结合。 相比于ping它会有路由节点的展示，而相对于tracert它会展示中间路由节点的丢包情况，可以根据丢包梯度情况简单分析出可能的异常节点并向对应运营商进行反馈。</p>
<p>由于骨干外网路径可能存在的异步路由（即数据包来回路径不一致，可能在某一方向看无明显异常点，另一方向才会显示异常）与ECMP（运营商在多根路径上做负载均衡，某一根异常导致部分IP丢包），建议提供双向mtr。</p>
<p>下载安装<br>centos系统可用 yum install -y mtr 安装，其他操作系统建议采用相关下载工具</p>
<h1 id="2、运行命令"><a href="#2、运行命令" class="headerlink" title="2、运行命令"></a>2、运行命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mtr 13.71.139.151</span><br></pre></td></tr></table></figure>
<h1 id="3、运行结果"><a href="#3、运行结果" class="headerlink" title="3、运行结果"></a>3、运行结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Host                                                                                                                                                               Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line"> 1. 172.27.169.229                                                                                                                                                  66.5%   158    2.3   2.2   1.4  12.5   1.4</span><br><span class="line"> 2. 172.27.192.144                                                                                                                                                  65.8%   158    1.6   1.9   1.2  17.0   2.0</span><br><span class="line"> 3. 172.31.145.132                                                                                                                                                   0.0%   158    0.8   0.8   0.7   1.6   0.0</span><br><span class="line"> 4. 172.31.144.217                                                                                                                                                   0.0%   158    1.5   9.2   1.3 168.5  21.1</span><br><span class="line"> 5. 10.1.251.5                                                                                                                                                       0.0%   158    1.6   6.8   1.4 155.3  19.1</span><br><span class="line"> 6. ???</span><br><span class="line"> 7. 36.110.169.21                                                                                                                                                   15.8%   158    4.0   3.8   2.9   8.7   0.4</span><br><span class="line"> 8. 218.30.28.13                                                                                                                                                     8.2%   158    2.5   2.8   2.3  36.1   3.7</span><br><span class="line"> 9. 218.30.28.53                                                                                                                                                     0.0%   158    3.5   3.5   3.3   7.6   0.3</span><br><span class="line">10. 202.97.48.246                                                                                                                                                    6.3%   158   14.9  12.8   2.9  21.0   5.6</span><br><span class="line">11. 202.97.12.50                                                                                                                                                     7.0%   158   15.8  16.3   5.1  26.5   6.6</span><br><span class="line">12. 202.97.89.50                                                                                                                                                     3.8%   158   54.5  50.3  37.7  59.4   6.1</span><br><span class="line">13. 183.91.34.126                                                                                                                                                    0.0%   158   38.0  38.6  37.9  61.6   2.5</span><br><span class="line">14. ae24-0.icr01.hkg20.ntwk.msn.net                                                                                                                                  0.0%   158   39.4  40.2  39.0  74.5   4.1</span><br><span class="line">15. be-120-0.ibr02.hkg20.ntwk.msn.net                                                                                                                                0.0%   158   87.5  87.7  87.3  89.4   0.1</span><br><span class="line">16. be-5-0.ibr02.tyo31.ntwk.msn.net                                                                                                                                  0.0%   158   88.1  88.4  88.1  89.3   0.0</span><br><span class="line">17. ae120-0.icr01.tyo31.ntwk.msn.net                                                                                                                                 0.0%   158   88.9  89.8  88.6 110.2   3.1</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/linux 使用mtr排查网络故障/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/linux 内核参数tcp_tw_reuse、tcp_tw_recycle、tcp_timestam/"><span>[linux] linux 内核参数tcp_tw_reuse、tcp_tw_recycle、tcp_timestamp详解</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/linux 内核参数tcp_tw_reuse、tcp_tw_recycle、tcp_timestam/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T14:37:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h1 id="1、参数概述"><a href="#1、参数概述" class="headerlink" title="1、参数概述"></a>1、参数概述</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcp_tw_reuse：允许将TIME-WAIT sockets重新用于新的TCP连接，默认为0，表示关闭</span><br><span class="line">tcp_tw_recycle：表示开启TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭</span><br><span class="line">tcp_timestamps：tcp时间戳</span><br></pre></td></tr></table></figure>

<h1 id="2、查看三个参数当前的状态"><a href="#2、查看三个参数当前的状态" class="headerlink" title="2、查看三个参数当前的状态"></a>2、查看三个参数当前的状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shell &gt; sysctl -a|grep -E &quot;tcp_timestamp|tw_reuse|tw_recycle&quot;</span><br><span class="line">net.ipv4.tcp_timestamps &#x3D; 1</span><br><span class="line">net.ipv4.tcp_tw_recycle &#x3D; 0</span><br><span class="line">net.ipv4.tcp_tw_reuse &#x3D; 0</span><br></pre></td></tr></table></figure>

<h1 id="3、参数解析"><a href="#3、参数解析" class="headerlink" title="3、参数解析"></a>3、参数解析</h1><p>tcp_tw_reuse：仅在TCP套接字作为客户端，调用connect时起作用。绝大部分的TCP服务器，应该不会有大量主动连接的动作（或许会连接DB等，但一般也是长连接）。因此这个选项对于TCP服务来说，基本上是无用的，完全是没必要打开。只有服务器作为客户端，发起一下短小事务的连接的时候该参数才能凸显作用。必须启用net.ipv4.tcp_timestamps参数，才允许重用TIME_WAIT套接字，tcp_tw_reuse参数才会起作用。<br>tcp_tw_recycle：这种回收参数，在nat环境过会存在重大问题，丢弃大量的可用连接。例如：公司使用LVS做负载均衡，通常是前面一台LVS，后面多台后端服务器，这其实就是NAT，当请求到达LVS后，它修改地址数据后便转发给后端服务器，但不会修改时间戳数据，对于后端服务器来说，请求的源地址就是LVS的地址，加上端口会复用，所以从后端服务器的角度看，原本不同客户端的请求经过LVS的转发，就可能会被认为是同一个连接，加之不同客户端的时间可能不一致，所以就会出现时间戳错乱的现象，于是后面的数据包就被丢弃了，具体的表现通常是是客户端明明发送的SYN，但服务端就是不响应ACK。<br>因此在nat环境下建议禁用该参数。<br>禁用方式：<br><code>echo 0 &gt; /proc/sys/net/ipv4/tcp_tw_recycle;</code><br>可以保留tcp_timestamps参数，默认是开启的，只要把tcp_tw_recycle参数禁用了回收机制就不起作用了。<br>当然也可以把这个参数禁用，禁用命令如下：<br><code>sysctl -w net.ipv4.tcp_timestamps=0</code></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/linux 内核参数tcp_tw_reuse、tcp_tw_recycle、tcp_timestam/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/linux使用netstat统计网络连接状态信息/"><span>[linux] linux使用netstat统计网络连接状态信息</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/linux使用netstat统计网络连接状态信息/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T14:35:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p><code>netstat -a | awk &#39;/^tcp/ {++S[$NF]} END {for(a in S) print a,S[a]}&#39;</code><br>或者<br><code>netstat -a |grep ^tcp | awk &#39;{++S[$NF]} END {for(a in S) print a,S[a]}&#39;</code><br>{++S[$NF] 的意思是 统计每行最后一个出现的次数，至少一次，放入数组中</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/linux使用netstat统计网络连接状态信息/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/09/22/curl请求返回http_code和响应时间/"><span>[linux] curl请求返回http_code和响应时间</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/09/22/curl请求返回http_code和响应时间/" rel="bookmark">
        <time class="entry-date published" datetime="2019-09-22T14:16:00.000Z">
          2019-09-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <p><code>curl -o /dev/null -s -w %{http_code}:%{http_connect}:%{content_type}:%{time_namelookup}:%{time_redirect}:%{time_pretransfer}:%{time_connect}:%{time_starttransfer}:%{time_total}:%{speed_download}  http://www.baidu.com</code><br>或者<br><code>curl -o /dev/null -s -w %{http_code}:%{time_connect}:%{time_starttransfer}:%{time_total} http://www.baidu.com</code></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/09/22/curl请求返回http_code和响应时间/"><span>点击阅读</span></a></h3>
    
  
</article>






<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">下一页</a>
  
</nav>
            </main>
            <div class="sidebar
                    col-lg-3 col-lg-offset-0
                    col-md-3 col-md-offset-0
                    col-sm-12
                    col-xs-12
                    sidebar-container
                ">

                <div class="sidebar-container">



<div class="search-container">
<form class="site-search-form">
    <span class="glyphicon glyphicon-search"></span><input type="text" id="local-search-input" class="st-search-input" placeholder="Search..." />
</form>
<div id="local-search-result" class="local-search-result-cls"></div>
</div>
<script type="text/javascript" id="local.search.active">
var inputArea       = document.querySelector("#local-search-input");
inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script>




    <div class="categories-container" style="margin-top:40px;">
        <p>归档:</p>
            
    </div>




    <div class="social-container" style="margin-top:40px;">
        <p>Links:</p>
            
                
                    <li class="social-item"><i class="fa fa-fw fa-github"></i><a href="https://github.com/zeven0707">GitHub</a></li>
                
            
    </div>

</div>
            </div>
          </div>
        </div>
        
    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/BosenY/Lap" target="_blank">Lap</a>
    <br/><span id="busuanzi_container_site_uv"> 
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    </br>
    
      
        &copy; 2020 zeven0707&#39;s blog
      
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92842840-1', 'auto');
    ga('send', 'pageview');

</script>


  </div>

</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/draw-something/dist/draw.min.js"></script>
  <script>
    let maxNum = Number.parseInt('30')
    let iconText = '❤'
    let color = 'red'
    new Draw({maxNum, iconText, color})
  </script>

<script src="/js/index.js"></script>
<script src="/js/search.js"></script>

</body>
</html>