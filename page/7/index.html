<!DOCTYPE HTML>
<html>
<head >
  <meta charset="utf-8">
  
  <title>第 7 页 | zeven&#39;s blog</title>

  
  <meta name="author" content="zeven0707&#39;s blog">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="zeven&#39;s blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  
  
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5005349780815724",
    enable_page_level_ads: true
  });
</script>

  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?223eea22355699157e147870eb124b24";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <link rel="manifest" href="/manifest.json">
  <link href="/favicon.ico" rel="icon">

  <link rel="alternate" href="/atom.xml" title="zeven&#39;s blog" type="application/atom+xml">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">


</head>


<body>
<div class="blog">
  <div class="content">

    

    <header class="header-container" style="background-image: url('/images/blog-bg.jpg');">


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header page-scroll">
          <button type="button" id="tglBtn" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">zeven0707&#39;s blog</a>
        </div>
        <div id="bosenyblog-navbar">
          <div class="navbar-collapse" id="bs-example-navbar-collapse-6">
            <ul class="nav navbar-nav navbar-right">
            
              <li><a href="/">主页</a></li>
            
              <li><a href="/archives">日志</a></li>
            
              <li><a href="/about">关于</a></li>
            
              <li><a href="/tags">标签</a></li>
            
            </ul>
          </div>
        </div>

    </div>
 </nav>
 <div class="gotop-btn">

 </div>
</header>

        
        <div class="container ">
          <div class="row">
            <main class="site-main posts-loop    col-lg-8 col-lg-offset-1
                    col-md-8 col-md-offset-1
                    col-sm-12
                    col-xs-12">
            
  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/03/14/oracle expdp导出报错ORA-39213/"><span>[Oracle] oracle expdp导出报错ORA-39213</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/03/14/oracle expdp导出报错ORA-39213/" rel="bookmark">
        <time class="entry-date published" datetime="2019-03-14T02:16:00.000Z">
          2019-03-14
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、使用expdp导出"><a href="#1、使用expdp导出" class="headerlink" title="1、使用expdp导出"></a>1、使用expdp导出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[oracle@rac1 ~]$ expdp \&quot;&#x2F; as sysdba\&quot; directory&#x3D;exp_data_dir full&#x3D;y dumpfile&#x3D;oibs_full.dmp cluster&#x3D;n parallel&#x3D;4 logfile&#x3D;expdp.log exclude&#x3D;STATISTICS</span><br><span class="line">Export: Release 11.2.0.4.0 - Production on Wed Mar 13 16:14:01 2019</span><br><span class="line">Copyright (c) 1982, 2011, Oracle and&#x2F;or its affiliates.  All rights reserved.</span><br><span class="line">Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class="line">With the Partitioning, Real Application Clusters, Automatic Storage Management, OLAP,</span><br><span class="line">Data Mining and Real Application Testing options</span><br><span class="line">ORA-39006: internal error</span><br><span class="line">ORA-39213: Metadata processing is not available</span><br></pre></td></tr></table></figure>
<h4 id="2、查看报错信息"><a href="#2、查看报错信息" class="headerlink" title="2、查看报错信息"></a>2、查看报错信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[oracle@rac1 ~]$ oerr ora 39213</span><br><span class="line">39213, 00000, &quot;Metadata processing is not available&quot;</span><br><span class="line">&#x2F;&#x2F; *Cause:  The Data Pump could not use the Metadata API.  Typically,</span><br><span class="line">&#x2F;&#x2F;          this is caused by the XSL stylesheets not being set up properly.</span><br><span class="line">&#x2F;&#x2F; *Action: Connect AS SYSDBA and execute dbms_metadata_util.load_stylesheets</span><br><span class="line">&#x2F;&#x2F;          to reload the stylesheets.</span><br></pre></td></tr></table></figure>
<h4 id="3、根据提示执行dbms-metadata-util-load-stylesheets命令"><a href="#3、根据提示执行dbms-metadata-util-load-stylesheets命令" class="headerlink" title="3、根据提示执行dbms_metadata_util.load_stylesheets命令"></a>3、根据提示执行dbms_metadata_util.load_stylesheets命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[oracle@rac1 ~]$ sqlplus &#x2F; as sysdba</span><br><span class="line">SQL*Plus: Release 11.2.0.4.0 Production on Wed Mar 13 16:15:27 2019</span><br><span class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Connected to:</span><br><span class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</span><br><span class="line">With the Partitioning, Real Application Clusters, Automatic Storage Management, OLAP,</span><br><span class="line">Data Mining and Real Application Testing options</span><br><span class="line"></span><br><span class="line">16:15:27 SYS@ oibs11&gt; execute dbms_metadata_util.load_stylesheets;</span><br><span class="line">PL&#x2F;SQL procedure successfully completed.</span><br><span class="line">Elapsed: 00:00:14.93</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/03/14/oracle expdp导出报错ORA-39213/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/03/13/Access gitlab return 422 error/"><span>[Linux] Access gitlab return 422 error</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/03/13/Access gitlab return 422 error/" rel="bookmark">
        <time class="entry-date published" datetime="2019-03-13T03:49:00.000Z">
          2019-03-13
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、浏览器访问gitlab，web界面直接返回The-change-you-wanted-was-rejected或者查看-var-log-gitlab-gitlab-rails下面的production-log提示Can’t-verify-CSRF-token-authenticity-Completed-422-Unprocessable："><a href="#1、浏览器访问gitlab，web界面直接返回The-change-you-wanted-was-rejected或者查看-var-log-gitlab-gitlab-rails下面的production-log提示Can’t-verify-CSRF-token-authenticity-Completed-422-Unprocessable：" class="headerlink" title="1、浏览器访问gitlab，web界面直接返回The change you wanted was rejected或者查看/var/log/gitlab/gitlab-rails下面的production.log提示Can’t verify CSRF token authenticity Completed 422 Unprocessable："></a>1、浏览器访问gitlab，web界面直接返回The change you wanted was rejected或者查看/var/log/gitlab/gitlab-rails下面的production.log提示Can’t verify CSRF token authenticity Completed 422 Unprocessable：</h4><p><img src="https://i.imgur.com/fUZnjpq.png" alt=""><br><img src="https://i.imgur.com/zIq35Po.png" alt=""><br>出现该问题，一般都是前端nginx的代理报头配置出现了问题，下面是分别在https和http不同情况下的解决方法</p>
<h4 id="2、如果在-etc-gitlab-gitlab-rb下的参数external-url-“https-”配置有https，访问遇到422错误-修改-etc-gitlab-gitlab-rb下nginx配置，添加以下配置信息："><a href="#2、如果在-etc-gitlab-gitlab-rb下的参数external-url-“https-”配置有https，访问遇到422错误-修改-etc-gitlab-gitlab-rb下nginx配置，添加以下配置信息：" class="headerlink" title="2、如果在/etc/gitlab/gitlab.rb下的参数external_url “https://***”配置有https，访问遇到422错误,修改/etc/gitlab/gitlab.rb下nginx配置，添加以下配置信息："></a>2、如果在/etc/gitlab/gitlab.rb下的参数external_url “https://***”配置有https，访问遇到422错误,修改/etc/gitlab/gitlab.rb下nginx配置，添加以下配置信息：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx[&#39;proxy_set_headers&#39;] &#x3D; &#123;</span><br><span class="line">  &quot;X-Forwarded-Proto&quot; &#x3D;&gt; &quot;https&quot;,</span><br><span class="line">  &quot;X-Forwarded-Ssl&quot; &#x3D;&gt; &quot;on&quot;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>之后重新编译gitlab,命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<h4 id="3、如果在-etc-gitlab-gitlab-rb下的参数external-url-“http-”配置有http，访问遇到422错误，修改-etc-gitlab-gitlab-rb下nginx配置，添加以下配置信息："><a href="#3、如果在-etc-gitlab-gitlab-rb下的参数external-url-“http-”配置有http，访问遇到422错误，修改-etc-gitlab-gitlab-rb下nginx配置，添加以下配置信息：" class="headerlink" title="3、如果在/etc/gitlab/gitlab.rb下的参数external_url “http://***”配置有http，访问遇到422错误，修改/etc/gitlab/gitlab.rb下nginx配置，添加以下配置信息："></a>3、如果在/etc/gitlab/gitlab.rb下的参数external_url “http://***”配置有http，访问遇到422错误，修改/etc/gitlab/gitlab.rb下nginx配置，添加以下配置信息：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx[&#39;proxy_set_headers&#39;] &#x3D; &#123;</span><br><span class="line">  &quot;X-Forwarded-Proto&quot; &#x3D;&gt; &quot;http&quot;,</span><br><span class="line">  &quot;CUSTOM_HEADER&quot; &#x3D;&gt; &quot;VALUE&quot;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>之后重新编译gitlab,命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure>
<h4 id="4、参考链接"><a href="#4、参考链接" class="headerlink" title="4、参考链接"></a>4、参考链接</h4><p><a href="https://docs.gitlab.com/omnibus/settings/nginx.html" target="_blank" rel="noopener">gitlab关于nginx配置的官网链接</a></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/03/13/Access gitlab return 422 error/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/03/11/oracle查询乱码问题/"><span>[Oracle] oracle查询乱码、导入sql脚本乱码问题</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/03/11/oracle查询乱码问题/" rel="bookmark">
        <time class="entry-date published" datetime="2019-03-11T02:59:00.000Z">
          2019-03-11
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、查看当前数据库字符集"><a href="#1、查看当前数据库字符集" class="headerlink" title="1、查看当前数据库字符集"></a>1、查看当前数据库字符集</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">02:30:58 SYS@ chicago&gt; select * from nls_database_parameters;</span><br><span class="line"></span><br><span class="line">PARAMETER                      VALUE</span><br><span class="line">------------------------------ --------------------------------------------------------------------------------</span><br><span class="line">NLS_LANGUAGE                   AMERICAN</span><br><span class="line">NLS_TERRITORY                  AMERICA</span><br><span class="line">NLS_CURRENCY                   $</span><br><span class="line">NLS_ISO_CURRENCY               AMERICA</span><br><span class="line">NLS_NUMERIC_CHARACTERS         .,</span><br><span class="line">NLS_CHARACTERSET               ZHS16GBK</span><br><span class="line">NLS_CALENDAR                   GREGORIAN</span><br><span class="line">NLS_DATE_FORMAT                DD-MON-RR</span><br><span class="line">NLS_DATE_LANGUAGE              AMERICAN</span><br><span class="line">NLS_SORT                       BINARY</span><br><span class="line">NLS_TIME_FORMAT                HH.MI.SSXFF AM</span><br><span class="line">NLS_TIMESTAMP_FORMAT           DD-MON-RR HH.MI.SSXFF AM</span><br><span class="line">NLS_TIME_TZ_FORMAT             HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_TIMESTAMP_TZ_FORMAT        DD-MON-RR HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_DUAL_CURRENCY              $</span><br><span class="line">NLS_COMP                       BINARY</span><br><span class="line">NLS_LENGTH_SEMANTICS           BYTE</span><br><span class="line">NLS_NCHAR_CONV_EXCP            FALSE</span><br><span class="line">NLS_NCHAR_CHARACTERSET         AL16UTF16</span><br><span class="line">NLS_RDBMS_VERSION              11.2.0.4.0</span><br><span class="line"></span><br><span class="line">20 rows selected.</span><br></pre></td></tr></table></figure>
<h4 id="2、查看当前连接终端字符编码是否为gbk，如果不是gbk需要修改，以securecrt为例："><a href="#2、查看当前连接终端字符编码是否为gbk，如果不是gbk需要修改，以securecrt为例：" class="headerlink" title="2、查看当前连接终端字符编码是否为gbk，如果不是gbk需要修改，以securecrt为例："></a>2、查看当前连接终端字符编码是否为gbk，如果不是gbk需要修改，以securecrt为例：</h4><p><img src="https://i.imgur.com/oMuYtyk.png" alt=""></p>
<h4 id="3、如果都是gbk，查询出来的仍为乱码，再次查看环境变量NLS-LANG"><a href="#3、如果都是gbk，查询出来的仍为乱码，再次查看环境变量NLS-LANG" class="headerlink" title="3、如果都是gbk，查询出来的仍为乱码，再次查看环境变量NLS_LANG"></a>3、如果都是gbk，查询出来的仍为乱码，再次查看环境变量NLS_LANG</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@dax-mysql-slave ~]$ echo $NLS_LANG</span><br><span class="line">AMERICAN_AMERICA.ZHS16GBK</span><br></pre></td></tr></table></figure>
<p>如果为空，或者与数据库字符集不匹配，修改为与数据库相同的字符集</p>
<h4 id="4、-在linux系统LANG环境变量为en-US-UTF-8，其他以上参数都为gbk的情况下，查看带有中文的文本文件会是乱码："><a href="#4、-在linux系统LANG环境变量为en-US-UTF-8，其他以上参数都为gbk的情况下，查看带有中文的文本文件会是乱码：" class="headerlink" title="4、 在linux系统LANG环境变量为en_US.UTF-8，其他以上参数都为gbk的情况下，查看带有中文的文本文件会是乱码："></a>4、 在linux系统LANG环境变量为en_US.UTF-8，其他以上参数都为gbk的情况下，查看带有中文的文本文件会是乱码：</h4><p><img src="https://i.imgur.com/ebmBiTj.png" alt=""><br>这种情况下在sqlplus执行sql脚本，会报错，<br><img src="https://i.imgur.com/L5lQ2Wj.png" alt=""></p>
<h4 id="5、要执行脚本，需要修改LANG变量，将该传输修改为gbk"><a href="#5、要执行脚本，需要修改LANG变量，将该传输修改为gbk" class="headerlink" title="5、要执行脚本，需要修改LANG变量，将该传输修改为gbk"></a>5、要执行脚本，需要修改LANG变量，将该传输修改为gbk</h4><p><img src="https://i.imgur.com/PivConY.png" alt=""></p>
<h4 id="6、重新编辑文本文件"><a href="#6、重新编辑文本文件" class="headerlink" title="6、重新编辑文本文件"></a>6、重新编辑文本文件</h4><p><img src="https://i.imgur.com/TTzE7F2.png" alt=""></p>
<h4 id="7、在sqlplus下再次执行脚本"><a href="#7、在sqlplus下再次执行脚本" class="headerlink" title="7、在sqlplus下再次执行脚本"></a>7、在sqlplus下再次执行脚本</h4><p><img src="https://i.imgur.com/kxJgkwD.png" alt=""><br><img src="https://i.imgur.com/ahLMjdB.png" alt=""><br>脚本执行成功。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/03/11/oracle查询乱码问题/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/02/27/记一次服务器被植入watchbog（并不是linux自带的watchdog进程）挖坑病毒的处理过程/"><span>[Linux] 记一次服务器被植入watchbog（并不是linux自带的watchdog进程）挖坑病毒的处理过程</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/02/27/记一次服务器被植入watchbog（并不是linux自带的watchdog进程）挖坑病毒的处理过程/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-27T09:26:00.000Z">
          2019-02-27
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、服务器收到cpu报警，cpu被占用达到100-，登录服务器查看，发现cpu被一个watchbog的进程占满了，如下图所示"><a href="#1、服务器收到cpu报警，cpu被占用达到100-，登录服务器查看，发现cpu被一个watchbog的进程占满了，如下图所示" class="headerlink" title="1、服务器收到cpu报警，cpu被占用达到100%，登录服务器查看，发现cpu被一个watchbog的进程占满了，如下图所示"></a>1、服务器收到cpu报警，cpu被占用达到100%，登录服务器查看，发现cpu被一个watchbog的进程占满了，如下图所示</h4><p><img src="https://i.imgur.com/dsX0Vyz.png" alt=""><br>该进程为被植入的挖矿程序，该程序会在cron下面写入脚本，定期去pastebin.com下载木马开始挖矿，如果删除不彻底仍然会不定期启动这个挖矿程序。</p>
<h4 id="2、下面开始删除这个病毒木马，防火墙配置，禁用这个域名对应ip的出入限制："><a href="#2、下面开始删除这个病毒木马，防火墙配置，禁用这个域名对应ip的出入限制：" class="headerlink" title="2、下面开始删除这个病毒木马，防火墙配置，禁用这个域名对应ip的出入限制："></a>2、下面开始删除这个病毒木马，防火墙配置，禁用这个域名对应ip的出入限制：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 104.20.209.21 -j DROP</span><br><span class="line">iptables -A OUTPUT -s 104.20.209.21 -j DROP</span><br><span class="line">iptables -A OUTPUT -j DROP -d 104.20.209.21</span><br></pre></td></tr></table></figure>
<p>保存修改内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;sbin&#x2F;service iptables save</span><br></pre></td></tr></table></figure>
<p>为安全起见，同时修改本地hosts文件添加，将pastebin.com重定向到本地：<br>cat /etc/hosts|grep pastebin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 pastebin.com</span><br></pre></td></tr></table></figure>
<h4 id="3、移除wget、curl脚本里面会使用curl和wget等命令下载病毒-如果确认病毒可以被彻底删除，这不无需操作"><a href="#3、移除wget、curl脚本里面会使用curl和wget等命令下载病毒-如果确认病毒可以被彻底删除，这不无需操作" class="headerlink" title="3、移除wget、curl脚本里面会使用curl和wget等命令下载病毒(如果确认病毒可以被彻底删除，这不无需操作)"></a>3、移除wget、curl脚本里面会使用curl和wget等命令下载病毒(如果确认病毒可以被彻底删除，这不无需操作)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv &#x2F;usr&#x2F;bin&#x2F;curl &#x2F;usr&#x2F;bin&#x2F;lruc</span><br><span class="line">mv &#x2F;usr&#x2F;bin&#x2F;wget &#x2F;usr&#x2F;bin&#x2F;tegw</span><br></pre></td></tr></table></figure>
<h4 id="4、杀掉watchbog进程"><a href="#4、杀掉watchbog进程" class="headerlink" title="4、杀掉watchbog进程"></a>4、杀掉watchbog进程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep watchbog|awk &#39;&#123;print $2&#125;&#39;|xargs kill -9</span><br></pre></td></tr></table></figure>
<h4 id="5、删掉cron里面的相关任务"><a href="#5、删掉cron里面的相关任务" class="headerlink" title="5、删掉cron里面的相关任务"></a>5、删掉cron里面的相关任务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br><span class="line">&#x2F;etc&#x2F;cron.d     </span><br><span class="line">&#x2F;etc&#x2F;cron.deny    </span><br><span class="line">&#x2F;etc&#x2F;cron.monthly  </span><br><span class="line">&#x2F;etc&#x2F;cron.daily  </span><br><span class="line">&#x2F;etc&#x2F;cron.hourly  </span><br><span class="line">&#x2F;etc&#x2F;crontab       </span><br><span class="line">&#x2F;etc&#x2F;cron.weekly</span><br></pre></td></tr></table></figure>
<p>上面所有的文档一定要都仔细检查一边，有相关curl pastebin.com等信息要彻底删除</p>
<h4 id="6、在cron的文件下还发现的其他脚本命令，-bin-httpntp、-bin-ftpsdns等，同时删除watchbog"><a href="#6、在cron的文件下还发现的其他脚本命令，-bin-httpntp、-bin-ftpsdns等，同时删除watchbog" class="headerlink" title="6、在cron的文件下还发现的其他脚本命令，/bin/httpntp、/bin/ftpsdns等，同时删除watchbog"></a>6、在cron的文件下还发现的其他脚本命令，/bin/httpntp、/bin/ftpsdns等，同时删除watchbog</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf &#x2F;usr&#x2F;bin&#x2F;watchbog</span><br><span class="line">rm -rf &#x2F;bin&#x2F;httpntp</span><br><span class="line">rm -rf &#x2F;bin&#x2F;ftpsdns</span><br></pre></td></tr></table></figure>
<h4 id="7、如果-tmp目录下存在文件-tmp-timesyncc-service，也要删除"><a href="#7、如果-tmp目录下存在文件-tmp-timesyncc-service，也要删除" class="headerlink" title="7、如果/tmp目录下存在文件/tmp/timesyncc.service，也要删除"></a>7、如果/tmp目录下存在文件/tmp/<em>timesyncc.service</em>，也要删除</h4><h4 id="8、参考链接"><a href="#8、参考链接" class="headerlink" title="8、参考链接"></a>8、<a href="http://sudhakarbellamkonda.blogspot.com/2018/11/blocking-watchbog-malwareransomware.html" target="_blank" rel="noopener">参考链接</a></h4>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/02/27/记一次服务器被植入watchbog（并不是linux自带的watchdog进程）挖坑病毒的处理过程/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/02/26/ORA-00020 maximum number of processes (150) exceeded/"><span>[Oracle] oracle ORA-00020: maximum number of processes (150) exceeded</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/02/26/ORA-00020 maximum number of processes (150) exceeded/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-26T06:24:00.000Z">
          2019-02-26
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、报错提示oracle的会话连接数达到上限，解决方法如下"><a href="#1、报错提示oracle的会话连接数达到上限，解决方法如下" class="headerlink" title="1、报错提示oracle的会话连接数达到上限，解决方法如下"></a>1、报错提示oracle的会话连接数达到上限，解决方法如下</h4><h4 id="2、发生报错之后，使用sqlplus-as-sysdba也不能登录，oracle不像mysql一样专门为超级管理员用户保留一个连接会话，oracle只能通过杀掉session连接才能再次登录。"><a href="#2、发生报错之后，使用sqlplus-as-sysdba也不能登录，oracle不像mysql一样专门为超级管理员用户保留一个连接会话，oracle只能通过杀掉session连接才能再次登录。" class="headerlink" title="2、发生报错之后，使用sqlplus / as sysdba也不能登录，oracle不像mysql一样专门为超级管理员用户保留一个连接会话，oracle只能通过杀掉session连接才能再次登录。"></a>2、发生报错之后，使用sqlplus / as sysdba也不能登录，oracle不像mysql一样专门为超级管理员用户保留一个连接会话，oracle只能通过杀掉session连接才能再次登录。</h4><h6 id="2-1、批量杀掉会话连接："><a href="#2-1、批量杀掉会话连接：" class="headerlink" title="2.1、批量杀掉会话连接："></a>2.1、批量杀掉会话连接：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep oracle|grep LOCAL|grep -v grep|awk &#39;&#123;print $2&#125;&#39;|xargs kill -9</span><br></pre></td></tr></table></figure>
<p>如果当前系统下存在多个实例(可以手动指定${ORACLE_SID}，不指定会使用当前环境变量默认下的值)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep oracle$&#123;ORACLE_SID&#125;|grep LOCAL|grep -v grep|awk &#39;&#123;print $2&#125;&#39;|xargs kill -9</span><br></pre></td></tr></table></figure>
<h5 id="2-2、单独杀掉会话连接"><a href="#2-2、单独杀掉会话连接" class="headerlink" title="2.2、单独杀掉会话连接"></a>2.2、单独杀掉会话连接</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep oracle$&#123;ORACLE_SID&#125;|grep LOCAL|awk &#39;&#123;print $2&#125;&#39;</span><br><span class="line">kill -9 ***</span><br></pre></td></tr></table></figure>

<h4 id="3、杀掉会话连接后，等待一段时间再次sqlplus-as-sysdba登录显示正常。"><a href="#3、杀掉会话连接后，等待一段时间再次sqlplus-as-sysdba登录显示正常。" class="headerlink" title="3、杀掉会话连接后，等待一段时间再次sqlplus / as sysdba登录显示正常。"></a>3、杀掉会话连接后，等待一段时间再次sqlplus / as sysdba登录显示正常。</h4><p>登录之后修改process进程数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter system set processes&#x3D;500 scope&#x3D;spfile;</span><br></pre></td></tr></table></figure>
<p>修改完该参数之后要重新启动db，才能生效,该参数不支持动态修改。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/02/26/ORA-00020 maximum number of processes (150) exceeded/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/02/14/goaccess安装/"><span>[Linux] nginx日志分析工具goaccess</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/02/14/goaccess安装/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-14T08:12:00.000Z">
          2019-02-14
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="0、yum安装依赖包"><a href="#0、yum安装依赖包" class="headerlink" title="0、yum安装依赖包"></a>0、yum安装依赖包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install GeoIP-devel gcc ncurses* glib2 glib2-devel zlib zlib-devel bzip2-devel -y</span><br><span class="line">rpm -Uvh https:&#x2F;&#x2F;dl.fedoraproject.org&#x2F;pub&#x2F;epel&#x2F;epel-release-latest-6.noarch.rpm</span><br><span class="line">yum -y install GeoIP-update</span><br></pre></td></tr></table></figure>
<h4 id="1、下载安装goaccess（需科学上网）"><a href="#1、下载安装goaccess（需科学上网）" class="headerlink" title="1、下载安装goaccess（需科学上网）"></a>1、下载安装goaccess（需科学上网）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;tar.goaccess.io&#x2F;goaccess-1.3.tar.gz</span><br><span class="line">tar -xzvf goaccess-1.3.tar.gz</span><br><span class="line">cd goaccess-1.3&#x2F;</span><br><span class="line">.&#x2F;configure --enable-utf8 --enable-geoip&#x3D;legacy</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="2、修改配置文件（可根据自己需求配置），也可以在启动命令是单独指定："><a href="#2、修改配置文件（可根据自己需求配置），也可以在启动命令是单独指定：" class="headerlink" title="2、修改配置文件（可根据自己需求配置），也可以在启动命令是单独指定："></a>2、修改配置文件（可根据自己需求配置），也可以在启动命令是单独指定：</h4><p>more /etc/goaccess.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">time-format %H:%M:%S</span><br><span class="line">date-format %d&#x2F;%b&#x2F;%Y</span><br><span class="line">log-format %h %^[%d:%t %^] &quot;%r&quot; %s %b &quot;%R&quot; &quot;%u&quot;</span><br><span class="line"></span><br><span class="line">real-time-html true</span><br><span class="line">ssl-cert &lt;cert.crt&gt;</span><br><span class="line">ssl-key &lt;priv.key&gt;</span><br><span class="line">ws-url wss:&#x2F;&#x2F;&lt;your-domain&gt;</span><br><span class="line">port &lt;port&gt;</span><br><span class="line">output &#x2F;var&#x2F;www&#x2F;&lt;xxx&gt;&#x2F;stat&#x2F;index.html</span><br></pre></td></tr></table></figure>

<h4 id="3、安装tokyocabinet用于持久化数据（如果不需要持久化数据到磁盘可不必安装）"><a href="#3、安装tokyocabinet用于持久化数据（如果不需要持久化数据到磁盘可不必安装）" class="headerlink" title="3、安装tokyocabinet用于持久化数据（如果不需要持久化数据到磁盘可不必安装）"></a>3、安装tokyocabinet用于持久化数据（如果不需要持久化数据到磁盘可不必安装）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;soft</span><br><span class="line">wget http:&#x2F;&#x2F;fallabs.com&#x2F;tokyocabinet&#x2F;tokyocabinet-1.4.48.tar.gz</span><br><span class="line">tar -zxvf tokyocabinet-1.4.48.tar.gz</span><br><span class="line">cd tokyocabinet-1.4.48</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local --enable-off64 --enable-fastest</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>将生成的模块加入/lib64下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;data&#x2F;soft&#x2F;tokyocabinet-1.4.48&#x2F;libtokyocabinet.so.9 &#x2F;lib64&#x2F;</span><br></pre></td></tr></table></figure>
<p>如果没有这个模块会，重新编译goaccess会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess: error while loading shared libraries: libtokyocabinet.so.9: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<h4 id="4、安装完tokyocabinet，配置goaccess加入btree"><a href="#4、安装完tokyocabinet，配置goaccess加入btree" class="headerlink" title="4、安装完tokyocabinet，配置goaccess加入btree"></a>4、安装完tokyocabinet，配置goaccess加入btree</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --enable-utf8 --enable-geoip&#x3D;legacy --enable-tcb&#x3D;btree</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="5、增加打印日志功能（可选）"><a href="#5、增加打印日志功能（可选）" class="headerlink" title="5、增加打印日志功能（可选）"></a>5、增加打印日志功能（可选）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --enable-utf8 --enable-geoip&#x3D;legacy --enable-tcb&#x3D;btree --enable-debug</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>指定输出日志文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--debug-file&#x3D;&#x2F;tmp&#x2F;goaccess.log</span><br></pre></td></tr></table></figure>

<h4 id="6、添加定时任务生成月度的日志分析表（月度报表）"><a href="#6、添加定时任务生成月度的日志分析表（月度报表）" class="headerlink" title="6、添加定时任务生成月度的日志分析表（月度报表）"></a>6、添加定时任务生成月度的日志分析表（月度报表）</h4><p>添加到定时任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;crontab |grep sh</span><br><span class="line">00 01 * * * root source &#x2F;etc&#x2F;profile &amp;&amp; sh &#x2F;root&#x2F;test.sh</span><br></pre></td></tr></table></figure>
<p>cat /root/test.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!bin&#x2F;bash</span><br><span class="line">#前一天的日期</span><br><span class="line">prestamp&#x3D;&#96;date -d &#39;1 day ago&#39; +&#39;%Y%m%d&#39;&#96;</span><br><span class="line">#指定需要分析的前一天的日志的文件名称</span><br><span class="line">prelogname&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty&#x2F;nginx&#x2F;logs&#x2F;go_access$&#123;prestamp&#125;.log</span><br><span class="line">#prelogname&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty&#x2F;nginx&#x2F;logs&#x2F;go_access.log</span><br><span class="line">#每个月1号不生成</span><br><span class="line">premonstamp&#x3D;&#96;echo $&#123;prestamp:0:6&#125;&#96;</span><br><span class="line">#月度报表名称</span><br><span class="line">monreportname&#x3D;&#x2F;data&#x2F;web&#x2F;oldreport&#x2F;report$&#123;premonstamp&#125;.html</span><br><span class="line">#持久化磁盘路径</span><br><span class="line">disk_db_path&#x3D;&#x2F;tmp&#x2F;goaccess$&#123;premonstamp&#125;</span><br><span class="line">#将前一天生成日志文件追加到月度持久化磁盘里，并生成新的报表</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess $&#123;prelogname&#125; -o $&#123;monreportname&#125; --load-from-disk --db-path&#x3D;$&#123;disk_db_path&#125;  --keep-db-files --date-format&#x3D;&#39;%d&#x2F;%b&#x2F;%Y&#39; --log-format&#x3D;&#39;%h %^[%d:%t %^] &quot;%r&quot; %s %b&#39; --time-format&#x3D;&#39;%H:%M:%S&#39;</span><br></pre></td></tr></table></figure>
<p>生成的报表样式如下：<br><img src="https://i.imgur.com/riWKoHG.png" alt=""></p>
<h4 id="7、每天凌晨定时生成新一天的报表，但是不建议持久化到磁盘，因为一旦中途进程挂掉，需要清空日志文件，如果不清空日志文件再次启动的话，会重复加载已经存在的数据。"><a href="#7、每天凌晨定时生成新一天的报表，但是不建议持久化到磁盘，因为一旦中途进程挂掉，需要清空日志文件，如果不清空日志文件再次启动的话，会重复加载已经存在的数据。" class="headerlink" title="7、每天凌晨定时生成新一天的报表，但是不建议持久化到磁盘，因为一旦中途进程挂掉，需要清空日志文件，如果不清空日志文件再次启动的话，会重复加载已经存在的数据。"></a>7、每天凌晨定时生成新一天的报表，但是不建议持久化到磁盘，因为一旦中途进程挂掉，需要清空日志文件，如果不清空日志文件再次启动的话，会重复加载已经存在的数据。</h4><p>cat /etc/crontab |grep sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 00 * * * root source &#x2F;etc&#x2F;profile &amp;&amp; sh &#x2F;root&#x2F;test.sh</span><br></pre></td></tr></table></figure>
<p>每天定时关闭goaccess并重新启动，将数据持久化到磁盘<br>cat /root/test.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">stamp&#x3D;&#96;date +&#39;%Y%m%d&#39;&#96;</span><br><span class="line">logname&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty&#x2F;nginx&#x2F;logs&#x2F;go_access.log</span><br><span class="line">reportname&#x3D;&#x2F;data&#x2F;web&#x2F;report&#x2F;report$&#123;stamp&#125;.html</span><br><span class="line">ps -ef|grep &#39;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess&#39;|grep -v grep |awk  &#39;&#123;print $2&#125;&#39; |xargs kill</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess $&#123;logname&#125; -o $&#123;reportname&#125; --log-format&#x3D;COMBINED  --real-time-html --daemonize</span><br></pre></td></tr></table></figure>

<h4 id="8、生成前一天的历史报表-在日志文件每天定时切割的情况下，如果不按天切割将无法生成前一天的报表"><a href="#8、生成前一天的历史报表-在日志文件每天定时切割的情况下，如果不按天切割将无法生成前一天的报表" class="headerlink" title="8、生成前一天的历史报表(在日志文件每天定时切割的情况下，如果不按天切割将无法生成前一天的报表)"></a>8、生成前一天的历史报表(在日志文件每天定时切割的情况下，如果不按天切割将无法生成前一天的报表)</h4><p>cat /etc/crontab |grep sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 01 * * * root source &#x2F;etc&#x2F;profile &amp;&amp; sh &#x2F;root&#x2F;test.sh</span><br></pre></td></tr></table></figure>
<p>cat /root/test.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">prestamp&#x3D;&#96;date -d &#39;1 day ago&#39; +&#39;%Y%m%d&#39;&#96; </span><br><span class="line">prelogname&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty&#x2F;nginx&#x2F;logs&#x2F;go_access$&#123;prestamp&#125;.log</span><br><span class="line">#prelogname&#x3D;&#x2F;usr&#x2F;local&#x2F;openresty&#x2F;nginx&#x2F;logs&#x2F;go_access.log</span><br><span class="line">prereportname&#x3D;&#x2F;data&#x2F;web&#x2F;report&#x2F;report$&#123;prestamp&#125;.html</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess $&#123;prelogname&#125; -o $&#123;prereportname&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9、下面列举一些单独的命令生成自己需要的报表"><a href="#9、下面列举一些单独的命令生成自己需要的报表" class="headerlink" title="9、下面列举一些单独的命令生成自己需要的报表"></a>9、下面列举一些单独的命令生成自己需要的报表</h4><p>实时报表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess &#x2F;usr&#x2F;local&#x2F;openresty&#x2F;nginx&#x2F;logs&#x2F;go_access.log -o &#x2F;data&#x2F;web&#x2F;report&#x2F;report20181204.html --log-format&#x3D;COMBINED  --real-time-html  --daemonize</span><br></pre></td></tr></table></figure>
<p>增量追加持久化数据，将日志加载到磁盘，不使用配置文件（命令行指定）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess &#x2F;tmp&#x2F;api_access.log --load-from-disk --db-path&#x3D;&#x2F;tmp&#x2F;goaccess  --keep-db-files --debug-file&#x3D;&#x2F;tmp&#x2F;goaccess.log --date-format&#x3D;&#39;%d&#x2F;%b&#x2F;%Y&#39; --log-format&#x3D;&#39;%h %^[%d:%t %^] &quot;%r&quot; %s %b&#39; --time-format&#x3D;&#39;%H:%M:%S&#39;</span><br></pre></td></tr></table></figure>
<p>增量追加持久化数据，将日志加载到磁盘，同时输出到html表（添加-o 参数，指定输出html）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess &#x2F;tmp&#x2F;api_access.log -o &#x2F;data&#x2F;web&#x2F;oldreport&#x2F;oldreport20181205.html --load-from-disk --db-path&#x3D;&#x2F;tmp&#x2F;goaccess  --keep-db-files --debug-file&#x3D;&#x2F;tmp&#x2F;goaccess.log --date-format&#x3D;&#39;%d&#x2F;%b&#x2F;%Y&#39; --log-format&#x3D;&#39;%h %^[%d:%t %^] &quot;%r&quot; %s %b&#39; --time-format&#x3D;&#39;%H:%M:%S&#39;</span><br></pre></td></tr></table></figure>
<p>添加到后台运行（因为没有–real-time-html使用–daemonize是不生效的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess &#x2F;tmp&#x2F;api_access.log -o &#x2F;data&#x2F;web&#x2F;oldreport&#x2F;oldreport20181205.html --load-from-disk --db-path&#x3D;&#x2F;tmp&#x2F;goaccess  --keep-db-files --debug-file&#x3D;&#x2F;tmp&#x2F;goaccess.log --date-format&#x3D;&#39;%d&#x2F;%b&#x2F;%Y&#39; --log-format&#x3D;&#39;%h %^[%d:%t %^] &quot;%r&quot; %s %b&#39; --time-format&#x3D;&#39;%H:%M:%S&#39; &amp;</span><br></pre></td></tr></table></figure>
<p>对已经持久化的数据，使用-o参数生成报表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;goaccess -o &#x2F;data&#x2F;web&#x2F;oldreport&#x2F;oldreport20181205.html --log-format&#x3D;COMBINED  --keep-db-files --db-path&#x3D;&#x2F;tmp&#x2F;goaccess --load-from-disk</span><br></pre></td></tr></table></figure>

<h4 id="10、使用过程遇到的问题"><a href="#10、使用过程遇到的问题" class="headerlink" title="10、使用过程遇到的问题"></a>10、使用过程遇到的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、在goaccess后台运行并且开启持久化的情况下，不能使用kill -9 pid方法，使用这种方法杀掉进程会毁坏数据，可以使用kill pid的方法</span><br><span class="line">2、使用持久化功能，进程宕掉之后，重启进程需要清空日志文件中的数据，否则会把日志文件中的旧数据重复加载一遍。</span><br><span class="line">3、--daemonize添加守护进程，只用--real-time-html可用时生效</span><br><span class="line">4、使用real_time_html适时生效需要开启goaccess的端口默认为7890</span><br></pre></td></tr></table></figure>

<h4 id="11、goaccess-html参数详解"><a href="#11、goaccess-html参数详解" class="headerlink" title="11、goaccess html参数详解"></a>11、goaccess html参数详解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">General Statistics：此面板提供了几个指标的摘要，其中一些包括：有效和无效请求的数量，分析数据集所花费的时间，唯一访问者，请求的文件，静态文件（CSS，ICO，JPG等）HTTP引用，404s，已解析日志文件的大小和带宽消耗。</span><br><span class="line">Unique visitors（每日独立访客 - 包括网络机器人）：此面板显示点击次数，唯一身份访问者和每个日期的累积带宽等指标。包含相同IP，相同日期和相同用户代理的HTTP请求被视为唯一访问者。默认情况下，它包括网络爬虫&#x2F;蜘蛛。 可以使用--date-spec &#x3D; hr将日期特异性设置为小时级别，这将显示日期，例如05 &#x2F; Jun &#x2F; 2016：16。如果您想跟踪小时级别的每日流量，这非常棒。</span><br><span class="line">Requested files（请求的文件）：此面板显示Web服务器上请求最多的文件。它显示了匹配，唯一身份访问者和百分比，以及累积带宽，协议和使用的请求方法。</span><br><span class="line">Requested static files（请求的文件）：列出了最常用静态文件，如：JPG，CSS，SWF，JS，GIF，和PNG文件类型，使用相同的指标作为最后的面板一起。可以将其他静态文件添加到配置文件中。</span><br><span class="line">404 or Not Found（未找到的URLS）：显示与先前请求面板相同的指标，但是，其数据包含在服务器上找不到的所有页面，或通常称为404状态代码。</span><br><span class="line">Hosts（未找到的URLS）：此面板包含有关主机本身的详细信息。这非常适合发现×××性爬虫，并确定谁在吃你的带宽。 扩展面板可以显示更多信息，例如主机的反向DNS查找结果，原产国和城市。如果-a启用了参数，则可以通过选择所需的IP地址，然后按Enter来显示用户代理列表。</span><br><span class="line">Operating Systems（操作系统）：此面板将报告主机在到达服务器时使用的操作系统。它试图提供每个操作系统的最具体版本。</span><br><span class="line">Browsers（操作系统）：此面板将报告主机在访问服务器时使用的浏览器。它试图提供每个浏览器的最具体版本。</span><br><span class="line">Visit Times（时间分配）：此面板将显示每小时报告。此选项显示24个数据点，每天一小时一个。 可选地，可以使用--hour-spec &#x3D; min将小时特异性设置为十分之一水平，这将显示小时为16：4如果您想要发现服务器上的流量峰值，这很好。</span><br><span class="line">Virtual Hosts：此面板将显示从访问日志中解析的所有不同虚拟主机。如果在日志格式字符串中使用％v，则会显示此面板。</span><br><span class="line">Referrers URLs：如果相关主机通过其他资源访问了网站，或者是从其他主机链接转移给您，则会在此面板中提供引用它们的网址。请参阅&#96;--ignore-panel&#96;配置文件以启用它。 （默认禁用）</span><br><span class="line">Referring Sites（推荐网站）：此面板仅显示主机部分，但不显示整个URL。请求来自的URL。</span><br><span class="line">Keyphrases（谷歌搜索关键字）：它报告了用于Google搜索，Google缓存和Google翻译的关键字，这些关键字已导致您的网络服务器。目前，它仅通过HTTP支持Google搜索查询。请参阅&#96;--ignore-panel&#96;配置文件以启用它。 （默认禁用）</span><br><span class="line">Geo Location（地理位置）：确定IP地址在地理位置的位置。统计数据按大陆和国家分列。它需要使用GeoLocation支持进行编译。</span><br><span class="line">HTTP Status Codes（HTTP状态码）：HTTP请求的数字状态代码的值。</span><br><span class="line">Remote User (HTTP authentication)：这是HTTP身份验证确定的请求文档的人员的用户ID。如果文档没有密码保护，则此部分将为“ - ”，就像前一个部分一样。除非%e在log-format变量中给出，否则不会启用此面板。</span><br><span class="line">--real-os</span><br><span class="line">展示真实的操作系统。在Operation System模块中，是否展示更详细的操作系统信息。</span><br></pre></td></tr></table></figure>
<h4 id="12、goaccess与nginx日志格式日常转换表"><a href="#12、goaccess与nginx日志格式日常转换表" class="headerlink" title="12、goaccess与nginx日志格式日常转换表"></a>12、goaccess与nginx日志格式日常转换表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nginx               goaccess</span><br><span class="line">$time_local         %d:%t %^</span><br><span class="line">$host               %v</span><br><span class="line">$http_host          %v</span><br><span class="line">$remote_addr        %h</span><br><span class="line">$request_time       %T</span><br><span class="line">$request_method     %m</span><br><span class="line">$request_uri        %U</span><br><span class="line">$server_protocol    %H</span><br><span class="line">$request            %r</span><br><span class="line">$status             %s</span><br><span class="line">$body_bytes_sent    %b</span><br><span class="line">$bytes_sent         %b</span><br><span class="line">$http_referer       %R</span><br><span class="line">$http_user_agent    %u</span><br></pre></td></tr></table></figure>
<p>如果找不到对应的格式可以使用“%^”–Ignore this field，来忽略那一部分</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/02/14/goaccess安装/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/02/14/oracle-DB_NAME、DB_UNIQUE_NAME、GLOBAL_NAME、INSTANCE_NAME、SERVICE_NAME详解/"><span>[Oracle] oracle-DB_NAME、DB_UNIQUE_NAME、GLOBAL_NAME、INSTANCE_NAME、SERVICE_NAME详解</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/02/14/oracle-DB_NAME、DB_UNIQUE_NAME、GLOBAL_NAME、INSTANCE_NAME、SERVICE_NAME详解/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-14T08:01:00.000Z">
          2019-02-14
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、DB-NAME"><a href="#1、DB-NAME" class="headerlink" title="1、DB_NAME"></a>1、DB_NAME</h4><p>DB_NAME:指定最多8个字符的数据库连接标识符。rac环境每个实例都要配置该值，且每个实例的值必须相同。如果存在从库，主库和从库的db_name要相同。</p>
<h4 id="2、DB-UNIQUE-NAME"><a href="#2、DB-UNIQUE-NAME" class="headerlink" title="2、DB_UNIQUE_NAME"></a>2、DB_UNIQUE_NAME</h4><p>db_unique_name：数据库全局唯一名称。如果没有修改，默认情况下，数据库实例对应的名称为db_name。<br>oracle asm实例对应的名称为：+ASM。<br>rac各实例的对应的该值必须相同。<br>对于adg环境，主从具有相同的db_name，db_domain，但是必须保证db_unique_name不同，主从库有自己唯一的db_unique_name。最多设置30个字符。</p>
<h4 id="3、GLOBAL-NAME"><a href="#3、GLOBAL-NAME" class="headerlink" title="3、GLOBAL_NAME"></a>3、GLOBAL_NAME</h4><p>global_names：指定dblink是否需要和所要连接的远程库服务名称（service_names）一样，如果为false则不检查。<br>如果计划使用分布式处理，建议将该参数设为true，在一个网络环境下来确定数据库和连接的一致性命名规范。<br>该值为fasle|true影响的只是本机，远程库的global_names值为true|false对本机使用dblink的查询没有任何影响。<br>如果该值设置为true，dblink名称与service_name名称不一致则会报错ora-02085，实验如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SYS@ boston&gt; alter system set global_names&#x3D;true;</span><br><span class="line">SYS@ boston&gt; create database link oibs1 connect to test identified by oracle using &#39;oibs1&#39;;</span><br><span class="line">Database link created.</span><br><span class="line">SYS@ boston&gt; select * from t1@oibs1;</span><br><span class="line">	ID</span><br><span class="line">----------</span><br><span class="line">	 1</span><br><span class="line">	 2</span><br><span class="line">SYS@ boston&gt; create database link oibs connect to test identified by oracle using &#39;oibs1&#39;;</span><br><span class="line">Database link created.</span><br><span class="line">Elapsed: 00:00:00.03</span><br><span class="line">SYS@ boston&gt; select * from t1@oibs;</span><br><span class="line">select * from t1@oibs</span><br><span class="line">             *</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-02085: database link OIBS connects to OIBS1</span><br></pre></td></tr></table></figure>
<h4 id="4、INSTANCE-NAME"><a href="#4、INSTANCE-NAME" class="headerlink" title="4、INSTANCE_NAME"></a>4、INSTANCE_NAME</h4><p>instance_name：实例名，rac环境下，多个实例可以关联一个单独的数据服务。客户端可以通过指定一个特殊的实例来做负载均衡。<br>一个单实例的数据系统，实例名与数据库名相同。<br>tnsname.ora下的连接如果使用SID时要与该值相同。</p>
<h4 id="5、SERVICE-NAMES"><a href="#5、SERVICE-NAMES" class="headerlink" title="5、SERVICE_NAMES"></a>5、SERVICE_NAMES</h4><p>service_names：默认值为db_unique_name.db_domain。<br>在rac环境下不要通过sqlplus设置service_names参数，如果需要设置该参数，通过oracle EM和srvctl配置。<br>tnsname.ora下的连接如果使用SERVICE_NAME时要与该值相同。</p>
<h5 id="5-1、默认db-domain值为空的情况下，测试修改service-names"><a href="#5-1、默认db-domain值为空的情况下，测试修改service-names" class="headerlink" title="5.1、默认db_domain值为空的情况下，测试修改service_names"></a>5.1、默认db_domain值为空的情况下，测试修改service_names</h5><p>因此service_names=db_unique_name，单实例手动设置service_names，检查service_names</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">18:50:14 SYS@ boston&gt; show parameter service_names</span><br><span class="line">NAME				     TYPE	 VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">service_names			     string	 boston</span><br></pre></td></tr></table></figure>
<p>修改service_names</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">19:56:42 SYS@ boston&gt; alter system set service_names&#x3D;&#39;chicago.us.oracle&#39;;</span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:00.23</span><br></pre></td></tr></table></figure>
<p>查看service_names已修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">19:56:56 SYS@ boston&gt; show parameter service_names</span><br><span class="line">NAME				     TYPE	 VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">service_names			     string	 chicago.us.oracle</span><br></pre></td></tr></table></figure>
<p>此时查看监听，新增了chicago.us.oracle的服务，原来boston的服务名并没有被覆盖掉：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[oracle@dax-mysql-slave admin]$ lsnrctl status</span><br><span class="line">......</span><br><span class="line">  (DESCRIPTION&#x3D;(ADDRESS&#x3D;(PROTOCOL&#x3D;tcp)(HOST&#x3D;dax-mysql-slave)(PORT&#x3D;1521)))</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;boston&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;bostonXDB&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;chicago.us.oracle&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">The command completed successfully</span><br></pre></td></tr></table></figure>
<p>再次修改service_names</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">19:56:59 SYS@ boston&gt; alter system set service_names&#x3D;&#39;chicago.us.oracle.com&#39;;</span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:00.12</span><br></pre></td></tr></table></figure>
<p>查看监听</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[oracle@dax-mysql-slave admin]$ lsnrctl status</span><br><span class="line">......</span><br><span class="line">  (DESCRIPTION&#x3D;(ADDRESS&#x3D;(PROTOCOL&#x3D;tcp)(HOST&#x3D;dax-mysql-slave)(PORT&#x3D;1521)))</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;boston&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;bostonXDB&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;chicago.us.oracle.com&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">The command completed successfully</span><br></pre></td></tr></table></figure>
<p>chicago.us.oracle的服务名被替代为chicago.us.oracle.com</p>
<h5 id="5-2、在db-domain存在的情况下-如果没有，可以自己修改，修改该值需要重启库"><a href="#5-2、在db-domain存在的情况下-如果没有，可以自己修改，修改该值需要重启库" class="headerlink" title="5.2、在db_domain存在的情况下(如果没有，可以自己修改，修改该值需要重启库)"></a>5.2、在db_domain存在的情况下(如果没有，可以自己修改，修改该值需要重启库)</h5><p>先修改db_domain值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">22:18:05 SYS@ boston&gt; alter system set db_domain&#x3D;&#39;us.oracle.cn&#39; scope&#x3D;spfile;</span><br><span class="line">System altered.</span><br><span class="line">22:18:22 SYS@ boston&gt; shutdown immediate</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">22:18:38 SYS@ boston&gt; startup</span><br><span class="line">ORACLE instance started.</span><br><span class="line">Total System Global Area 1603411968 bytes</span><br><span class="line">Fixed Size		    2253664 bytes</span><br><span class="line">Variable Size		  503319712 bytes</span><br><span class="line">Database Buffers	 1090519040 bytes</span><br><span class="line">Redo Buffers		    7319552 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line">22:19:36 SYS@ boston&gt; show parameter db_domain</span><br><span class="line">NAME				     TYPE	 VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">db_domain			     string	 us.oracle.cn</span><br></pre></td></tr></table></figure>
<p>修改service_names，在不指定后缀的情况下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">22:45:57 SYS@ boston&gt; alter system set service_names&#x3D;&#39;chicago&#39;;</span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:00.11</span><br><span class="line">22:46:45 SYS@ boston&gt; show parameter name</span><br><span class="line">NAME				     TYPE	 VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">service_names			     string	 chicago</span><br><span class="line"></span><br><span class="line">[oracle@dax-mysql-slave admin]$ lsnrctl status</span><br><span class="line">......</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;boston.us.oracle.cn&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;bostonXDB.us.oracle.cn&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;chicago.us.oracle.cn&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">The command completed successfully</span><br></pre></td></tr></table></figure>
<p>监听的服务名自动添加了db_domain,服务名变为了chicago.us.oracle.cn<br>当修改的service_names自己添加了其他的domian，那么系统自带的db_domain就不会覆盖了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">22:46:49 SYS@ boston&gt; alter system set service_names&#x3D;&#39;chicago.cn.oracle.com&#39;;</span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:00.15</span><br><span class="line">22:48:40 SYS@ boston&gt; show parameter name</span><br><span class="line">NAME				     TYPE	 VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">service_names			     string	 chicago.cn.oracle.com</span><br><span class="line">[oracle@dax-mysql-slave admin]$ lsnrctl status</span><br><span class="line">.....</span><br><span class="line">Services Summary...</span><br><span class="line">Service &quot;boston.us.oracle.cn&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;bostonXDB.us.oracle.cn&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">Service &quot;chicago.cn.oracle.com&quot; has 1 instance(s).</span><br><span class="line">  Instance &quot;boston&quot;, status READY, has 1 handler(s) for this service...</span><br><span class="line">The command completed successfully</span><br></pre></td></tr></table></figure>
<p>监听的service_names为chicago.cn.oracle.com，而不是chicago.us.oracle.com</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/02/14/oracle-DB_NAME、DB_UNIQUE_NAME、GLOBAL_NAME、INSTANCE_NAME、SERVICE_NAME详解/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/02/13/cassandra使用nodetool decommission之后发现丢失数据的解决办法/"><span>[Cassandra] cassandra使用nodetool decommission之后发现丢失数据的解决办法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/02/13/cassandra使用nodetool decommission之后发现丢失数据的解决办法/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-13T06:12:00.000Z">
          2019-02-13
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、故事背景"><a href="#1、故事背景" class="headerlink" title="1、故事背景"></a>1、故事背景</h4><p>当某一个节点执行nodetool decommission时，这个节点会被退役，该节点上的数据会流到其他正在活动的节点，但是该节点上的数据不会被清除，会保留在数据文件下。当发现剩余的的节点下未完全同步该退役的节点，可使用以下办法尝试去恢复数据。<br>被退役节点为（A），活动节点为（B）</p>
<h4 id="2、尝试重新启动A节点，报错如下："><a href="#2、尝试重新启动A节点，报错如下：" class="headerlink" title="2、尝试重新启动A节点，报错如下："></a>2、尝试重新启动A节点，报错如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">This node was decommissioned and will not rejoin the ring unless cassandra.override_decommission&#x3D;true has been set, or all existing data is removed and th</span><br><span class="line">e node is bootstrapped again</span><br><span class="line">Fatal configuration error; unable to start server.  See log for stacktrace.</span><br><span class="line">ERROR [main] 2019-02-12 06:03:30,000 CassandraDaemon.java:749 - Fatal configuration error</span><br><span class="line">org.apache.cassandra.exceptions.ConfigurationException: This node was decommissioned and will not rejoin the ring unless cassandra.override_decommission&#x3D;t</span><br><span class="line">rue has been set, or all existing data is removed and the node is bootstrapped again</span><br></pre></td></tr></table></figure>
<h4 id="3、报错提示要么删除目录下的所有数据，要么使用override-decommission-true参数启动，下面以添加参数启动，启动正常，启动命令："><a href="#3、报错提示要么删除目录下的所有数据，要么使用override-decommission-true参数启动，下面以添加参数启动，启动正常，启动命令：" class="headerlink" title="3、报错提示要么删除目录下的所有数据，要么使用override_decommission=true参数启动，下面以添加参数启动，启动正常，启动命令："></a>3、报错提示要么删除目录下的所有数据，要么使用override_decommission=true参数启动，下面以添加参数启动，启动正常，启动命令：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cassandra -Dcassandra.override_decommission&#x3D;true -R</span><br></pre></td></tr></table></figure>
<h4 id="4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来"><a href="#4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来" class="headerlink" title="4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来"></a>4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cdax@cqlsh&gt; desc keyspaces;</span><br><span class="line">system_auth system_distributed system_schema  system system_traces</span><br></pre></td></tr></table></figure>
<h4 id="5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件："><a href="#5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件：" class="headerlink" title="5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件："></a>5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sstableloader -d 127.0.0.1 &#x2F;tmp&#x2F;test&#x2F;trade_event-8d5d68508fe211e88a9ca166a7412712</span><br></pre></td></tr></table></figure>
<h4 id="6、提示当前节点下不存在test-trade-event表，需要自己先手动创建该表，去B节点上执行desc-test-trade-event-查看建表语句，重新在A节点创建该表。"><a href="#6、提示当前节点下不存在test-trade-event表，需要自己先手动创建该表，去B节点上执行desc-test-trade-event-查看建表语句，重新在A节点创建该表。" class="headerlink" title="6、提示当前节点下不存在test.trade_event表，需要自己先手动创建该表，去B节点上执行desc test_trade_event,查看建表语句，重新在A节点创建该表。"></a>6、提示当前节点下不存在test.trade_event表，需要自己先手动创建该表，去B节点上执行desc test_trade_event,查看建表语句，重新在A节点创建该表。</h4><p>创建完成之后再次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sstableloader -d 127.0.0.1 &#x2F;tmp&#x2F;test&#x2F;trade_event-8d5d68508fe211e88a9ca166a7412712</span><br></pre></td></tr></table></figure>
<h4 id="7、文件下的数据全部导入test-trade-event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下："><a href="#7、文件下的数据全部导入test-trade-event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下：" class="headerlink" title="7、文件下的数据全部导入test.trade_event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下："></a>7、文件下的数据全部导入test.trade_event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy trade_event to &#39;&#x2F;tmp&#x2F;trade_event.sql&#39; with header&#x3D;true;</span><br></pre></td></tr></table></figure>
<h4 id="8、恢复之前须知："><a href="#8、恢复之前须知：" class="headerlink" title="8、恢复之前须知："></a>8、恢复之前须知：</h4><p>copy from操作并不会覆盖掉以前所有旧的数据，只会将A节点存在，B节点不存的数据导入到B节点。但是如果是B和A两个节点主键相同，其他字段数据不同，使用copy from的情况下，A节点的数据会覆盖掉B节点的数据。<br>因为我们decommission节点之后，启动应用发现缺少数据，导致应用无法起来，这种情况下B节点没有最新数据插入，因此可以执行copy from操作。如果无法确定B节点是否有新的数据插入，建议先根据某个表对应的时间戳先校验，确保没有最新数据插入的情况下，再使用上面的方法执行。</p>
<h4 id="9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy-from操作将数据恢复："><a href="#9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy-from操作将数据恢复：" class="headerlink" title="9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy from操作将数据恢复："></a>9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy from操作将数据恢复：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY trade_event FROM &#39;&#x2F;home&#x2F;test&#x2F;trade_event.sql&#39; WITH HEADER &#x3D; TRUE ;</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/cassandra/">cassandra</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/02/13/cassandra使用nodetool decommission之后发现丢失数据的解决办法/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/30/mysql into outfile数据导出/"><span>[Mysql] SELECT ... INTO OUTFILE &#39;file_name&#39;将查询到的数据写入文件</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/30/mysql into outfile数据导出/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-30T09:36:00.000Z">
          2019-01-30
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、生成的文件会在server主机端，因此mysql必须有指定file-name文件所在目录的权限，另外file-name文件必须是不存在的，防止其他数据文件被破坏。"><a href="#1、生成的文件会在server主机端，因此mysql必须有指定file-name文件所在目录的权限，另外file-name文件必须是不存在的，防止其他数据文件被破坏。" class="headerlink" title="1、生成的文件会在server主机端，因此mysql必须有指定file_name文件所在目录的权限，另外file_name文件必须是不存在的，防止其他数据文件被破坏。"></a>1、生成的文件会在server主机端，因此mysql必须有指定file_name文件所在目录的权限，另外file_name文件必须是不存在的，防止其他数据文件被破坏。</h4><p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin into outfile &#39;d:&#x2F;admin.xls&#39;</span><br></pre></td></tr></table></figure>
<h4 id="2、使用SELECT-…-INTO-OUTFILE-‘file-name’方式导出数据文件是受参数secure-file-priv控制的-不同值管理着数据是否能正常导出"><a href="#2、使用SELECT-…-INTO-OUTFILE-‘file-name’方式导出数据文件是受参数secure-file-priv控制的-不同值管理着数据是否能正常导出" class="headerlink" title="2、使用SELECT … INTO OUTFILE ‘file_name’方式导出数据文件是受参数secure_file_priv控制的,不同值管理着数据是否能正常导出"></a>2、使用SELECT … INTO OUTFILE ‘file_name’方式导出数据文件是受参数secure_file_priv控制的,不同值管理着数据是否能正常导出</h4><h5 id="2-1、secure-file-priv参数值（静态参数，修改必须重启mysql"><a href="#2-1、secure-file-priv参数值（静态参数，修改必须重启mysql" class="headerlink" title="2.1、secure_file_priv参数值（静态参数，修改必须重启mysql):"></a>2.1、secure_file_priv参数值（静态参数，修改必须重启mysql):</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果该值为空，对导出没有限制，这是不安全的设置</span><br><span class="line">如果该值指定了某一个目录，那么导入导出数据操作只能在这个目录下操作，而且指定的目录必须是存在的，mysql服务不能够自动创建。</span><br><span class="line">如果该值为null，那么当前数据库不允许导入导出</span><br></pre></td></tr></table></figure>
<h5 id="2-2、查看参数值"><a href="#2-2、查看参数值" class="headerlink" title="2.2、查看参数值"></a>2.2、查看参数值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@db 02:48:  [(none)]&gt; show variables like &#39;%secure_file%&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv | NULL  |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">root@db 02:48:  [test]&gt; select * from t1;</span><br><span class="line">+----+</span><br><span class="line">| c1 |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在值为null的时候是不允许导出数据的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 02:48:  [test]&gt; select * from t1 into outfile &#39;&#x2F;tmp&#x2F;t1.xls&#39;;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure>
<h5 id="2-3、修改secure-file-priv的值"><a href="#2-3、修改secure-file-priv的值" class="headerlink" title="2.3、修改secure_file_priv的值"></a>2.3、修改secure_file_priv的值</h5><p>在my.cnf配置文件下添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv&#x3D;&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv&#x3D;&#39;&#x2F;tmp&#39;</span><br></pre></td></tr></table></figure>
<p>并重启数据库,指定的目录必须存在，否则无法启动数据库<br>不能直接通过set global参数修改，修改会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 02:49:  [test]&gt; set global secure_file_priv&#x3D;&#39;&#x2F;data&#x2F;test&#39;;</span><br><span class="line">ERROR 1238 (HY000): Variable &#39;secure_file_priv&#39; is a read only variable</span><br></pre></td></tr></table></figure>
<p>重启完之后，查看secure参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 03:08:  [(none)]&gt; show variables like &#39;%secure_file%&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv | &#x2F;tmp&#x2F; |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>
<h4 id="3、导出查询数据"><a href="#3、导出查询数据" class="headerlink" title="3、导出查询数据"></a>3、导出查询数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 04:16:  [test]&gt; select * from mysql.user into outfile &#39;&#x2F;tmp&#x2F;user.xls&#39;;</span><br><span class="line">Query OK, 5 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>如果导出的目录不是secure_file_priv指定的目录，报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 00:17:  [test]&gt; select * from t1 into outfile &#39;&#x2F;data&#x2F;t1.xls&#39;;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/30/mysql into outfile数据导出/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/29/mysql create table ... 指定外部数据目录(File-per-table tablespace)/"><span>[Mysql] create table ... data directory指定外部数据目录(单表文件表空间)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/29/mysql create table ... 指定外部数据目录(File-per-table tablespace)/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-29T07:30:00.000Z">
          2019-01-29
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、使用create-table-…-data-directory"><a href="#1、使用create-table-…-data-directory" class="headerlink" title="1、使用create table … data directory"></a>1、使用create table … data directory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@db 18:15:  [(none)]&gt; use test</span><br><span class="line">Database changed</span><br><span class="line">root@db 18:16:  [test]&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| t1             |</span><br><span class="line">| t4             |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>指定的目录对于mysql的用户来说一定要有访问权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master test]# ll -d &#x2F;tmp&#x2F;</span><br><span class="line">drwxrwxrwt. 10 root root 4096 2月  11 20:54 &#x2F;tmp&#x2F;</span><br></pre></td></tr></table></figure>
<p>执行创建表语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 18:41:  [test]&gt; CREATE TABLE t2 (c1 INT PRIMARY KEY) DATA DIRECTORY &#x3D; &#39;&#x2F;tmp&#x2F;&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.60 sec)</span><br></pre></td></tr></table></figure>
<p>表创建完成之后，会在directory对应的目录下创建表对应的schema的目录，并在schema的目录下生成.ibd表文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master test]# ll &#x2F;tmp&#x2F;test&#x2F;t2*</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 2月  11 18:41 &#x2F;tmp&#x2F;test&#x2F;t2.ibd</span><br></pre></td></tr></table></figure>
<p>在mysql的数据目录下会生成.frm文件和.isl文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master test]# ll &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t2*</span><br><span class="line">-rw-r----- 1 mysql mysql 8556 2月  11 18:41 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t2.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   16 2月  11 18:41 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t2.isl</span><br></pre></td></tr></table></figure>
<h4 id="2、使用create-table-…-tablespace-data-directory"><a href="#2、使用create-table-…-tablespace-data-directory" class="headerlink" title="2、使用create table … tablespace .. data directory"></a>2、使用create table … tablespace .. data directory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 18:41:  [test]&gt;  CREATE TABLE t3 (c1 INT PRIMARY KEY) TABLESPACE &#x3D; innodb_file_per_table DATA DIRECTORY &#x3D; &#39;&#x2F;tmp&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.33 sec)</span><br><span class="line">[root@dax-mysql-master test]#  ll &#x2F;tmp&#x2F;test&#x2F;t3*</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 2月  11 22:16 &#x2F;tmp&#x2F;test&#x2F;t3.ibd</span><br><span class="line">[root@dax-mysql-master test]#  ll &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t3*</span><br><span class="line">-rw-r----- 1 mysql mysql 8556 2月  11 22:16 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t3.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   16 2月  11 22:16 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t3.isl</span><br></pre></td></tr></table></figure>
<p>执行结果与章节1相同。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/29/mysql create table ... 指定外部数据目录(File-per-table tablespace)/"><span>点击阅读</span></a></h3>
    
  
</article>






<nav class="pagination">
  
  <a href="/page/6/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/8/" class="pagination-next">下一页</a>
  
</nav>
            </main>
            <div class="sidebar
                    col-lg-3 col-lg-offset-0
                    col-md-3 col-md-offset-0
                    col-sm-12
                    col-xs-12
                    sidebar-container
                ">

                <div class="sidebar-container">



<div class="search-container">
<form class="site-search-form">
    <span class="glyphicon glyphicon-search"></span><input type="text" id="local-search-input" class="st-search-input" placeholder="Search..." />
</form>
<div id="local-search-result" class="local-search-result-cls"></div>
</div>
<script type="text/javascript" id="local.search.active">
var inputArea       = document.querySelector("#local-search-input");
inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script>




    <div class="categories-container" style="margin-top:40px;">
        <p>归档:</p>
            
    </div>




    <div class="social-container" style="margin-top:40px;">
        <p>Links:</p>
            
                
                    <li class="social-item"><i class="fa fa-fw fa-github"></i><a href="https://github.com/zeven0707">GitHub</a></li>
                
            
    </div>

</div>
            </div>
          </div>
        </div>
        
    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/BosenY/Lap" target="_blank">Lap</a>
    <br/><span id="busuanzi_container_site_uv"> 
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    </br>
    
      
        &copy; 2020 zeven0707&#39;s blog
      
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92842840-1', 'auto');
    ga('send', 'pageview');

</script>


  </div>

</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/draw-something/dist/draw.min.js"></script>
  <script>
    let maxNum = Number.parseInt('30')
    let iconText = '❤'
    let color = 'red'
    new Draw({maxNum, iconText, color})
  </script>

<script src="/js/index.js"></script>
<script src="/js/search.js"></script>

</body>
</html>