<!DOCTYPE HTML>
<html>
<head >
  <meta charset="utf-8">
  
  <title>第 8 页 | zeven&#39;s blog</title>

  
  <meta name="author" content="zeven0707&#39;s blog">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="zeven&#39;s blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  
  
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5005349780815724",
    enable_page_level_ads: true
  });
</script>

  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?223eea22355699157e147870eb124b24";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <link rel="manifest" href="/manifest.json">
  <link href="/favicon.ico" rel="icon">

  <link rel="alternate" href="/atom.xml" title="zeven&#39;s blog" type="application/atom+xml">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">


</head>


<body>
<div class="blog">
  <div class="content">

    

    <header class="header-container" style="background-image: url('/images/blog-bg.jpg');">


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header page-scroll">
          <button type="button" id="tglBtn" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">zeven0707&#39;s blog</a>
        </div>
        <div id="bosenyblog-navbar">
          <div class="navbar-collapse" id="bs-example-navbar-collapse-6">
            <ul class="nav navbar-nav navbar-right">
            
              <li><a href="/">主页</a></li>
            
              <li><a href="/archives">日志</a></li>
            
              <li><a href="/about">关于</a></li>
            
              <li><a href="/tags">标签</a></li>
            
            </ul>
          </div>
        </div>

    </div>
 </nav>
 <div class="gotop-btn">

 </div>
</header>

        
        <div class="container ">
          <div class="row">
            <main class="site-main posts-loop    col-lg-8 col-lg-offset-1
                    col-md-8 col-md-offset-1
                    col-sm-12
                    col-xs-12">
            
  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/02/13/cassandra使用nodetool decommission之后发现丢失数据的解决办法/"><span>[Cassandra] cassandra使用nodetool decommission之后发现丢失数据的解决办法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/02/13/cassandra使用nodetool decommission之后发现丢失数据的解决办法/" rel="bookmark">
        <time class="entry-date published" datetime="2019-02-13T06:12:00.000Z">
          2019-02-13
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、故事背景"><a href="#1、故事背景" class="headerlink" title="1、故事背景"></a>1、故事背景</h4><p>当某一个节点执行nodetool decommission时，这个节点会被退役，该节点上的数据会流到其他正在活动的节点，但是该节点上的数据不会被清除，会保留在数据文件下。当发现剩余的的节点下未完全同步该退役的节点，可使用以下办法尝试去恢复数据。<br>被退役节点为（A），活动节点为（B）</p>
<h4 id="2、尝试重新启动A节点，报错如下："><a href="#2、尝试重新启动A节点，报错如下：" class="headerlink" title="2、尝试重新启动A节点，报错如下："></a>2、尝试重新启动A节点，报错如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">This node was decommissioned and will not rejoin the ring unless cassandra.override_decommission&#x3D;true has been set, or all existing data is removed and th</span><br><span class="line">e node is bootstrapped again</span><br><span class="line">Fatal configuration error; unable to start server.  See log for stacktrace.</span><br><span class="line">ERROR [main] 2019-02-12 06:03:30,000 CassandraDaemon.java:749 - Fatal configuration error</span><br><span class="line">org.apache.cassandra.exceptions.ConfigurationException: This node was decommissioned and will not rejoin the ring unless cassandra.override_decommission&#x3D;t</span><br><span class="line">rue has been set, or all existing data is removed and the node is bootstrapped again</span><br></pre></td></tr></table></figure>
<h4 id="3、报错提示要么删除目录下的所有数据，要么使用override-decommission-true参数启动，下面以添加参数启动，启动正常，启动命令："><a href="#3、报错提示要么删除目录下的所有数据，要么使用override-decommission-true参数启动，下面以添加参数启动，启动正常，启动命令：" class="headerlink" title="3、报错提示要么删除目录下的所有数据，要么使用override_decommission=true参数启动，下面以添加参数启动，启动正常，启动命令："></a>3、报错提示要么删除目录下的所有数据，要么使用override_decommission=true参数启动，下面以添加参数启动，启动正常，启动命令：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cassandra -Dcassandra.override_decommission&#x3D;true -R</span><br></pre></td></tr></table></figure>
<h4 id="4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来"><a href="#4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来" class="headerlink" title="4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来"></a>4、但是启动完成之后发现，只存在system相关的keyspaces，其它数据没办法加载出来</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cdax@cqlsh&gt; desc keyspaces;</span><br><span class="line">system_auth system_distributed system_schema  system system_traces</span><br></pre></td></tr></table></figure>
<h4 id="5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件："><a href="#5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件：" class="headerlink" title="5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件："></a>5、因为要恢复的keyspace–“test”数据目录存在，尝试使用sstableloader去加载数据文件：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sstableloader -d 127.0.0.1 &#x2F;tmp&#x2F;test&#x2F;trade_event-8d5d68508fe211e88a9ca166a7412712</span><br></pre></td></tr></table></figure>
<h4 id="6、提示当前节点下不存在test-trade-event表，需要自己先手动创建该表，去B节点上执行desc-test-trade-event-查看建表语句，重新在A节点创建该表。"><a href="#6、提示当前节点下不存在test-trade-event表，需要自己先手动创建该表，去B节点上执行desc-test-trade-event-查看建表语句，重新在A节点创建该表。" class="headerlink" title="6、提示当前节点下不存在test.trade_event表，需要自己先手动创建该表，去B节点上执行desc test_trade_event,查看建表语句，重新在A节点创建该表。"></a>6、提示当前节点下不存在test.trade_event表，需要自己先手动创建该表，去B节点上执行desc test_trade_event,查看建表语句，重新在A节点创建该表。</h4><p>创建完成之后再次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sstableloader -d 127.0.0.1 &#x2F;tmp&#x2F;test&#x2F;trade_event-8d5d68508fe211e88a9ca166a7412712</span><br></pre></td></tr></table></figure>
<h4 id="7、文件下的数据全部导入test-trade-event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下："><a href="#7、文件下的数据全部导入test-trade-event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下：" class="headerlink" title="7、文件下的数据全部导入test.trade_event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下："></a>7、文件下的数据全部导入test.trade_event表下面，然后使用copy将该表下面的数据全部导入到某一单独文件下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy trade_event to &#39;&#x2F;tmp&#x2F;trade_event.sql&#39; with header&#x3D;true;</span><br></pre></td></tr></table></figure>
<h4 id="8、恢复之前须知："><a href="#8、恢复之前须知：" class="headerlink" title="8、恢复之前须知："></a>8、恢复之前须知：</h4><p>copy from操作并不会覆盖掉以前所有旧的数据，只会将A节点存在，B节点不存的数据导入到B节点。但是如果是B和A两个节点主键相同，其他字段数据不同，使用copy from的情况下，A节点的数据会覆盖掉B节点的数据。<br>因为我们decommission节点之后，启动应用发现缺少数据，导致应用无法起来，这种情况下B节点没有最新数据插入，因此可以执行copy from操作。如果无法确定B节点是否有新的数据插入，建议先根据某个表对应的时间戳先校验，确保没有最新数据插入的情况下，再使用上面的方法执行。</p>
<h4 id="9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy-from操作将数据恢复："><a href="#9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy-from操作将数据恢复：" class="headerlink" title="9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy from操作将数据恢复："></a>9、导出完成之后，将导出的文件拷贝到B节点，之后再B节点上执行copy from操作将数据恢复：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COPY trade_event FROM &#39;&#x2F;home&#x2F;test&#x2F;trade_event.sql&#39; WITH HEADER &#x3D; TRUE ;</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/cassandra/">cassandra</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/02/13/cassandra使用nodetool decommission之后发现丢失数据的解决办法/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/30/mysql into outfile数据导出/"><span>[Mysql] SELECT ... INTO OUTFILE &#39;file_name&#39;将查询到的数据写入文件</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/30/mysql into outfile数据导出/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-30T09:36:00.000Z">
          2019-01-30
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、生成的文件会在server主机端，因此mysql必须有指定file-name文件所在目录的权限，另外file-name文件必须是不存在的，防止其他数据文件被破坏。"><a href="#1、生成的文件会在server主机端，因此mysql必须有指定file-name文件所在目录的权限，另外file-name文件必须是不存在的，防止其他数据文件被破坏。" class="headerlink" title="1、生成的文件会在server主机端，因此mysql必须有指定file_name文件所在目录的权限，另外file_name文件必须是不存在的，防止其他数据文件被破坏。"></a>1、生成的文件会在server主机端，因此mysql必须有指定file_name文件所在目录的权限，另外file_name文件必须是不存在的，防止其他数据文件被破坏。</h4><p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin into outfile &#39;d:&#x2F;admin.xls&#39;</span><br></pre></td></tr></table></figure>
<h4 id="2、使用SELECT-…-INTO-OUTFILE-‘file-name’方式导出数据文件是受参数secure-file-priv控制的-不同值管理着数据是否能正常导出"><a href="#2、使用SELECT-…-INTO-OUTFILE-‘file-name’方式导出数据文件是受参数secure-file-priv控制的-不同值管理着数据是否能正常导出" class="headerlink" title="2、使用SELECT … INTO OUTFILE ‘file_name’方式导出数据文件是受参数secure_file_priv控制的,不同值管理着数据是否能正常导出"></a>2、使用SELECT … INTO OUTFILE ‘file_name’方式导出数据文件是受参数secure_file_priv控制的,不同值管理着数据是否能正常导出</h4><h5 id="2-1、secure-file-priv参数值（静态参数，修改必须重启mysql"><a href="#2-1、secure-file-priv参数值（静态参数，修改必须重启mysql" class="headerlink" title="2.1、secure_file_priv参数值（静态参数，修改必须重启mysql):"></a>2.1、secure_file_priv参数值（静态参数，修改必须重启mysql):</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果该值为空，对导出没有限制，这是不安全的设置</span><br><span class="line">如果该值指定了某一个目录，那么导入导出数据操作只能在这个目录下操作，而且指定的目录必须是存在的，mysql服务不能够自动创建。</span><br><span class="line">如果该值为null，那么当前数据库不允许导入导出</span><br></pre></td></tr></table></figure>
<h5 id="2-2、查看参数值"><a href="#2-2、查看参数值" class="headerlink" title="2.2、查看参数值"></a>2.2、查看参数值</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@db 02:48:  [(none)]&gt; show variables like &#39;%secure_file%&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv | NULL  |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">root@db 02:48:  [test]&gt; select * from t1;</span><br><span class="line">+----+</span><br><span class="line">| c1 |</span><br><span class="line">+----+</span><br><span class="line">|  1 |</span><br><span class="line">+----+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>在值为null的时候是不允许导出数据的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 02:48:  [test]&gt; select * from t1 into outfile &#39;&#x2F;tmp&#x2F;t1.xls&#39;;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure>
<h5 id="2-3、修改secure-file-priv的值"><a href="#2-3、修改secure-file-priv的值" class="headerlink" title="2.3、修改secure_file_priv的值"></a>2.3、修改secure_file_priv的值</h5><p>在my.cnf配置文件下添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv&#x3D;&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv&#x3D;&#39;&#x2F;tmp&#39;</span><br></pre></td></tr></table></figure>
<p>并重启数据库,指定的目录必须存在，否则无法启动数据库<br>不能直接通过set global参数修改，修改会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 02:49:  [test]&gt; set global secure_file_priv&#x3D;&#39;&#x2F;data&#x2F;test&#39;;</span><br><span class="line">ERROR 1238 (HY000): Variable &#39;secure_file_priv&#39; is a read only variable</span><br></pre></td></tr></table></figure>
<p>重启完之后，查看secure参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 03:08:  [(none)]&gt; show variables like &#39;%secure_file%&#39;;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv | &#x2F;tmp&#x2F; |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>
<h4 id="3、导出查询数据"><a href="#3、导出查询数据" class="headerlink" title="3、导出查询数据"></a>3、导出查询数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 04:16:  [test]&gt; select * from mysql.user into outfile &#39;&#x2F;tmp&#x2F;user.xls&#39;;</span><br><span class="line">Query OK, 5 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>如果导出的目录不是secure_file_priv指定的目录，报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 00:17:  [test]&gt; select * from t1 into outfile &#39;&#x2F;data&#x2F;t1.xls&#39;;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/30/mysql into outfile数据导出/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/29/mysql create table ... 指定外部数据目录(File-per-table tablespace)/"><span>[Mysql] create table ... data directory指定外部数据目录(单表文件表空间)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/29/mysql create table ... 指定外部数据目录(File-per-table tablespace)/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-29T07:30:00.000Z">
          2019-01-29
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、使用create-table-…-data-directory"><a href="#1、使用create-table-…-data-directory" class="headerlink" title="1、使用create table … data directory"></a>1、使用create table … data directory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@db 18:15:  [(none)]&gt; use test</span><br><span class="line">Database changed</span><br><span class="line">root@db 18:16:  [test]&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| t1             |</span><br><span class="line">| t4             |</span><br><span class="line">+----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>指定的目录对于mysql的用户来说一定要有访问权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master test]# ll -d &#x2F;tmp&#x2F;</span><br><span class="line">drwxrwxrwt. 10 root root 4096 2月  11 20:54 &#x2F;tmp&#x2F;</span><br></pre></td></tr></table></figure>
<p>执行创建表语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 18:41:  [test]&gt; CREATE TABLE t2 (c1 INT PRIMARY KEY) DATA DIRECTORY &#x3D; &#39;&#x2F;tmp&#x2F;&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.60 sec)</span><br></pre></td></tr></table></figure>
<p>表创建完成之后，会在directory对应的目录下创建表对应的schema的目录，并在schema的目录下生成.ibd表文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master test]# ll &#x2F;tmp&#x2F;test&#x2F;t2*</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 2月  11 18:41 &#x2F;tmp&#x2F;test&#x2F;t2.ibd</span><br></pre></td></tr></table></figure>
<p>在mysql的数据目录下会生成.frm文件和.isl文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master test]# ll &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t2*</span><br><span class="line">-rw-r----- 1 mysql mysql 8556 2月  11 18:41 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t2.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   16 2月  11 18:41 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t2.isl</span><br></pre></td></tr></table></figure>
<h4 id="2、使用create-table-…-tablespace-data-directory"><a href="#2、使用create-table-…-tablespace-data-directory" class="headerlink" title="2、使用create table … tablespace .. data directory"></a>2、使用create table … tablespace .. data directory</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 18:41:  [test]&gt;  CREATE TABLE t3 (c1 INT PRIMARY KEY) TABLESPACE &#x3D; innodb_file_per_table DATA DIRECTORY &#x3D; &#39;&#x2F;tmp&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.33 sec)</span><br><span class="line">[root@dax-mysql-master test]#  ll &#x2F;tmp&#x2F;test&#x2F;t3*</span><br><span class="line">-rw-r----- 1 mysql mysql 98304 2月  11 22:16 &#x2F;tmp&#x2F;test&#x2F;t3.ibd</span><br><span class="line">[root@dax-mysql-master test]#  ll &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t3*</span><br><span class="line">-rw-r----- 1 mysql mysql 8556 2月  11 22:16 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t3.frm</span><br><span class="line">-rw-r----- 1 mysql mysql   16 2月  11 22:16 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;test&#x2F;t3.isl</span><br></pre></td></tr></table></figure>
<p>执行结果与章节1相同。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/29/mysql create table ... 指定外部数据目录(File-per-table tablespace)/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/29/mysql-general tablespace/"><span>[Mysql] general-tablespace详解</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/29/mysql-general tablespace/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-29T02:52:00.000Z">
          2019-01-29
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h5 id="0、功能介绍"><a href="#0、功能介绍" class="headerlink" title="0、功能介绍"></a>0、功能介绍</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、类似于系统表空间，一般表空间也是共享表空间，可以存储多个表的数据</span><br><span class="line">2、一般表空间相比于单表文件表空间有潜在的内存优势。在表空间的生命周期里，服务端可以在内存中保持表空间的元数据。多个表在较少的一般表空间内消耗的内存相比于相同数量的表在单表文件表空间所占用的内存要少的多。</span><br><span class="line">3、一般表空间的存放目录可以是放在mysql的数据目录，也可以单独存放于其他目录。将数据文件放在mysql数据目录以外，这样就可以自己管理单独管理表的性能，对特定的表设置raid、drbd，或者使用特殊的磁盘。</span><br><span class="line">4、一般表空间支持antelope和barracuda文件格式，因此支持所有的表行格式和相关特性。因为支持上面两种文件格式，因此一般表空间不依赖与innodb_file_format和innodb_file_per_table的设置，这些参数的设置对于一般表空间没有影响。</span><br><span class="line">5、create tables语句时可以使用tablespace参数指定放到一遍表空间、单表文件表空间还是系统表空间</span><br><span class="line">6、使用alter table移动表时，可以添加tablespace参数用于将表在一般表空间、单表文件表空间、系统表空间之间移动。</span><br></pre></td></tr></table></figure>
<h4 id="1、创建一般表空间"><a href="#1、创建一般表空间" class="headerlink" title="1、创建一般表空间"></a>1、创建一般表空间</h4><h5 id="1-1、创建表空间语法"><a href="#1-1、创建表空间语法" class="headerlink" title="1.1、创建表空间语法"></a>1.1、创建表空间语法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLESPACE tablespace_name ADD DATAFILE &#39;file_name&#39; [FILE_BLOCK_SIZE &#x3D; value] [ENGINE [&#x3D;] engine_name]</span><br></pre></td></tr></table></figure>
<h5 id="1-2、创建在mysql数据目录下的一般表空间"><a href="#1-2、创建在mysql数据目录下的一般表空间" class="headerlink" title="1.2、创建在mysql数据目录下的一般表空间"></a>1.2、创建在mysql数据目录下的一般表空间</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 22:19:  [information_schema]&gt; CREATE TABLESPACE &#96;ts1&#96; ADD DATAFILE &#39;ts1.ibd&#39; Engine&#x3D;InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.28 sec)</span><br></pre></td></tr></table></figure>
<p>查看创建成功后的表空间信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 22:19:  [information_schema]&gt; select * from innodb_sys_tablespaces where name&#x3D;&#39;ts1&#39;;</span><br><span class="line">+-------+------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span><br><span class="line">| SPACE | NAME | FLAG | FILE_FORMAT | ROW_FORMAT | PAGE_SIZE | ZIP_PAGE_SIZE | SPACE_TYPE | FS_BLOCK_SIZE | FILE_SIZE | ALLOCATED_SIZE |</span><br><span class="line">+-------+------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span><br><span class="line">|   678 | ts1  | 2048 | Any         | Any        |     16384 |             0 | General    |          4096 |     65536 |          32768 |</span><br><span class="line">+-------+------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>删除创建的表空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 22:19:  [information_schema]&gt; drop tablespace ts1;</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br></pre></td></tr></table></figure>
<h5 id="1-3、创建在数据目录以外的一般表空间-切记如果是主从或者是mgr集群模式，其他节点也要执行创建目录操作，否则会导致事务异常，集群崩溃"><a href="#1-3、创建在数据目录以外的一般表空间-切记如果是主从或者是mgr集群模式，其他节点也要执行创建目录操作，否则会导致事务异常，集群崩溃" class="headerlink" title="1.3、创建在数据目录以外的一般表空间(切记如果是主从或者是mgr集群模式，其他节点也要执行创建目录操作，否则会导致事务异常，集群崩溃)"></a>1.3、创建在数据目录以外的一般表空间(切记如果是主从或者是mgr集群模式，其他节点也要执行创建目录操作，否则会导致事务异常，集群崩溃)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mkdir -p &#x2F;tmp&#x2F;test</span><br><span class="line">shell&gt; chown mysql.mysql &#x2F;tmp&#x2F;test</span><br><span class="line">mysql&gt; CREATE TABLESPACE &#96;ts1&#96; ADD DATAFILE &#39;&#x2F;tmp&#x2F;test&#x2F;ts1.ibd&#39; Engine&#x3D;InnoDB;</span><br><span class="line">mysql&gt; select * from innodb_sys_tablespaces where name&#x3D;&#39;ts1&#39;;</span><br><span class="line">+-------+------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span><br><span class="line">| SPACE | NAME | FLAG | FILE_FORMAT | ROW_FORMAT | PAGE_SIZE | ZIP_PAGE_SIZE | SPACE_TYPE | FS_BLOCK_SIZE | FILE_SIZE | ALLOCATED_SIZE |</span><br><span class="line">+-------+------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span><br><span class="line">|   680 | ts1  | 2048 | Any         | Any        |     16384 |             0 | General    |          4096 |     65536 |          32768 |</span><br><span class="line">+-------+------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>创建完成之后会在mysql数据目录下生成一个.isl的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master data]# ll &#x2F;data&#x2F;mysql&#x2F;data&#x2F;ts1*</span><br><span class="line">-rw-r----- 1 mysql mysql 17 2月  10 22:32 &#x2F;data&#x2F;mysql&#x2F;data&#x2F;ts1.isl</span><br></pre></td></tr></table></figure>
<p>在创建的外部数据目录下生成了创建的ibd文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master data]# ll &#x2F;tmp&#x2F;test&#x2F;ts1*</span><br><span class="line">-rw-r----- 1 mysql mysql 65536 2月  10 22:32 &#x2F;tmp&#x2F;test&#x2F;ts1.ibd</span><br></pre></td></tr></table></figure>
<h5 id="1-4、使用create-tablespace创建一般表空间时，如果默认参数-default-storage-engine-InnoDB-没有被指定，一定要手动在语句末尾加上ENGINE-InnoDB-子句。"><a href="#1-4、使用create-tablespace创建一般表空间时，如果默认参数-default-storage-engine-InnoDB-没有被指定，一定要手动在语句末尾加上ENGINE-InnoDB-子句。" class="headerlink" title="1.4、使用create tablespace创建一般表空间时，如果默认参数(default_storage_engine=InnoDB)没有被指定，一定要手动在语句末尾加上ENGINE = InnoDB 子句。"></a>1.4、使用create tablespace创建一般表空间时，如果默认参数(default_storage_engine=InnoDB)没有被指定，一定要手动在语句末尾加上ENGINE = InnoDB 子句。</h5><h4 id="2、增加表到一般表空间"><a href="#2、增加表到一般表空间" class="headerlink" title="2、增加表到一般表空间"></a>2、增加表到一般表空间</h4><h5 id="2-1、使用create-table"><a href="#2-1、使用create-table" class="headerlink" title="2.1、使用create table"></a>2.1、使用create table</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1;</span><br></pre></td></tr></table></figure>
<p>查看表所属的表空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@db 23:08:  [test]&gt; select a.table_id,a.name,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b where a.space&#x3D;b.space and a.name&#x3D;&#39;test&#x2F;t1&#39;;</span><br><span class="line">+----------+---------+-------+------+</span><br><span class="line">| table_id | name    | space | name |</span><br><span class="line">+----------+---------+-------+------+</span><br><span class="line">|      970 | test&#x2F;t1 |   680 | ts1  |</span><br><span class="line">+----------+---------+-------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">root@db 23:06:  [test]&gt; CREATE TABLE test.t1 (c1 INT PRIMARY KEY) TABLESPACE ts1;</span><br><span class="line">Query OK, 0 rows affected (0.55 sec)</span><br></pre></td></tr></table></figure>
<h5 id="2-2、使用alter-table移动表到一般表空间"><a href="#2-2、使用alter-table移动表到一般表空间" class="headerlink" title="2.2、使用alter table移动表到一般表空间"></a>2.2、使用alter table移动表到一般表空间</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@db 23:11:  [test]&gt; select a.table_id,a.name,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b where a.space&#x3D;b.space and a.name&#x3D;&#39;aaaa&#x2F;test&#39;;</span><br><span class="line">+----------+-----------+-------+-----------+</span><br><span class="line">| table_id | name      | space | name      |</span><br><span class="line">+----------+-----------+-------+-----------+</span><br><span class="line">|      761 | aaaa&#x2F;test |   476 | aaaa&#x2F;test |</span><br><span class="line">+----------+-----------+-------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">root@db 23:11:  [test]&gt; alter table aaaa.test tablespace ts1;</span><br><span class="line">Query OK, 0 rows affected (0.92 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line">root@db 23:12:  [test]&gt; select a.table_id,a.name,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b where a.space&#x3D;b.space and a.name&#x3D;&#39;aaaa&#x2F;test&#39;;</span><br><span class="line">+----------+-----------+-------+------+</span><br><span class="line">| table_id | name      | space | name |</span><br><span class="line">+----------+-----------+-------+------+</span><br><span class="line">|      971 | aaaa&#x2F;test |   680 | ts1  |</span><br><span class="line">+----------+-----------+-------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>修改完成之后，在aaaa的数据目录下的test.ibd文件就不存在了，只剩下了test.frm文件</p>
<h4 id="3、关于压缩表和general-tablespace的限制"><a href="#3、关于压缩表和general-tablespace的限制" class="headerlink" title="3、关于压缩表和general tablespace的限制"></a>3、关于压缩表和general tablespace的限制</h4><p>对于包含压缩表的general tablespace，在创建的时候必须指定FILE_BLOCK_SIZE参数，该值必须是合理的压缩页大小与innodb_page_size的值相关联，同时创建压缩表是的key_block_size必须等于FILE_BLOCK_SIZ/1024。例如，如果innodb_page_size=16k、file_block_size=8k，key_block_size的值必须是8.<br>关于innodb_page_size、file_block_size、key_block_size的大小的设置，官方文档有详解介绍，点击<a href="https://dev.mysql.com/doc/refman/5.7/en/general-tablespaces.html" target="_blank" rel="noopener">此处查看详情</a></p>
<p>下面举例创建压缩表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLESPACE &#96;ts2&#96; ADD DATAFILE &#39;ts2.ibd&#39; FILE_BLOCK_SIZE &#x3D; 8192 Engine&#x3D;InnoDB;(在这里执行的时候，没有注意主从，在从库执行的时候也成功了，并且同步到了主库上)</span><br><span class="line">mysql&gt; CREATE TABLE test.t4 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT&#x3D;COMPRESSED KEY_BLOCK_SIZE&#x3D;8;</span><br><span class="line">root@db 00:01:  [test]&gt; select a.table_id,a.name,a.row_format,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b  where a.space&#x3D;b.space and a.name&#x3D;&#39;test&#x2F;t4&#39;;</span><br><span class="line">+----------+---------+------------+-------+------+</span><br><span class="line">| table_id | name    | row_format | space | name |</span><br><span class="line">+----------+---------+------------+-------+------+</span><br><span class="line">|      973 | test&#x2F;t4 | Compressed |   681 | ts2  |</span><br><span class="line">+----------+---------+------------+-------+------+</span><br></pre></td></tr></table></figure>
<p>如果创建的general tablespace没有指定file_block_size，会使用默认的innodb_page_size，但是当这两个值相等时，该表空间将仅支持（COMPACT, REDUNDANT, and DYNAMIC row formats），不支持uncompressed 格式。</p>
<h4 id="4、移动表"><a href="#4、移动表" class="headerlink" title="4、移动表"></a>4、移动表</h4><h5 id="4-1、从单表文件表空间、系统表空间移动到general-tablespace"><a href="#4-1、从单表文件表空间、系统表空间移动到general-tablespace" class="headerlink" title="4.1、从单表文件表空间、系统表空间移动到general tablespace"></a>4.1、从单表文件表空间、系统表空间移动到general tablespace</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tbl_name TABLESPACE [&#x3D;] tablespace_name;</span><br></pre></td></tr></table></figure>
<p>参考2.2章节</p>
<h5 id="4-2、从单表文件表空间、一般表空间移动到系统表空间"><a href="#4-2、从单表文件表空间、一般表空间移动到系统表空间" class="headerlink" title="4.2、从单表文件表空间、一般表空间移动到系统表空间"></a>4.2、从单表文件表空间、一般表空间移动到系统表空间</h5><p>ALTER TABLE tbl_name TABLESPACE [=] innodb_system;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@db 01:09:  [test]&gt; select a.table_id,a.name,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b where a.space&#x3D;b.space and a.name&#x3D;&#39;aaaa&#x2F;test&#39;;</span><br><span class="line">+----------+-----------+-------+------+</span><br><span class="line">| table_id | name      | space | name |</span><br><span class="line">+----------+-----------+-------+------+</span><br><span class="line">|      971 | aaaa&#x2F;test |   680 | ts1  |</span><br><span class="line">+----------+-----------+-------+------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">root@db 01:09:  [test]&gt; alter table aaaa.test tablespace &#x3D; innodb_system;</span><br><span class="line">Query OK, 0 rows affected (0.78 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line">root@db 01:34:  [aaaa]&gt; select * from information_schema.innodb_sys_tables where name&#x3D;&#39;aaaa&#x2F;test&#39;;</span><br><span class="line">+----------+-----------+------+--------+-------+-------------+------------+---------------+------------+</span><br><span class="line">| TABLE_ID | NAME      | FLAG | N_COLS | SPACE | FILE_FORMAT | ROW_FORMAT | ZIP_PAGE_SIZE | SPACE_TYPE |</span><br><span class="line">+----------+-----------+------+--------+-------+-------------+------------+---------------+------------+</span><br><span class="line">|      976 | aaaa&#x2F;test |  161 |      4 |     0 | Barracuda   | Dynamic    |             0 | System     |</span><br><span class="line">+----------+-----------+------+--------+-------+-------------+------------+---------------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h5 id="4-3、从系统表空间或者general-table移动到单表文件表空间"><a href="#4-3、从系统表空间或者general-table移动到单表文件表空间" class="headerlink" title="4.3、从系统表空间或者general table移动到单表文件表空间"></a>4.3、从系统表空间或者general table移动到单表文件表空间</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE tbl_name TABLESPACE [&#x3D;] innodb_file_per_table;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@db 01:36:  [aaaa]&gt; ALTER TABLE aaaa.test TABLESPACE &#x3D; innodb_file_per_table;</span><br><span class="line">Query OK, 0 rows affected (0.80 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line">root@db 01:36:  [aaaa]&gt; select a.table_id,a.name,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b where a.space&#x3D;b.space and a.name&#x3D;&#39;aaaa&#x2F;test&#39;;</span><br><span class="line">+----------+-----------+-------+-----------+</span><br><span class="line">| table_id | name      | space | name      |</span><br><span class="line">+----------+-----------+-------+-----------+</span><br><span class="line">|      977 | aaaa&#x2F;test |   682 | aaaa&#x2F;test |</span><br><span class="line">+----------+-----------+-------+-----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h5 id="4-4、alter-table-tablespace操作会重建整个表，并且不支持从临时表移动到永久表，"><a href="#4-4、alter-table-tablespace操作会重建整个表，并且不支持从临时表移动到永久表，" class="headerlink" title="4.4、alter table tablespace操作会重建整个表，并且不支持从临时表移动到永久表，"></a>4.4、alter table tablespace操作会重建整个表，并且不支持从临时表移动到永久表，</h5><h4 id="5、删除general-tablespace"><a href="#5、删除general-tablespace" class="headerlink" title="5、删除general tablespace"></a>5、删除general tablespace</h4><p>在删除general tablespace之前要删除这个表空间下的所有表，如果强行删除非空表空间，会返回报错。<br>查看要删除的表空间下面有没有其他库的表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@db 17:18:  [aaaa]&gt; select a.table_id,a.name,a.space,b.name from information_schema.innodb_sys_tables a,information_schema.innodb_sys_tablespaces b where a.space&#x3D;b.space and  b.name&#x3D;&#39;ts1&#39;;</span><br><span class="line">+----------+------------+-------+------+</span><br><span class="line">| table_id | name       | space | name |</span><br><span class="line">+----------+------------+-------+------+</span><br><span class="line">|      972 | aaaa&#x2F;test1 |   680 | ts1  |</span><br><span class="line">|      970 | test&#x2F;t1    |   680 | ts1  |</span><br><span class="line">+----------+------------+-------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>强行删除ts1表空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 17:18:  [aaaa]&gt; drop tablespace ts1;</span><br><span class="line">ERROR 1529 (HY000): Failed to drop TABLESPACE ts1</span><br></pre></td></tr></table></figure>

<h4 id="6、注意事项"><a href="#6、注意事项" class="headerlink" title="6、注意事项"></a>6、注意事项</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、不建议使用表分区在共享表空间，这个特性在5.7.24版本是支持的，但是会在未来被移除。</span><br><span class="line">2、对于不同的physical page size的压缩表和非压缩表不能共存于同一个general tablespace</span><br><span class="line">3、不能创建临时general tablespace</span><br><span class="line">4、删除在general tablespace下的表，空间不会释放，只能用于新的innodb数据</span><br><span class="line">5、alter table ... discard tablespace和alter table ... import tablespace对于general tablespace下的表时不支持的</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/29/mysql-general tablespace/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/23/oracle设置用户名密码复杂性校验/"><span>[Oracle] oracle设置用户名密码复杂性校验</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/23/oracle设置用户名密码复杂性校验/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-23T08:02:00.000Z">
          2019-01-23
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、在-ORACLE-HOME-rdbms-admin-目录下存在一个文件utlpwdmg-sql-里面有默认的配置可以直接执行，也可根据自己的需求修改配置文件再执行该脚本："><a href="#1、在-ORACLE-HOME-rdbms-admin-目录下存在一个文件utlpwdmg-sql-里面有默认的配置可以直接执行，也可根据自己的需求修改配置文件再执行该脚本：" class="headerlink" title="1、在$ORACLE_HOME/rdbms/admin/目录下存在一个文件utlpwdmg.sql,里面有默认的配置可以直接执行，也可根据自己的需求修改配置文件再执行该脚本："></a>1、在$ORACLE_HOME/rdbms/admin/目录下存在一个文件utlpwdmg.sql,里面有默认的配置可以直接执行，也可根据自己的需求修改配置文件再执行该脚本：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql&gt;@?&#x2F;rdbms&#x2F;admin&#x2F;utlpwdmg.sql</span><br></pre></td></tr></table></figure>
<h4 id="2、执行完成之后，再次修改密码使用简单的密码，将提示28003错误："><a href="#2、执行完成之后，再次修改密码使用简单的密码，将提示28003错误：" class="headerlink" title="2、执行完成之后，再次修改密码使用简单的密码，将提示28003错误："></a>2、执行完成之后，再次修改密码使用简单的密码，将提示28003错误：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">14:16:23 SYS@ boston&gt; alter user test identified by oracle;</span><br><span class="line">alter user test identified by oracle</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-28003: password verification for the specified password failed</span><br><span class="line">ORA-20001: Password length less than 8</span><br></pre></td></tr></table></figure>
<h4 id="3、查看修改后的概要文件下的参数"><a href="#3、查看修改后的概要文件下的参数" class="headerlink" title="3、查看修改后的概要文件下的参数"></a>3、查看修改后的概要文件下的参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM dba_profiles s WHERE s.profile&#x3D;&#39;DEFAULT&#39; AND resource_name like &#39;PASSWORD%&#39;;</span><br><span class="line"></span><br><span class="line">PROFILE 		       RESOURCE_NAME			RESOURCE LIMIT</span><br><span class="line">------------------------------ -------------------------------- -------- ----------------------------------------</span><br><span class="line">DEFAULT 		       PASSWORD_LIFE_TIME		PASSWORD 180</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_TIME		PASSWORD UNLIMITED</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_MAX		PASSWORD UNLIMITED</span><br><span class="line">DEFAULT 		       PASSWORD_VERIFY_FUNCTION 	PASSWORD VERIFY_FUNCTION_11G</span><br><span class="line">DEFAULT 		       PASSWORD_LOCK_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_GRACE_TIME		PASSWORD 7</span><br></pre></td></tr></table></figure>
<h4 id="4、现在重置密码的时候，密码还是可以复用的，因为PASSWORD-REUSE-TIME和PASSWORD-REUSE-MAX参数没有限制："><a href="#4、现在重置密码的时候，密码还是可以复用的，因为PASSWORD-REUSE-TIME和PASSWORD-REUSE-MAX参数没有限制：" class="headerlink" title="4、现在重置密码的时候，密码还是可以复用的，因为PASSWORD_REUSE_TIME和PASSWORD_REUSE_MAX参数没有限制："></a>4、现在重置密码的时候，密码还是可以复用的，因为PASSWORD_REUSE_TIME和PASSWORD_REUSE_MAX参数没有限制：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">15:04:58 SYS@ boston&gt; alter user test identified by Testdb123</span><br><span class="line">User altered.</span><br><span class="line">Elapsed: 00:00:00.11</span><br><span class="line">15:06:04 SYS@ boston&gt; alter user test identified by Testdb123;</span><br><span class="line">User altered.</span><br></pre></td></tr></table></figure>
<h4 id="5、下面修改PASSWORD-REUSE-TIME-用户名可以在多长时间之后可以复用-或者密码修改过多少次之后可以复用以前的旧密码（PASSWORD-REUSE-MAX）"><a href="#5、下面修改PASSWORD-REUSE-TIME-用户名可以在多长时间之后可以复用-或者密码修改过多少次之后可以复用以前的旧密码（PASSWORD-REUSE-MAX）" class="headerlink" title="5、下面修改PASSWORD_REUSE_TIME(用户名可以在多长时间之后可以复用)或者密码修改过多少次之后可以复用以前的旧密码（PASSWORD_REUSE_MAX）"></a>5、下面修改PASSWORD_REUSE_TIME(用户名可以在多长时间之后可以复用)或者密码修改过多少次之后可以复用以前的旧密码（PASSWORD_REUSE_MAX）</h4><p>，官方文档提示，只修改两个参数中的任意一个，另一个参数为unlimited，结果是用户永远不能复用密码：</p>
<h5 id="5-1、只单独修改PASSWORD-REUSE-TIME"><a href="#5-1、只单独修改PASSWORD-REUSE-TIME" class="headerlink" title="5.1、只单独修改PASSWORD_REUSE_TIME"></a>5.1、只单独修改PASSWORD_REUSE_TIME</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">15:13:17 SYS@ boston&gt; ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_TIME 1;</span><br><span class="line">Profile altered.</span><br><span class="line">Elapsed: 00:00:00.08</span><br><span class="line">15:13:18 SYS@ boston&gt; SELECT * FROM dba_profiles s WHERE s.profile&#x3D;&#39;DEFAULT&#39; AND resource_name like &#39;PASSWORD%&#39;;</span><br><span class="line"></span><br><span class="line">PROFILE 		       RESOURCE_NAME			RESOURCE LIMIT</span><br><span class="line">------------------------------ -------------------------------- -------- ----------------------------------------</span><br><span class="line">DEFAULT 		       PASSWORD_LIFE_TIME		PASSWORD 180</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_MAX		PASSWORD UNLIMITED</span><br><span class="line">DEFAULT 		       PASSWORD_VERIFY_FUNCTION 	PASSWORD VERIFY_FUNCTION_11G</span><br><span class="line">DEFAULT 		       PASSWORD_LOCK_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_GRACE_TIME		PASSWORD 7</span><br><span class="line">再次修改用户已经提示</span><br><span class="line">15:13:22 SYS@ boston&gt; alter user test identified by Testdb123;</span><br><span class="line">alter user test identified by Testdb123</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-28007: the password cannot be reused</span><br><span class="line">Elapsed: 00:00:00.02</span><br></pre></td></tr></table></figure>
<h5 id="5-2、只单独修改PASSWORD-REUSE-MAX"><a href="#5-2、只单独修改PASSWORD-REUSE-MAX" class="headerlink" title="5.2、只单独修改PASSWORD_REUSE_MAX"></a>5.2、只单独修改PASSWORD_REUSE_MAX</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_TIME UNLIMITED;</span><br><span class="line">ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_MAX 5;</span><br><span class="line">ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_TIME UNLIMITED;</span><br><span class="line">Profile altered.</span><br><span class="line">Elapsed: 00:00:00.05</span><br><span class="line">15:19:26 SYS@ boston&gt; ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_MAX 5;</span><br><span class="line">Profile altered.</span><br><span class="line">Elapsed: 00:00:00.03</span><br><span class="line">15:19:26 SYS@ boston&gt; SELECT * FROM dba_profiles s WHERE s.profile&#x3D;&#39;DEFAULT&#39; AND resource_name like &#39;PASSWORD%&#39;;</span><br><span class="line">PROFILE 		       RESOURCE_NAME			RESOURCE LIMIT</span><br><span class="line">------------------------------ -------------------------------- -------- ----------------------------------------</span><br><span class="line">DEFAULT 		       PASSWORD_LIFE_TIME		PASSWORD 180</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_TIME		PASSWORD UNLIMITED</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_MAX		PASSWORD 5</span><br><span class="line">DEFAULT 		       PASSWORD_VERIFY_FUNCTION 	PASSWORD VERIFY_FUNCTION_11G</span><br><span class="line">DEFAULT 		       PASSWORD_LOCK_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_GRACE_TIME		PASSWORD 7</span><br><span class="line">6 rows selected.</span><br><span class="line">Elapsed: 00:00:00.01</span><br><span class="line">15:19:29 SYS@ boston&gt; alter user test identified by Testdb123;</span><br><span class="line">alter user test identified by Testdb123</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-28007: the password cannot be reused</span><br></pre></td></tr></table></figure>
<h5 id="5-3、下面同时修改这两个参数："><a href="#5-3、下面同时修改这两个参数：" class="headerlink" title="5.3、下面同时修改这两个参数："></a>5.3、下面同时修改这两个参数：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">15:21:45 SYS@ boston&gt; ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_TIME 1;</span><br><span class="line">Profile altered.</span><br><span class="line">Elapsed: 00:00:00.05</span><br><span class="line">15:21:46 SYS@ boston&gt; SELECT * FROM dba_profiles s WHERE s.profile&#x3D;&#39;DEFAULT&#39; AND resource_name like &#39;PASSWORD%&#39;;</span><br><span class="line"></span><br><span class="line">PROFILE 		       RESOURCE_NAME			RESOURCE LIMIT</span><br><span class="line">------------------------------ -------------------------------- -------- ----------------------------------------</span><br><span class="line">DEFAULT 		       PASSWORD_LIFE_TIME		PASSWORD 180</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_MAX		PASSWORD 5</span><br><span class="line">DEFAULT 		       PASSWORD_VERIFY_FUNCTION 	PASSWORD VERIFY_FUNCTION_11G</span><br><span class="line">DEFAULT 		       PASSWORD_LOCK_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_GRACE_TIME		PASSWORD 7</span><br><span class="line">设置一天之后，并且修改5次不同密码之后才能复用之前的密码，下面为了满足要求，修改系统时间：</span><br><span class="line">15:23:00 SYS@ boston&gt; select sysdate from dual;</span><br><span class="line">SYSDATE</span><br><span class="line">-------------------</span><br><span class="line">2019:01:23 15:23:04</span><br><span class="line">[oracle@dax-mysql-slave admin]$ date -s 20190125</span><br><span class="line">date: 无法设置日期: 不允许的操作</span><br><span class="line">2019年 01月 25日 星期五 00:00:00 CST</span><br><span class="line">[oracle@dax-mysql-slave admin]$ exit</span><br><span class="line">登出</span><br><span class="line">[root@dax-mysql-slave ~]# date -s 20190125</span><br><span class="line">2019年 01月 25日 星期五 00:00:00 CST</span><br><span class="line">[root@dax-mysql-slave ~]# su - oracle</span><br><span class="line">上一次登录：三 1月 23 13:44:53 CST 2019pts&#x2F;2 上</span><br><span class="line">[oracle@dax-mysql-slave ~]$ date</span><br><span class="line">2019年 01月 25日 星期五 00:00:06 CST</span><br><span class="line">[oracle@dax-mysql-slave ~]$ sql</span><br><span class="line">00:00:26 SYS@ boston&gt; select sysdate from dual;</span><br><span class="line">SYSDATE</span><br><span class="line">-------------------</span><br><span class="line">2019:01:25 00:00:34</span><br><span class="line">Elapsed: 00:00:00.00</span><br><span class="line">00:00:34 SYS@ boston&gt; SELECT * FROM dba_profiles s WHERE s.profile&#x3D;&#39;DEFAULT&#39; AND resource_name like &#39;PASSWORD%&#39;;</span><br><span class="line">PROFILE 		       RESOURCE_NAME			RESOURCE LIMIT</span><br><span class="line">------------------------------ -------------------------------- -------- ----------------------------------------</span><br><span class="line">DEFAULT 		       PASSWORD_LIFE_TIME		PASSWORD 180</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_REUSE_MAX		PASSWORD 5</span><br><span class="line">DEFAULT 		       PASSWORD_VERIFY_FUNCTION 	PASSWORD VERIFY_FUNCTION_11G</span><br><span class="line">DEFAULT 		       PASSWORD_LOCK_TIME		PASSWORD 1</span><br><span class="line">DEFAULT 		       PASSWORD_GRACE_TIME		PASSWORD 7</span><br><span class="line">6 rows selected.</span><br><span class="line">Elapsed: 00:00:00.03</span><br><span class="line">修改5次不同的密码：</span><br><span class="line">00:04:17 SYS@ boston&gt; alter user test identified by Testdb128;</span><br><span class="line">User altered.</span><br><span class="line">Elapsed: 00:00:00.08</span><br><span class="line">00:04:29 SYS@ boston&gt; alter user test identified by Testdb129;</span><br><span class="line">User altered.</span><br><span class="line">Elapsed: 00:00:00.03</span><br><span class="line">00:04:33 SYS@ boston&gt; alter user test identified by Testdb130;</span><br><span class="line">User altered.</span><br><span class="line">Elapsed: 00:00:00.04</span><br><span class="line">00:04:37 SYS@ boston&gt; alter user test identified by Testdb131;</span><br><span class="line">User altered.</span><br><span class="line">Elapsed: 00:00:00.04</span><br><span class="line">00:04:39 SYS@ boston&gt; alter user test identified by Testdb132;</span><br><span class="line">User altered.</span><br><span class="line">修改5次之后再次修改为以前的密码，修改正常：</span><br><span class="line">Elapsed: 00:00:00.04</span><br><span class="line">00:04:40 SYS@ boston&gt; alter user test identified by Testdb123;</span><br><span class="line">User altered.</span><br><span class="line">再次修改为上面修改的新的密码，提示不能复用：</span><br><span class="line">Elapsed: 00:00:00.05</span><br><span class="line">00:04:46 SYS@ boston&gt; alter user test identified by Testdb130;</span><br><span class="line">alter user test identified by Testdb130</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-28007: the password cannot be reused</span><br><span class="line">Elapsed: 00:00:00.02</span><br><span class="line">00:04:56 SYS@ boston&gt;</span><br></pre></td></tr></table></figure>
<h4 id="6、还原上面的操作，在oracle下面有一个还原脚本，执行下面命令："><a href="#6、还原上面的操作，在oracle下面有一个还原脚本，执行下面命令：" class="headerlink" title="6、还原上面的操作，在oracle下面有一个还原脚本，执行下面命令："></a>6、还原上面的操作，在oracle下面有一个还原脚本，执行下面命令：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql&gt;@?&#x2F;rdbms&#x2F;admin&#x2F;undopwd.sql</span><br></pre></td></tr></table></figure>
<p>上面的脚本把PASSWORD_LIFE_TIME、PASSWORD_REUSE_TIME等参数改为了unlimitd，但是PASSWORD_VERIFY_FUNCTION的限制函数VERIFY_FUNCTION_11G仍然存在，如果不把这个清空，密码的复杂度校验仍然存在，清空密码复杂度校验执行下面操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql&gt;alter profile default limit PASSWORD_VERIFY_FUNCTION null;</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/23/oracle设置用户名密码复杂性校验/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/23/修改oracle用户密码永不过期/"><span>[Oracle] 修改oracle用户密码永不过期</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/23/修改oracle用户密码永不过期/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-23T08:01:00.000Z">
          2019-01-23
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、查看用户有无过期"><a href="#1、查看用户有无过期" class="headerlink" title="1、查看用户有无过期"></a>1、查看用户有无过期</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,account_status,expiry_date from dba_users;</span><br></pre></td></tr></table></figure>
<h4 id="2、查看用户使用概要文件"><a href="#2、查看用户使用概要文件" class="headerlink" title="2、查看用户使用概要文件"></a>2、查看用户使用概要文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username,PROFILE FROM dba_users;</span><br></pre></td></tr></table></figure>
<h4 id="3、查看概要文件密码有效期"><a href="#3、查看概要文件密码有效期" class="headerlink" title="3、查看概要文件密码有效期"></a>3、查看概要文件密码有效期</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM dba_profiles s WHERE s.profile&#x3D;&#39;DEFAULT&#39; AND resource_name like &#39;PASSWORD%&#39;;</span><br></pre></td></tr></table></figure>
<h4 id="4、修改概要文件有效期"><a href="#4、修改概要文件有效期" class="headerlink" title="4、修改概要文件有效期"></a>4、修改概要文件有效期</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME UNLIMITED;</span><br></pre></td></tr></table></figure>
<h4 id="5、再次查看用户过期时间，expiry-date字段已经变为空"><a href="#5、再次查看用户过期时间，expiry-date字段已经变为空" class="headerlink" title="5、再次查看用户过期时间，expiry_date字段已经变为空"></a>5、再次查看用户过期时间，expiry_date字段已经变为空</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,account_status,expiry_date from dba_users;</span><br></pre></td></tr></table></figure>
<h4 id="6、rac环境在任意一个节点执行即可。"><a href="#6、rac环境在任意一个节点执行即可。" class="headerlink" title="6、rac环境在任意一个节点执行即可。"></a>6、rac环境在任意一个节点执行即可。</h4>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/23/修改oracle用户密码永不过期/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/22/mysql参数NO_AUTO_CREATE_USER/"><span>[Mysql] mysql参数NO_AUTO_CREATE_USER</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/22/mysql参数NO_AUTO_CREATE_USER/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-22T06:34:00.000Z">
          2019-01-22
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、sql-mode存在NO-AUTO-CREATE-USER情况下："><a href="#1、sql-mode存在NO-AUTO-CREATE-USER情况下：" class="headerlink" title="1、sql_mode存在NO_AUTO_CREATE_USER情况下："></a>1、sql_mode存在NO_AUTO_CREATE_USER情况下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@db 01:05:  [(none)]&gt; show variables like &#39;%sql_mode%&#39;;</span><br><span class="line">+---------------+------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Variable_name | Value                                                                                                                  |</span><br><span class="line">+---------------+------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| sql_mode      | STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+---------------+------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@db 01:05:  [(none)]&gt; select host,user from mysql.user;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| %         | zabbix        |</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line">| localhost | zabbix        |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>在包含NO_AUTO_CREATE_USER的情况下，使用grant去授权一个不存在的用户，必须要使用identified by参数或者identified with插件指定密码，才能够创建用户并授权成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@db 01:07:  [(none)]&gt; grant all privileges on *.* to testuser;</span><br><span class="line">ERROR 1133 (42000): Can&#39;t find any matching row in the user table</span><br><span class="line">root@db 01:07:  [(none)]&gt; grant all privileges on *.* to testuser identified by &#39;testuser&#39;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>

<h4 id="2、sql-mode不存在NO-AUTO-CREATE-USER情况下"><a href="#2、sql-mode不存在NO-AUTO-CREATE-USER情况下" class="headerlink" title="2、sql_mode不存在NO_AUTO_CREATE_USER情况下"></a>2、sql_mode不存在NO_AUTO_CREATE_USER情况下</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@db 01:14:  [(none)]&gt; set @@sql_mode&#x3D;&quot;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&quot;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line">root@db 01:17:  [(none)]&gt; show variables like &#39;%sql_mode%&#39;;</span><br><span class="line">+---------------+----------------------------------------------------------------------------------------------------+</span><br><span class="line">| Variable_name | Value                                                                                              |</span><br><span class="line">+---------------+----------------------------------------------------------------------------------------------------+</span><br><span class="line">| sql_mode      | STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+---------------+----------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line">root@db 01:17:  [(none)]&gt; grant all privileges on *.* to testuser1;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>没有密码也能够创建该用户，并授权成功，使用该用户没有密码可以直接登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@db 01:17:  [(none)]&gt; select host,user from mysql.user;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| host      | user          |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| %         | testuser      |</span><br><span class="line">| %         | testuser1     |</span><br><span class="line">| %         | zabbix        |</span><br><span class="line">| localhost | mysql.session |</span><br><span class="line">| localhost | mysql.sys     |</span><br><span class="line">| localhost | root          |</span><br><span class="line">| localhost | zabbix        |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="3、总结："><a href="#3、总结：" class="headerlink" title="3、总结："></a>3、总结：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NO_AUTO_CREATE_USER参数在未来将会被弃用，被弃用的原因是基于对复制安全性的考虑。而基于复制安全性的考虑，对用户进行管理操作的更好方法是使用：CREATE USER IF NOT EXISTS, DROP USER IF EXISTS, 和ALTER USER IF EXISTS而不是grant命令。这些语句可以保证复制的安全性当从库存在和主库的不同权限。</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/22/mysql参数NO_AUTO_CREATE_USER/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/14/sqlserver2017数据导入sqlserver2016/"><span>[Sqlserver] Sqlserver2017数据库导入低版本sqlserver2016数据库</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/14/sqlserver2017数据导入sqlserver2016/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-14T06:54:00.000Z">
          2019-01-14
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、源库操作"><a href="#1、源库操作" class="headerlink" title="1、源库操作"></a>1、源库操作</h4><p>通过sqlserver manager studio登录sqlserver2017，对要备份的库进行操作：tasks–&gt;Generate scripts<br><img src="https://i.imgur.com/3QLtong.jpg" alt=""><br>点击下一步Next：<br><img src="https://i.imgur.com/TgGqSV7.png" alt=""><br>可以选择要备份整个库，还是只备份这个库的某个对象，我们这里备份整个库：<br><img src="https://i.imgur.com/Qrh498i.png" alt=""><br>点击下一步，点击advanced，进行编辑，将Script for server version修改为要目标库的版本（sqlserver2016）,Type of data to script改为Schema and data：<br><img src="https://i.imgur.com/JKIEDUd.png" alt=""><br>修改备份的路径，点击next:<br><img src="https://i.imgur.com/ncNCo1R.jpg" alt=""><br>开始导出数据：<br><img src="https://i.imgur.com/9iFyYH9.png" alt=""></p>
<h4 id="2、目标库操作"><a href="#2、目标库操作" class="headerlink" title="2、目标库操作"></a>2、目标库操作</h4><p>数据导出完成之后，将备份的数据拷贝到目标端服务器，目录根据自己需求定义，然后通过management studio登录sqlserver2016数据库（这里安装sqlserver2016的过程中，发现没有自带managerment studio管理软件，需要自己单独安装，sqlserver2016 management studio下载链接，点击<a href="https://download.microsoft.com/download/9/3/3/933EA6DD-58C5-4B78-8BEC-2DF389C72BE0/SSMS-Setup-ENU.exe" target="_blank" rel="noopener">此处</a></p>
<p>登录management studio打开拷贝过来的脚本，修改脚本：<br>将数据路径和日志路径修改为本地的sqlserver路径，如果database已经建立了，可以把create database参数改为use<br><img src="https://i.imgur.com/3JeTUFi.jpg" alt=""></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/sqlserver/">sqlserver</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/14/sqlserver2017数据导入sqlserver2016/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/09/oracle 修改字符集/"><span>[Oracle] oracle修改字符集</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/09/oracle 修改字符集/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-09T10:54:00.000Z">
          2019-01-09
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="0、查看数据库字符集"><a href="#0、查看数据库字符集" class="headerlink" title="0、查看数据库字符集"></a>0、查看数据库字符集</h4><p>1)数据库服务器字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from nls_database_parameters;</span><br></pre></td></tr></table></figure>
<p>来源于props$，是表示数据库的字符集。<br>2)客户端字符集环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from nls_instance_parameters;</span><br></pre></td></tr></table></figure>
<p>其来源于v$parameter，表示客户端的字符集的设置，可能是参数文件，环境变量或者是注册表<br>3)会话字符集环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from nls_session_parameters;</span><br></pre></td></tr></table></figure>
<p>来源于v$nls_parameters，表示会话自己的设置，可能是会话的环境变量或者是alter session完成，如果会话没有特殊的设置，将与nls_instance_parameters一致。</p>
<h4 id="1、字符集由AL32UTF8修改为ZHS16GBK"><a href="#1、字符集由AL32UTF8修改为ZHS16GBK" class="headerlink" title="1、字符集由AL32UTF8修改为ZHS16GBK"></a>1、字符集由AL32UTF8修改为ZHS16GBK</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">13:51:26 SYS@ boston&gt; select * from nls_database_parameters;</span><br><span class="line"></span><br><span class="line">PARAMETER                                                    VALUE</span><br><span class="line">------------------------------------------------------------ --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">NLS_LANGUAGE                                                 AMERICAN</span><br><span class="line">NLS_TERRITORY                                                AMERICA</span><br><span class="line">NLS_CURRENCY                                                 $</span><br><span class="line">NLS_ISO_CURRENCY                                             AMERICA</span><br><span class="line">NLS_NUMERIC_CHARACTERS                                       .,</span><br><span class="line">NLS_CHARACTERSET                                             AL32UTF8</span><br><span class="line">NLS_CALENDAR                                                 GREGORIAN</span><br><span class="line">NLS_DATE_FORMAT                                              DD-MON-RR</span><br><span class="line">NLS_DATE_LANGUAGE                                            AMERICAN</span><br><span class="line">NLS_SORT                                                     BINARY</span><br><span class="line">NLS_TIME_FORMAT                                              HH.MI.SSXFF AM</span><br><span class="line">NLS_TIMESTAMP_FORMAT                                         DD-MON-RR HH.MI.SSXFF AM</span><br><span class="line">NLS_TIME_TZ_FORMAT                                           HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_TIMESTAMP_TZ_FORMAT                                      DD-MON-RR HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_DUAL_CURRENCY                                            $</span><br><span class="line">NLS_COMP                                                     BINARY</span><br><span class="line">NLS_LENGTH_SEMANTICS                                         BYTE</span><br><span class="line">NLS_NCHAR_CONV_EXCP                                          FALSE</span><br><span class="line">NLS_NCHAR_CHARACTERSET                                       AL16UTF16</span><br><span class="line">NLS_RDBMS_VERSION                                            11.2.0.4.0</span><br></pre></td></tr></table></figure>
<p>提示要修改的新的字符集必须大于旧的字符集才可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">13:51:36 SYS@ boston&gt; ALTER DATABASE CHARACTER SET ZHS16GBK;</span><br><span class="line">ALTER DATABASE CHARACTER SET ZHS16GBK</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-12712: new character set must be a superset of old character set</span><br></pre></td></tr></table></figure>
<p>跳过超集的检查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">13:59:34 SYS@ boston&gt; alter system enable restricted session; </span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:02.05</span><br><span class="line">13:59:48 SYS@ boston&gt; ALTER DATABASE character set INTERNAL_USE ZHS16GBK;</span><br><span class="line">ALTER DATABASE character set INTERNAL_USE ZHS16GBK</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-12721: operation cannot execute when other sessions are active</span><br></pre></td></tr></table></figure>
<p>查看当前活动的会话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">14:02:48 SYS@ boston&gt; select sid, serial#,program ,status from v$session;</span><br><span class="line"></span><br><span class="line">       SID    SERIAL# PROGRAM                                                                                          STATUS</span><br><span class="line">---------- ---------- ------------------------------------------------------------------------------------------------ ----------------</span><br><span class="line">         1          1 oracle@dax-mysql-slave (VKTM)                                                                    ACTIVE</span><br><span class="line">         2          1 oracle@dax-mysql-slave (DIA0)                                                                    ACTIVE</span><br><span class="line">         3          1 oracle@dax-mysql-slave (CKPT)                                                                    ACTIVE</span><br><span class="line">         4          3 oracle@dax-mysql-slave (MMNL)                                                                    ACTIVE</span><br><span class="line">         6         11 oracle@dax-mysql-slave (SMCO)                                                                    ACTIVE</span><br><span class="line">       101          1 oracle@dax-mysql-slave (GEN0)                                                                    ACTIVE</span><br><span class="line">       102          1 oracle@dax-mysql-slave (MMAN)                                                                    ACTIVE</span><br><span class="line">       103          1 oracle@dax-mysql-slave (SMON)                                                                    ACTIVE</span><br><span class="line">       105       1603 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              ACTIVE</span><br><span class="line">       201          1 oracle@dax-mysql-slave (PMON)                                                                    ACTIVE</span><br><span class="line">       202          1 oracle@dax-mysql-slave (DIAG)                                                                    ACTIVE</span><br><span class="line">       203          1 oracle@dax-mysql-slave (DBW0)                                                                    ACTIVE</span><br><span class="line">       204          1 oracle@dax-mysql-slave (RECO)                                                                    ACTIVE</span><br><span class="line">       207        145 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              INACTIVE</span><br><span class="line">       301        291 oracle@dax-mysql-slave (W000)                                                                    ACTIVE</span><br><span class="line">       302          1 oracle@dax-mysql-slave (PSP0)                                                                    ACTIVE</span><br><span class="line">       303          1 oracle@dax-mysql-slave (DBRM)                                                                    ACTIVE</span><br><span class="line">       304          1 oracle@dax-mysql-slave (LGWR)                                                                    ACTIVE</span><br><span class="line">       305          3 oracle@dax-mysql-slave (MMON)                                                                    ACTIVE</span><br><span class="line">       306        199 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              INACTIVE</span><br></pre></td></tr></table></figure>
<p>查看当前会话的sid</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">14:02:56 SYS@ boston&gt; select userenv(&#39;sid&#39;) from dual;</span><br><span class="line">USERENV(&#39;SID&#39;)</span><br><span class="line">--------------</span><br><span class="line">           105</span><br></pre></td></tr></table></figure>
<p>尝试杀掉sqlplus连接进来的两个inactive的会话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">14:06:46 SYS@ boston&gt; alter system kill session &#39;207,145&#39;;</span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:00.00</span><br><span class="line">14:07:11 SYS@ boston&gt; alter system kill session &#39;306,199&#39;;</span><br><span class="line">System altered.</span><br><span class="line"></span><br><span class="line">14:07:27 SYS@ boston&gt; select sid, serial#,program ,status from v$session;</span><br><span class="line"></span><br><span class="line">       SID    SERIAL# PROGRAM                                                                                          STATUS</span><br><span class="line">---------- ---------- ------------------------------------------------------------------------------------------------ ----------------</span><br><span class="line">         1          1 oracle@dax-mysql-slave (VKTM)                                                                    ACTIVE</span><br><span class="line">         2          1 oracle@dax-mysql-slave (DIA0)                                                                    ACTIVE</span><br><span class="line">         3          1 oracle@dax-mysql-slave (CKPT)                                                                    ACTIVE</span><br><span class="line">         4          3 oracle@dax-mysql-slave (MMNL)                                                                    ACTIVE</span><br><span class="line">         6         11 oracle@dax-mysql-slave (SMCO)                                                                    ACTIVE</span><br><span class="line">       101          1 oracle@dax-mysql-slave (GEN0)                                                                    ACTIVE</span><br><span class="line">       102          1 oracle@dax-mysql-slave (MMAN)                                                                    ACTIVE</span><br><span class="line">       103          1 oracle@dax-mysql-slave (SMON)                                                                    ACTIVE</span><br><span class="line">       105       1603 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              ACTIVE</span><br><span class="line">       201          1 oracle@dax-mysql-slave (PMON)                                                                    ACTIVE</span><br><span class="line">       202          1 oracle@dax-mysql-slave (DIAG)                                                                    ACTIVE</span><br><span class="line">       203          1 oracle@dax-mysql-slave (DBW0)                                                                    ACTIVE</span><br><span class="line">       204          1 oracle@dax-mysql-slave (RECO)                                                                    ACTIVE</span><br><span class="line">       207        145 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              KILLED</span><br><span class="line">       302          1 oracle@dax-mysql-slave (PSP0)                                                                    ACTIVE</span><br><span class="line">       303          1 oracle@dax-mysql-slave (DBRM)                                                                    ACTIVE</span><br><span class="line">       304          1 oracle@dax-mysql-slave (LGWR)                                                                    ACTIVE</span><br><span class="line">       305          3 oracle@dax-mysql-slave (MMON)                                                                    ACTIVE</span><br><span class="line">       306        199 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              KILLED</span><br></pre></td></tr></table></figure>
<p>再次执行仍然提示有活动会话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">14:07:29 SYS@ boston&gt;  ALTER DATABASE character set INTERNAL_USE ZHS16GBK;</span><br><span class="line"> ALTER DATABASE character set INTERNAL_USE ZHS16GBK</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-12721: operation cannot execute when other sessions are active</span><br></pre></td></tr></table></figure>
<p>重启数据库再次修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">14:10:54 SYS@ boston&gt; shutdown immeidate</span><br><span class="line">SP2-0717: illegal SHUTDOWN option</span><br><span class="line">14:11:02 SYS@ boston&gt; shutdown immediate</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">14:11:16 SYS@ boston&gt; startup</span><br><span class="line">ORACLE instance started.</span><br><span class="line"></span><br><span class="line">Total System Global Area 1603411968 bytes</span><br><span class="line">Fixed Size                  2253664 bytes</span><br><span class="line">Variable Size             503319712 bytes</span><br><span class="line">Database Buffers         1090519040 bytes</span><br><span class="line">Redo Buffers                7319552 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line">14:11:46 SYS@ boston&gt; select sid, serial#,program ,status from v$session;</span><br><span class="line">       SID    SERIAL# PROGRAM                                                                                          STATUS</span><br><span class="line">---------- ---------- ------------------------------------------------------------------------------------------------ ----------------</span><br><span class="line">         1          1 oracle@dax-mysql-slave (VKTM)                                                                    ACTIVE</span><br><span class="line">         2          1 oracle@dax-mysql-slave (DIA0)                                                                    ACTIVE</span><br><span class="line">         3          1 oracle@dax-mysql-slave (CKPT)                                                                    ACTIVE</span><br><span class="line">         4          1 oracle@dax-mysql-slave (MMNL)                                                                    ACTIVE</span><br><span class="line">       101          1 oracle@dax-mysql-slave (GEN0)                                                                    ACTIVE</span><br><span class="line">       102          1 oracle@dax-mysql-slave (MMAN)                                                                    ACTIVE</span><br><span class="line">       103          1 oracle@dax-mysql-slave (SMON)                                                                    ACTIVE</span><br><span class="line">       201          1 oracle@dax-mysql-slave (PMON)                                                                    ACTIVE</span><br><span class="line">       202          1 oracle@dax-mysql-slave (DIAG)                                                                    ACTIVE</span><br><span class="line">       203          1 oracle@dax-mysql-slave (DBW0)                                                                    ACTIVE</span><br><span class="line">       204          1 oracle@dax-mysql-slave (RECO)                                                                    ACTIVE</span><br><span class="line">       301          5 sqlplus@dax-mysql-slave (TNS V1-V3)                                                              ACTIVE</span><br><span class="line">       302          1 oracle@dax-mysql-slave (PSP0)                                                                    ACTIVE</span><br><span class="line">       303          1 oracle@dax-mysql-slave (DBRM)                                                                    ACTIVE</span><br><span class="line">       304          1 oracle@dax-mysql-slave (LGWR)                                                                    ACTIVE</span><br><span class="line">       305          1 oracle@dax-mysql-slave (MMON)                                                                    ACTIVE</span><br><span class="line">16 rows selected.</span><br><span class="line"></span><br><span class="line">Elapsed: 00:00:00.03</span><br><span class="line">14:11:47 SYS@ boston&gt;  alter system enable restricted session; </span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:02.04</span><br><span class="line">14:12:00 SYS@ boston&gt;  ALTER DATABASE character set INTERNAL_USE ZHS16GBK;</span><br><span class="line">Database altered.</span><br></pre></td></tr></table></figure>
<p>修改完成再次重启数据库，（修改完字符集之后关闭数据库会花费很长时间）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">14:12:13 SYS@ boston&gt; shutdown immediate</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">14:18:21 SYS@ boston&gt; startup</span><br><span class="line">ORACLE instance started.</span><br><span class="line"></span><br><span class="line">Total System Global Area 1603411968 bytes</span><br><span class="line">Fixed Size                  2253664 bytes</span><br><span class="line">Variable Size             503319712 bytes</span><br><span class="line">Database Buffers         1090519040 bytes</span><br><span class="line">Redo Buffers                7319552 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br></pre></td></tr></table></figure>
<p>查看字符集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">14:19:40 SYS@ boston&gt; select * from nls_database_parameters;</span><br><span class="line"></span><br><span class="line">PARAMETER                      VALUE</span><br><span class="line">------------------------------ --------------------------------------------------------------------------------</span><br><span class="line">NLS_LANGUAGE                   AMERICAN</span><br><span class="line">NLS_TERRITORY                  AMERICA</span><br><span class="line">NLS_CURRENCY                   $</span><br><span class="line">NLS_ISO_CURRENCY               AMERICA</span><br><span class="line">NLS_NUMERIC_CHARACTERS         .,</span><br><span class="line">NLS_CHARACTERSET               ZHS16GBK</span><br><span class="line">NLS_CALENDAR                   GREGORIAN</span><br><span class="line">NLS_DATE_FORMAT                DD-MON-RR</span><br><span class="line">NLS_DATE_LANGUAGE              AMERICAN</span><br><span class="line">NLS_SORT                       BINARY</span><br><span class="line">NLS_TIME_FORMAT                HH.MI.SSXFF AM</span><br><span class="line">NLS_TIMESTAMP_FORMAT           DD-MON-RR HH.MI.SSXFF AM</span><br><span class="line">NLS_TIME_TZ_FORMAT             HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_TIMESTAMP_TZ_FORMAT        DD-MON-RR HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_DUAL_CURRENCY              $</span><br><span class="line">NLS_COMP                       BINARY</span><br><span class="line">NLS_LENGTH_SEMANTICS           BYTE</span><br><span class="line">NLS_NCHAR_CONV_EXCP            FALSE</span><br><span class="line">NLS_NCHAR_CHARACTERSET         AL16UTF16</span><br><span class="line">NLS_RDBMS_VERSION              11.2.0.4.0</span><br><span class="line">20 rows selected.</span><br></pre></td></tr></table></figure>
<p>字符集修改完成,数据库的字符集更改会出现乱码，操作要慎重。</p>
<h4 id="2、数据库字符集由ZHS16GBK改为AL32UTF8"><a href="#2、数据库字符集由ZHS16GBK改为AL32UTF8" class="headerlink" title="2、数据库字符集由ZHS16GBK改为AL32UTF8"></a>2、数据库字符集由ZHS16GBK改为AL32UTF8</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">15:01:20 SYS@ boston&gt; select * from nls_database_parameters;</span><br><span class="line"></span><br><span class="line">PARAMETER                      VALUE</span><br><span class="line">------------------------------ --------------------------------------------------------------------------------</span><br><span class="line">NLS_LANGUAGE                   AMERICAN</span><br><span class="line">NLS_TERRITORY                  AMERICA</span><br><span class="line">NLS_CURRENCY                   $</span><br><span class="line">NLS_ISO_CURRENCY               AMERICA</span><br><span class="line">NLS_NUMERIC_CHARACTERS         .,</span><br><span class="line">NLS_CHARACTERSET               ZHS16GBK</span><br><span class="line">NLS_CALENDAR                   GREGORIAN</span><br><span class="line">NLS_DATE_FORMAT                DD-MON-RR</span><br><span class="line">NLS_DATE_LANGUAGE              AMERICAN</span><br><span class="line">NLS_SORT                       BINARY</span><br><span class="line">NLS_TIME_FORMAT                HH.MI.SSXFF AM</span><br><span class="line">NLS_TIMESTAMP_FORMAT           DD-MON-RR HH.MI.SSXFF AM</span><br><span class="line">NLS_TIME_TZ_FORMAT             HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_TIMESTAMP_TZ_FORMAT        DD-MON-RR HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_DUAL_CURRENCY              $</span><br><span class="line">NLS_COMP                       BINARY</span><br><span class="line">NLS_LENGTH_SEMANTICS           BYTE</span><br><span class="line">NLS_NCHAR_CONV_EXCP            FALSE</span><br><span class="line">NLS_NCHAR_CHARACTERSET         AL16UTF16</span><br><span class="line">NLS_RDBMS_VERSION              11.2.0.4.0</span><br><span class="line">20 rows selected.</span><br><span class="line">15:05:51 SYS@ boston&gt; alter system enable restricted session; </span><br><span class="line">System altered.</span><br><span class="line">Elapsed: 00:00:02.06</span><br><span class="line">15:07:05 SYS@ boston&gt; ALTER DATABASE character set  AL32UTF8; </span><br><span class="line">ALTER DATABASE character set  AL32UTF8</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-12712: new character set must be a superset of old character set</span><br><span class="line">Elapsed: 00:00:00.00</span><br></pre></td></tr></table></figure>
<p>这个报错证明AL32UTF8字符集并不是ZHS16GBK超集。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">15:07:12 SYS@ boston&gt; ALTER DATABASE character set INTERNAL_USE AL32UTF8; </span><br><span class="line">ALTER DATABASE character set INTERNAL_USE AL32UTF8</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-12721: operation cannot execute when other sessions are active</span><br><span class="line"></span><br><span class="line">Elapsed: 00:00:00.01</span><br><span class="line">15:07:23 SYS@ boston&gt; select sid, serial#,program ,status from v$session;</span><br><span class="line"></span><br><span class="line">       SID    SERIAL# PROGRAM                                          STATUS</span><br><span class="line">---------- ---------- ------------------------------------------------ --------</span><br><span class="line">         1          1 oracle@dax-mysql-slave (VKTM)                    ACTIVE</span><br><span class="line">         2          1 oracle@dax-mysql-slave (DIA0)                    ACTIVE</span><br><span class="line">         3          1 oracle@dax-mysql-slave (CKPT)                    ACTIVE</span><br><span class="line">         4          3 oracle@dax-mysql-slave (MMNL)                    ACTIVE</span><br><span class="line">         7          5 oracle@dax-mysql-slave (SMCO)                    ACTIVE</span><br><span class="line">       101          1 oracle@dax-mysql-slave (GEN0)                    ACTIVE</span><br><span class="line">       102          1 oracle@dax-mysql-slave (MMAN)                    ACTIVE</span><br><span class="line">       103          1 oracle@dax-mysql-slave (SMON)                    ACTIVE</span><br><span class="line">       104         27 oracle@dax-mysql-slave (W000)                    ACTIVE</span><br><span class="line">       201          1 oracle@dax-mysql-slave (PMON)                    ACTIVE</span><br><span class="line">       202          1 oracle@dax-mysql-slave (DIAG)                    ACTIVE</span><br><span class="line">       203          1 oracle@dax-mysql-slave (DBW0)                    ACTIVE</span><br><span class="line">       204          1 oracle@dax-mysql-slave (RECO)                    ACTIVE</span><br><span class="line">       205         15 sqlplus@dax-mysql-slave (TNS V1-V3)              INACTIVE</span><br><span class="line">       301         15 sqlplus@dax-mysql-slave (TNS V1-V3)              INACTIVE</span><br><span class="line">       302          1 oracle@dax-mysql-slave (PSP0)                    ACTIVE</span><br><span class="line">       303          1 oracle@dax-mysql-slave (DBRM)                    ACTIVE</span><br><span class="line">       304          1 oracle@dax-mysql-slave (LGWR)                    ACTIVE</span><br><span class="line">       305          3 oracle@dax-mysql-slave (MMON)                    ACTIVE</span><br><span class="line">       306        139 sqlplus@dax-mysql-slave (TNS V1-V3)              ACTIVE</span><br><span class="line"></span><br><span class="line">20 rows selected.</span><br><span class="line">Elapsed: 00:00:00.01</span><br><span class="line">15:07:36 SYS@ boston&gt; shutdown immediate</span><br><span class="line">Database closed.</span><br><span class="line">Database dismounted.</span><br><span class="line">ORACLE instance shut down.</span><br><span class="line">15:07:55 SYS@ boston&gt; startup</span><br><span class="line">ORACLE instance started.</span><br><span class="line"></span><br><span class="line">Total System Global Area 1603411968 bytes</span><br><span class="line">Fixed Size                  2253664 bytes</span><br><span class="line">Variable Size             503319712 bytes</span><br><span class="line">Database Buffers         1090519040 bytes</span><br><span class="line">Redo Buffers                7319552 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line">15:08:38 SYS@ boston&gt; </span><br><span class="line">15:13:24 SYS@ boston&gt; select * from nls_database_parameters;</span><br><span class="line"></span><br><span class="line">PARAMETER                      VALUE</span><br><span class="line">------------------------------ ----------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">NLS_LANGUAGE                   AMERICAN</span><br><span class="line">NLS_TERRITORY                  AMERICA</span><br><span class="line">NLS_CURRENCY                   $</span><br><span class="line">NLS_ISO_CURRENCY               AMERICA</span><br><span class="line">NLS_NUMERIC_CHARACTERS         .,</span><br><span class="line">NLS_CHARACTERSET               AL32UTF8</span><br><span class="line">NLS_CALENDAR                   GREGORIAN</span><br><span class="line">NLS_DATE_FORMAT                DD-MON-RR</span><br><span class="line">NLS_DATE_LANGUAGE              AMERICAN</span><br><span class="line">NLS_SORT                       BINARY</span><br><span class="line">NLS_TIME_FORMAT                HH.MI.SSXFF AM</span><br><span class="line">NLS_TIMESTAMP_FORMAT           DD-MON-RR HH.MI.SSXFF AM</span><br><span class="line">NLS_TIME_TZ_FORMAT             HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_TIMESTAMP_TZ_FORMAT        DD-MON-RR HH.MI.SSXFF AM TZR</span><br><span class="line">NLS_DUAL_CURRENCY              $</span><br><span class="line">NLS_COMP                       BINARY</span><br><span class="line">NLS_LENGTH_SEMANTICS           BYTE</span><br><span class="line">NLS_NCHAR_CONV_EXCP            FALSE</span><br><span class="line">NLS_NCHAR_CHARACTERSET         AL16UTF16</span><br><span class="line">NLS_RDBMS_VERSION              11.2.0.4.0</span><br></pre></td></tr></table></figure>
<p>字符集修改完成</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/09/oracle 修改字符集/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2019/01/09/linux操作系统字符集与ssh工具字符集配置问题/"><span>[Linux] linux操作系统字符集与ssh工具字符集配置问题</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/01/09/linux操作系统字符集与ssh工具字符集配置问题/" rel="bookmark">
        <time class="entry-date published" datetime="2019-01-09T09:26:00.000Z">
          2019-01-09
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、操作系统字符集设置"><a href="#1、操作系统字符集设置" class="headerlink" title="1、操作系统字符集设置"></a>1、操作系统字符集设置</h4><p>centos6和7的字符集文件位置不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CentOS6.x 字符集配置文件在&#x2F;etc&#x2F;syscconfig&#x2F;i18n</span><br><span class="line">CentOS7.x 字符集配置文件在&#x2F;etc&#x2F;locale.conf</span><br></pre></td></tr></table></figure>
<p>以centos7为例，修改字符集<br>cat /etc/locale.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANG&#x3D;&quot;zh_CN.UTF-8&quot;</span><br></pre></td></tr></table></figure>
<p>修改为GBK字符集<br>cat /etc/locale.conf </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">LANG&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">[root@dax-mysql-slave ~]# locale</span><br><span class="line">LANG&#x3D;zh_CN.GBK</span><br><span class="line">LC_CTYPE&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_NUMERIC&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_TIME&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_COLLATE&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_MONETARY&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_MESSAGES&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_PAPER&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_NAME&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_ADDRESS&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_TELEPHONE&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_MEASUREMENT&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_IDENTIFICATION&#x3D;&quot;zh_CN.GBK&quot;</span><br><span class="line">LC_ALL&#x3D;</span><br></pre></td></tr></table></figure>

<h4 id="2、系统字符集为utf-8，securecrt工具的字符集为gb2312，oracle字符集为ZHS16GBK"><a href="#2、系统字符集为utf-8，securecrt工具的字符集为gb2312，oracle字符集为ZHS16GBK" class="headerlink" title="2、系统字符集为utf-8，securecrt工具的字符集为gb2312，oracle字符集为ZHS16GBK"></a>2、系统字符集为utf-8，securecrt工具的字符集为gb2312，oracle字符集为ZHS16GBK</h4><p><img src="https://i.imgur.com/qiqFOFM.png" alt=""><br><img src="https://i.imgur.com/hnIJGRu.png" alt=""><br>如果使用securtcrt工具，设置该工具字符集为gb2312（小于gbk字符集）<br><img src="https://i.imgur.com/BEZzuce.png" alt=""><br>进入操作系统如果操作系统有中文字符，会出现乱码的情况<br><img src="https://i.imgur.com/sUxX2Hi.png" alt=""><br>分别查看以utf8编码的文件和ansi编码的文件<br><img src="https://i.imgur.com/CAvtn4b.png" alt=""><br>以gb2312字符集连接进来的securecrt工具，查看ansi编码的文件正常，查看utf8编码的文件乱码。<br>使用securecrt工具查看数据库中存在中文的数据：<br><img src="https://i.imgur.com/EjipMxx.png" alt=""></p>
<h4 id="3、系统字符集为utf-8，securecrt工具的字符集为urf-8，oracle字符集为ZH16GBK"><a href="#3、系统字符集为utf-8，securecrt工具的字符集为urf-8，oracle字符集为ZH16GBK" class="headerlink" title="3、系统字符集为utf-8，securecrt工具的字符集为urf-8，oracle字符集为ZH16GBK"></a>3、系统字符集为utf-8，securecrt工具的字符集为urf-8，oracle字符集为ZH16GBK</h4><p><img src="https://i.imgur.com/Eyu5H7h.png" alt=""><br><img src="https://i.imgur.com/GBmN4p3.png" alt=""><br><img src="https://i.imgur.com/hnIJGRu.png" alt=""><br>进入操作系统如果操作系统有中文字符，显示正常：<br><img src="https://i.imgur.com/OBz5GMU.png" alt=""><br>分别查看以utf8编码的文件和ansi编码的文件<br><img src="https://i.imgur.com/Lt98yEo.png" alt=""><br>以utf-8字符集连接进来的securecrt工具，查看ansi编码的文件乱码，查看utf8编码的文件正常。<br>使用securecrt工具查看数据库中存在中文的数据：<br><img src="https://i.imgur.com/HlJeZs7.png" alt=""><br>查看带有中文的数据全部显示乱码</p>
<h4 id="4、结论："><a href="#4、结论：" class="headerlink" title="4、结论："></a>4、结论：</h4><p>使用ssh工具连接到服务器是要注意连接工具的字符集，如果只在系统级别操作，要注意保持工具字符集和操作系统字符集的一致性。如果要查询数据库里面带有中文的相关数据，要注意保持工具字符集和操作系统字符集的一致性，否则查询结果会出现乱码。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2019/01/09/linux操作系统字符集与ssh工具字符集配置问题/"><span>点击阅读</span></a></h3>
    
  
</article>






<nav class="pagination">
  
  <a href="/page/7/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/9/" class="pagination-next">下一页</a>
  
</nav>
            </main>
            <div class="sidebar
                    col-lg-3 col-lg-offset-0
                    col-md-3 col-md-offset-0
                    col-sm-12
                    col-xs-12
                    sidebar-container
                ">

                <div class="sidebar-container">



<div class="search-container">
<form class="site-search-form">
    <span class="glyphicon glyphicon-search"></span><input type="text" id="local-search-input" class="st-search-input" placeholder="Search..." />
</form>
<div id="local-search-result" class="local-search-result-cls"></div>
</div>
<script type="text/javascript" id="local.search.active">
var inputArea       = document.querySelector("#local-search-input");
inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script>




    <div class="categories-container" style="margin-top:40px;">
        <p>归档:</p>
            
    </div>




    <div class="social-container" style="margin-top:40px;">
        <p>Links:</p>
            
                
                    <li class="social-item"><i class="fa fa-fw fa-github"></i><a href="https://github.com/zeven0707">GitHub</a></li>
                
            
    </div>

</div>
            </div>
          </div>
        </div>
        
    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/BosenY/Lap" target="_blank">Lap</a>
    <br/><span id="busuanzi_container_site_uv"> 
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    </br>
    
      
        &copy; 2020 zeven0707&#39;s blog
      
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92842840-1', 'auto');
    ga('send', 'pageview');

</script>


  </div>

</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/draw-something/dist/draw.min.js"></script>
  <script>
    let maxNum = Number.parseInt('30')
    let iconText = '❤'
    let color = 'red'
    new Draw({maxNum, iconText, color})
  </script>

<script src="/js/index.js"></script>
<script src="/js/search.js"></script>

</body>
</html>