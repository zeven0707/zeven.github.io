<!DOCTYPE HTML>
<html>
<head >
  <meta charset="utf-8">
  
  <title>第 10 页 | zeven&#39;s blog</title>

  
  <meta name="author" content="zeven0707&#39;s blog">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="zeven&#39;s blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  
  
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5005349780815724",
    enable_page_level_ads: true
  });
</script>

  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?223eea22355699157e147870eb124b24";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <link rel="manifest" href="/manifest.json">
  <link href="/favicon.ico" rel="icon">

  <link rel="alternate" href="/atom.xml" title="zeven&#39;s blog" type="application/atom+xml">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/base/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">


</head>


<body>
<div class="blog">
  <div class="content">

    

    <header class="header-container" style="background-image: url('/images/blog-bg.jpg');">


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header page-scroll">
          <button type="button" id="tglBtn" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">zeven0707&#39;s blog</a>
        </div>
        <div id="bosenyblog-navbar">
          <div class="navbar-collapse" id="bs-example-navbar-collapse-6">
            <ul class="nav navbar-nav navbar-right">
            
              <li><a href="/">主页</a></li>
            
              <li><a href="/archives">日志</a></li>
            
              <li><a href="/about">关于</a></li>
            
              <li><a href="/tags">标签</a></li>
            
            </ul>
          </div>
        </div>

    </div>
 </nav>
 <div class="gotop-btn">

 </div>
</header>

        
        <div class="container ">
          <div class="row">
            <main class="site-main posts-loop    col-lg-8 col-lg-offset-1
                    col-md-8 col-md-offset-1
                    col-sm-12
                    col-xs-12">
            
  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/14/mysql-show table status语法/"><span>[Mysql] mysql-show table status语法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/14/mysql-show table status语法/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-14T09:13:00.000Z">
          2018-11-14
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、使用方法："><a href="#1、使用方法：" class="headerlink" title="1、使用方法："></a>1、使用方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show table status from aaaa like &#39;test_order&#39;;</span><br><span class="line">或</span><br><span class="line">show table status in aaaa like &#39;test_order&#39;;</span><br></pre></td></tr></table></figure>
<p>结果显示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: test_order</span><br><span class="line">         Engine: InnoDB</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Dynamic</span><br><span class="line">           Rows: 84052104</span><br><span class="line"> Avg_row_length: 372</span><br><span class="line">    Data_length: 31321817088</span><br><span class="line">Max_data_length: 0</span><br><span class="line">   Index_length: 25528303616</span><br><span class="line">      Data_free: 7340032</span><br><span class="line"> Auto_increment: 86709693</span><br><span class="line">    Create_time: 2018-11-02 16:20:25</span><br><span class="line">    Update_time: NULL</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: utf8mb4_general_ci</span><br><span class="line">       Checksum: NULL</span><br><span class="line"> Create_options: </span><br><span class="line">        Comment: </span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="2、具体参数详解："><a href="#2、具体参数详解：" class="headerlink" title="2、具体参数详解："></a>2、具体参数详解：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Name:表名</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Engine:表使用的存储引擎</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Version：该列在8.0版本已经废弃，在5.7版本下显示硬编码10</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Row_format：行存储格式（Fixed, Dynamic, Compressed, Redundant, Compact）。对于myisam表，Dynamic值与 myisamchk -dvv查询出来的Packed值相对应。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rows:对于myisam存储引擎，显示实际行数。对于其他引擎，比如innodb，值是近似的(粗略估计），和实际值可能相差40%至50%之间，想要获取准确的值使用select count(*)。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Avg_row_length：平均行长度。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Data_length：对于Myisam表，该值以字节为单位显示数据文件的长度；对于Innodb,该值以字节为单位显示为聚簇索引分配内存的值（近似）。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Max_data_length：对于Myisam表，该值显示数据文件的最大长度。这是可以存储在表中的数据的总字节数，该表给定使用的数据指针大小。对于Innodb，该值已弃用。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Index_length：对于Myisam，该值为索引文件的长度（以字节为单位）。对于Innodb，该值显示内存为非聚簇索引分配的数量（以字节为单位），它是内存页中非聚簇索引大小的总和与</span><br><span class="line">Innodb内存页大小的乘积。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Data_free：已分配但未使用的字节数。Innodb-tables代表当前表所属表空间的可用空间。如果该表位于共享表空间，该值代表共享表空间的剩余空间。如果使用多个表空间，每个表拥有自己的表空间，该值仅代表当前表的剩余空间。剩余空间的意思就是当前完全空闲的区字节数减去一个安全的边界值。即使该值为0，只要新的区可以被分配插入数据也是正常的。</span><br><span class="line">对于NDB集群，该值显示磁盘分配的空间，但是还没有被磁盘数据表或者磁盘数据碎片使用的空间。</span><br><span class="line">对于分区表，该值只是估计值并不准确。想要获取更加准确的方法使用下面方法查询：</span><br><span class="line">SELECT SUM(DATA_FREE) FROM  INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA &#x3D; &#39;mydb&#39; AND TABLE_NAME &#x3D; &#39;mytable&#39;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Auto_increment：下一个自动增长值。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Create_time：表创建时间。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Update_time：数据文件最后更新时间。对于一些存储引擎，该是为null。例如，Innodb存储多个表在系统表空间而且数据文件时间戳没有应用。Innodb表是使用file-per-table模式，每个表都有他自己的.ibd文件，内存buffer写入数据文件存在延迟，因而文件修改时间与最后的插入、更新、删除修改时间是不同的。对于Myisam表，数据文件时间戳是可用的，但是在window系统上，更新并不会更新时间戳，因此该值是不准确的。</span><br><span class="line">对于非分区的Innodb表，该值显示最后update、insert、delete的时间戳的值。对于MVCC，时间戳的值代表commit的时间。如果服务器重启或者该表被数据字典缓存清除，时间戳不会保留。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Check_time：表最后一次检查时间。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collation：表默认的排序规则。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Checksum：校验值。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Create_options：创建表时的额外选项。当执行create table时被保留的原始选项，这些选项与活动表的设置和选项不同。</span><br><span class="line">对于Innodb表，该值显示row_format和key_block_size选项。如果表示分区表，该值会显示partitioned。当创建或者修改一个file-per-table表空间为加密模式时，该值会显示为ENCRYPTIONG(general tablespace除外)。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Comment：创建表空间添加的注释。</span><br></pre></td></tr></table></figure>
<h4 id="3、测试对innodb表添加encryption功能："><a href="#3、测试对innodb表添加encryption功能：" class="headerlink" title="3、测试对innodb表添加encryption功能："></a>3、测试对innodb表添加encryption功能：</h4><p>3.1、安装插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALL PLUGIN keyring_file  soname &#39;keyring_file.so&#39;;</span><br></pre></td></tr></table></figure>
<p>3.2、创建密钥文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;data&#x2F;mysql&#x2F;keyfile</span><br><span class="line">chown mysql.mysql -R &#x2F;data&#x2F;mysql&#x2F;keyfile</span><br></pre></td></tr></table></figure>
<p>3.3、设置key文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set global keyring_file_data&#x3D;&#39;&#x2F;data&#x2F;mysql&#x2F;keyfile&#x2F;key01&#39;;</span><br><span class="line">show global variables like &#39;%keyring_file_data%&#39;;</span><br><span class="line">root@db 16:28:  [aaaa]&gt; show global variables like &#39;%keyring_file_data%&#39;;</span><br><span class="line">+-------------------+---------------------------+</span><br><span class="line">| Variable_name     | Value                     |</span><br><span class="line">+-------------------+---------------------------+</span><br><span class="line">| keyring_file_data | &#x2F;data&#x2F;mysql&#x2F;keyfile&#x2F;key01 |</span><br><span class="line">+-------------------+---------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>3.4、查看插件状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:27:  [aaaa]&gt; SELECT PLUGIN_NAME, PLUGIN_STATUS</span><br><span class="line">    -&gt;        FROM INFORMATION_SCHEMA.PLUGINS</span><br><span class="line">    -&gt;        WHERE PLUGIN_NAME LIKE &#39;keyring%&#39;;</span><br><span class="line">+--------------+---------------+</span><br><span class="line">| PLUGIN_NAME  | PLUGIN_STATUS |</span><br><span class="line">+--------------+---------------+</span><br><span class="line">| keyring_file | ACTIVE        |</span><br><span class="line">+--------------+---------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>3.5、表aa未加密时，查看表状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:29:  [aaaa]&gt; show table status from aaaa like &#39;aa&#39;;</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+--------------------+----------+----------------+---------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time | Check_time | Collation          | Checksum | Create_options | Comment |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+--------------------+----------+----------------+---------+</span><br><span class="line">| aa   | InnoDB |      10 | Dynamic    |   12 |           1365 |       16384 |               0 |            0 |         0 |           NULL | 2018-10-29 17:30:47 | NULL        | NULL       | utf8mb4_general_ci |     NULL |                |         |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+--------------------+----------+----------------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>3.6、对表aa进行加密：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:29:  [aaaa]&gt; alter table aa encryption&#x3D;&#39;Y&#39;;</span><br><span class="line">Query OK, 12 rows affected (5.13 sec)</span><br><span class="line">Records: 12  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>3.7、再次查看表aa状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:30:  [aaaa]&gt; show table status from aaaa like &#39;aa&#39;;</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+--------------------+----------+----------------+---------+</span><br><span class="line">| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time         | Check_time | Collation          | Checksum | Create_options | Comment |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+--------------------+----------+----------------+---------+</span><br><span class="line">| aa   | InnoDB |      10 | Dynamic    |   12 |           1365 |       16384 |               0 |            0 |         0 |           NULL | 2018-11-14 16:30:16 | 2018-11-14 16:30:14 | NULL       | utf8mb4_general_ci |     NULL | ENCRYPTION&#x3D;&quot;Y&quot; |         |</span><br><span class="line">+------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+---------------------+------------+--------------------+----------+----------------+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h4 id="4、下面为大佬提供的方便查询数据库下所有表所占行数（估计）和占用空间的存储过程，点此跳转至原文，具体内容如下："><a href="#4、下面为大佬提供的方便查询数据库下所有表所占行数（估计）和占用空间的存储过程，点此跳转至原文，具体内容如下：" class="headerlink" title="4、下面为大佬提供的方便查询数据库下所有表所占行数（估计）和占用空间的存储过程，点此跳转至原文，具体内容如下："></a>4、下面为大佬提供的方便查询数据库下所有表所占行数（估计）和占用空间的存储过程，点此<a href="http://en.latindevelopers.com/ivancp/2012/a-better-show-table-status/" target="_blank" rel="noopener">跳转</a>至原文，具体内容如下：</h4><p>4.1、存储过程所在的aaaa数据库，可根据自己数据库情况自行修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">DROP PROCEDURE IF EXISTS &#96;aaaa&#96;.&#96;sp_status&#96; $$</span><br><span class="line">CREATE PROCEDURE &#96;aaaa&#96;.&#96;sp_status&#96;(dbname VARCHAR(50))</span><br><span class="line">BEGIN </span><br><span class="line">-- Obtaining tables and views</span><br><span class="line">(</span><br><span class="line">    SELECT </span><br><span class="line">     TABLE_NAME AS &#96;Table Name&#96;, </span><br><span class="line">     ENGINE AS &#96;Engine&#96;,</span><br><span class="line">     TABLE_ROWS AS &#96;Rows&#96;,</span><br><span class="line">     CONCAT(</span><br><span class="line">        (FORMAT((DATA_LENGTH + INDEX_LENGTH) &#x2F; POWER(1024,2),2))</span><br><span class="line">        , &#39; Mb&#39;)</span><br><span class="line">       AS &#96;Size&#96;,</span><br><span class="line">     TABLE_COLLATION AS &#96;Collation&#96;</span><br><span class="line">    FROM information_schema.TABLES</span><br><span class="line">    WHERE TABLES.TABLE_SCHEMA &#x3D; dbname</span><br><span class="line">          AND TABLES.TABLE_TYPE &#x3D; &#39;BASE TABLE&#39;</span><br><span class="line">)</span><br><span class="line">UNION</span><br><span class="line">(</span><br><span class="line">    SELECT </span><br><span class="line">     TABLE_NAME AS &#96;Table Name&#96;, </span><br><span class="line">     &#39;[VIEW]&#39; AS &#96;Engine&#96;,</span><br><span class="line">     &#39;-&#39; AS &#96;Rows&#96;,</span><br><span class="line">     &#39;-&#39; &#96;Size&#96;,</span><br><span class="line">     &#39;-&#39; AS &#96;Collation&#96;</span><br><span class="line">    FROM information_schema.TABLES</span><br><span class="line">    WHERE TABLES.TABLE_SCHEMA &#x3D; dbname </span><br><span class="line">          AND TABLES.TABLE_TYPE &#x3D; &#39;VIEW&#39;</span><br><span class="line">)</span><br><span class="line">ORDER BY 1;</span><br><span class="line">-- Obtaining functions, procedures and triggers</span><br><span class="line">(</span><br><span class="line">    SELECT ROUTINE_NAME AS &#96;Routine Name&#96;, </span><br><span class="line">     ROUTINE_TYPE AS &#96;Type&#96;,</span><br><span class="line">     &#39;&#39; AS &#96;Comment&#96;</span><br><span class="line">    FROM information_schema.ROUTINES</span><br><span class="line">    WHERE ROUTINE_SCHEMA &#x3D; dbname</span><br><span class="line">    ORDER BY ROUTINES.ROUTINE_TYPE, ROUTINES.ROUTINE_NAME</span><br><span class="line">)</span><br><span class="line">UNION</span><br><span class="line">(</span><br><span class="line">    SELECT TRIGGER_NAME,&#39;TRIGGER&#39; AS &#96;Type&#96;, </span><br><span class="line">    concat(&#39;On &#39;,EVENT_MANIPULATION,&#39;: &#39;,EVENT_OBJECT_TABLE) AS &#96;Comment&#96;</span><br><span class="line">    FROM information_schema.TRIGGERS</span><br><span class="line">    WHERE EVENT_OBJECT_SCHEMA &#x3D; dbname</span><br><span class="line">)</span><br><span class="line">ORDER BY 2,1;</span><br><span class="line">END$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>4.2、执行存储过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call aaaa.sp_status(&#39;aaaa&#39;);</span><br></pre></td></tr></table></figure>
<p>4.3、结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:58:  [aaaa]&gt; call aaaa.sp_status(&#39;aaaa&#39;);</span><br><span class="line">+--------------+--------+----------+--------------+--------------------+</span><br><span class="line">| Table Name   | Engine | Rows     | Size         | Collation          |</span><br><span class="line">+--------------+--------+----------+--------------+--------------------+</span><br><span class="line">| aa           | InnoDB | 12       | 0.02 Mb      | utf8mb4_general_ci |</span><br><span class="line">| sequence     | InnoDB | 12292293 | 515.98 Mb    | utf8mb4_general_ci |</span><br><span class="line">| test         | InnoDB | 0        | 0.02 Mb      | utf8mb4_general_ci |</span><br><span class="line">| test1        | InnoDB | 6        | 0.02 Mb      | utf8mb4_general_ci |</span><br><span class="line">| test_order  | InnoDB | 84052104 | 54,216.50 Mb | utf8mb4_general_ci |</span><br><span class="line">+--------------+--------+----------+--------------+--------------------+</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/14/mysql-show table status语法/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/12/vsftpd配置ssl/"><span>[Linux] vsftpd配置ssl</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/12/vsftpd配置ssl/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-12T11:09:30.000Z">
          2018-11-12
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="0、如果还没有部署vsftp-server，请先跳转到此处"><a href="#0、如果还没有部署vsftp-server，请先跳转到此处" class="headerlink" title="0、如果还没有部署vsftp-server，请先跳转到此处"></a>0、如果还没有部署vsftp-server，请先跳转到<a href="https://zeven0707.github.io/2018/11/06/centos%E5%AE%89%E8%A3%85vsftp/" target="_blank" rel="noopener">此处</a></h4><h4 id="1、查询vsftpd软件是否支持SSL"><a href="#1、查询vsftpd软件是否支持SSL" class="headerlink" title="1、查询vsftpd软件是否支持SSL"></a>1、查询vsftpd软件是否支持SSL</h4><p>ldd /usr/sbin/vsftpd | grep ssl   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libssl.so.10 &#x3D;&gt; &#x2F;lib64&#x2F;libssl.so.10 (0x00007f6cfc4a6000)</span><br></pre></td></tr></table></figure>

<h4 id="2、生成vsftpd-pem-证书"><a href="#2、生成vsftpd-pem-证书" class="headerlink" title="2、生成vsftpd.pem 证书"></a>2、生成vsftpd.pem 证书</h4><p>[root@localhost vsftpd]# openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout /etc/vsftpd/vsftpd.pem -out /etc/vsftpd/vsftpd.pem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Generating a 1024 bit RSA private key</span><br><span class="line">..................................++++++</span><br><span class="line">.........++++++</span><br><span class="line">writing new private key to &#39;&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.pem&#39;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:cn</span><br><span class="line">State or Province Name (full name) []:beijing</span><br><span class="line">Locality Name (eg, city) [Default City]:beijing</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:goopal</span><br><span class="line">Organizational Unit Name (eg, section) []:goopal</span><br><span class="line">Common Name (eg, your name or your server&#39;s hostname) []:zeven</span><br><span class="line">Email Address []:test@goopal.com</span><br></pre></td></tr></table></figure>
<p>查看生成vsftpd.pem是否成功<br>ls -l /etc/vsftpd/|grep vsftpd.pem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 root root 1982 11月  9 14:20 vsftpd.pem</span><br></pre></td></tr></table></figure>

<h4 id="3、修改主配置文件-etc-vsftpd-vsftpd-conf"><a href="#3、修改主配置文件-etc-vsftpd-vsftpd-conf" class="headerlink" title="3、修改主配置文件/etc/vsftpd/vsftpd.conf"></a>3、修改主配置文件/etc/vsftpd/vsftpd.conf</h4><p>下面是ssl参数一些定义，根据自己需求去修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ssl_enable&#x3D;yes&#x2F;no             是否启用 SSL,默认为no</span><br><span class="line">allow_anon_ssl&#x3D;yes&#x2F;no         是否允许匿名用户使用SSL,默认为no</span><br><span class="line">rsa_cert_file&#x3D;&#x2F;path&#x2F;to&#x2F;file       rsa证书的位置</span><br><span class="line">dsa_cert_file&#x3D;&#x2F;path&#x2F;to&#x2F;file      dsa证书的位置</span><br><span class="line">force_local_logins_ssl&#x3D;yes&#x2F;no    非匿名用户登陆时是否加密,默认为yes</span><br><span class="line">force_local_data_ssl&#x3D;yes&#x2F;no     非匿名用户传输数据时是否加密,默认为yes</span><br><span class="line">force_anon_logins_ssl&#x3D;yes&#x2F;no    匿名用户登录时是否加密,默认为no</span><br><span class="line">force_anon_data_ssl&#x3D;yes&#x2F;no     匿名用户数据传输时是否加密,默认为no</span><br><span class="line">ssl_sslv2&#x3D;yes&#x2F;no               是否激活sslv2加密,默认no</span><br><span class="line">ssl_sslv3&#x3D;yes&#x2F;no                是否激活sslv3加密,默认no</span><br><span class="line">ssl_tlsv1&#x3D;yes&#x2F;no                是否激活tls v1加密,默认yes</span><br><span class="line">ssl_ciphers&#x3D;加密方法            默认是DES-CBC3-SHA</span><br><span class="line">require_ssl_reuse&#x3D;no 需要数据与控制流使用相同的ssl通道，程序是另起一个ssl通道，选no</span><br><span class="line">#使用ftps的情况下，主动模式是不能用的，必须使用别动模式，为考虑安全问题，可以指定被动端口范围：</span><br><span class="line">pasv_enable&#x3D;YES</span><br><span class="line">pasv_min_port&#x3D;20000</span><br><span class="line">pasv_max_port&#x3D;20001</span><br></pre></td></tr></table></figure>
<p>修改vsftpd的主配置文件vsftpd.conf添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ssl_enable&#x3D;YES</span><br><span class="line">allow_anon_ssl&#x3D;YES</span><br><span class="line">force_anon_logins_ssl&#x3D;YES</span><br><span class="line">force_anon_data_ssl&#x3D;YES</span><br><span class="line">force_local_logins_ssl&#x3D;YES</span><br><span class="line">force_local_data_ssl&#x3D;YES</span><br><span class="line">ssl_tlsv1&#x3D;YES</span><br><span class="line">ssl_sslv2&#x3D;NO</span><br><span class="line">ssl_sslv3&#x3D;NO</span><br><span class="line">rsa_cert_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.pem</span><br><span class="line">require_ssl_reuse&#x3D;no</span><br><span class="line">pasv_enable&#x3D;YES</span><br><span class="line">pasv_min_port&#x3D;20000</span><br><span class="line">pasv_max_port&#x3D;20001</span><br></pre></td></tr></table></figure>
<h4 id="4、重启vsftpd服务"><a href="#4、重启vsftpd服务" class="headerlink" title="4、重启vsftpd服务"></a>4、重启vsftpd服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpd</span><br></pre></td></tr></table></figure>
<h4 id="5、默认linux自带的ftp-client不支持ssl协议，如果配置了ssl，使用ftp-client连接会报错"><a href="#5、默认linux自带的ftp-client不支持ssl协议，如果配置了ssl，使用ftp-client连接会报错" class="headerlink" title="5、默认linux自带的ftp client不支持ssl协议，如果配置了ssl，使用ftp client连接会报错"></a>5、默认linux自带的ftp client不支持ssl协议，如果配置了ssl，使用ftp client连接会报错</h4><p><img src="https://i.imgur.com/gklzknf.png" alt=""><br>可以使用第三方的surgeftp测试，下载方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp:&#x2F;&#x2F;ftp.netwinsite.com&#x2F;pub&#x2F;surgeftp&#x2F;surgeftp_23f2_linux64.tar.gz</span><br></pre></td></tr></table></figure>
<p>解压之后，测试连接是否正常：<br><img src="https://i.imgur.com/8blhpQc.png" alt=""><br>也可以使用windows下的ftp软件测试，如FileZilla，配置方法如下：<br><img src="https://i.imgur.com/UUcMQL8.png" alt=""></p>
<h4 id="6、配置过程终于到的问题："><a href="#6、配置过程终于到的问题：" class="headerlink" title="6、配置过程终于到的问题："></a>6、配置过程终于到的问题：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">522 SSL connection failed; session reuse required: see require_ssl_reuse option in vsftpd.conf man page</span><br><span class="line">解决方法：</span><br><span class="line">查看vsftpd.conf配置文件是否配置了下面参数</span><br><span class="line">require_ssl_reuse&#x3D;no</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/12/vsftpd配置ssl/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/09/mysql-mgr解散集群并重新添加/"><span>[Mysql] mysql-mgr解散集群并重新加入集群</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/09/mysql-mgr解散集群并重新添加/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-09T09:21:00.000Z">
          2018-11-09
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、查看集群状态"><a href="#1、查看集群状态" class="headerlink" title="1、查看集群状态"></a>1、查看集群状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster &#x3D; dba.getCluster(&quot;prodCluster&quot;)</span><br><span class="line">&lt;Cluster:prodCluster&gt;</span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status()</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、解散集群："><a href="#2、解散集群：" class="headerlink" title="2、解散集群："></a>2、解散集群：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.dissolve()</span><br><span class="line">The cluster still has active ReplicaSets.</span><br><span class="line">Please use cluster.dissolve(&#123;force: true&#125;) to deactivate replication</span><br><span class="line">and unregister the ReplicaSets from the cluster.</span><br><span class="line"></span><br><span class="line">The following replicasets are currently registered:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;topology&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;label&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;label&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.dissolve(&#123;force: true&#125;)</span><br><span class="line">WARNING: On instance &#39;dax-mysql-slave:3306&#39; configuration cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please set the &#39;group_replication_start_on_boot&#39; variable to &#39;OFF&#39; in the server configuration file, otherwise it might rejoin the cluster upon restart.</span><br><span class="line">WARNING: On instance &#39;dax-mysql-master:3306&#39; configuration cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please set the &#39;group_replication_start_on_boot&#39; variable to &#39;OFF&#39; in the server configuration file, otherwise it might rejoin the cluster upon restart.</span><br><span class="line">The cluster was successfully dissolved.</span><br><span class="line">Replication was disabled but user data was left intact.</span><br></pre></td></tr></table></figure>
<h4 id="3、查看集群信息已经被删掉了："><a href="#3、查看集群信息已经被删掉了：" class="headerlink" title="3、查看集群信息已经被删掉了："></a>3、查看集群信息已经被删掉了：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:54:  [mysql_innodb_cluster_metadata]&gt; select * from clusters;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="4、重新建立集群："><a href="#4、重新建立集群：" class="headerlink" title="4、重新建立集群："></a>4、重新建立集群：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MySQL  dax-mysql-master:3306  JS &gt; var cluster &#x3D; dba.createCluster(&#39;prodCluster&#39;);</span><br><span class="line">A new InnoDB cluster will be created on instance &#39;repl@dax-mysql-master:3306&#39;.</span><br><span class="line"></span><br><span class="line">Validating instance at dax-mysql-master:3306...</span><br><span class="line"></span><br><span class="line">This instance reports its own address as dax-mysql-master</span><br><span class="line">WARNING: The following tables do not have a Primary Key or equivalent column: </span><br><span class="line">aaaa.test</span><br><span class="line"></span><br><span class="line">Group Replication requires tables to use InnoDB and have a PRIMARY KEY or PRIMARY KEY Equivalent (non-null unique key). Tables that do not follow these requirements will be readable but not updateable when used with Group Replication. If your applications make updates (INSERT, UPDATE or DELETE) to these tables, ensure they use the InnoDB storage engine and have a PRIMARY KEY or PRIMARY KEY Equivalent.</span><br><span class="line"></span><br><span class="line">Instance configuration is suitable.</span><br><span class="line">Creating InnoDB cluster &#39;prodCluster&#39; on &#39;repl@dax-mysql-master:3306&#39;...</span><br><span class="line">WARNING: On instance &#39;dax-mysql-master:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">Adding Seed Instance...</span><br><span class="line"></span><br><span class="line">Cluster successfully created. Use Cluster.addInstance() to add MySQL instances.</span><br><span class="line">At least 3 instances are needed for the cluster to be able to withstand up to</span><br><span class="line">one server failure.</span><br></pre></td></tr></table></figure>
<h4 id="5、-查看集群状态，现在只有一个节点信息"><a href="#5、-查看集群状态，现在只有一个节点信息" class="headerlink" title="5、 查看集群状态，现在只有一个节点信息"></a>5、 查看集群状态，现在只有一个节点信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6、添加新的节点："><a href="#6、添加新的节点：" class="headerlink" title="6、添加新的节点："></a>6、添加新的节点：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cluster.addInstance(&#39;dax-mysql-slave:3306&#39;)</span><br><span class="line"></span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.addInstance(&#39;dax-mysql-slave:3306&#39;)</span><br><span class="line">A new instance will be added to the InnoDB cluster. Depending on the amount of</span><br><span class="line">data on the cluster this might take from a few seconds to several hours.</span><br><span class="line"></span><br><span class="line">Please provide the password for &#39;root@dax-mysql-slave:3306&#39;: ********</span><br><span class="line">Adding instance to the cluster ...</span><br><span class="line"></span><br><span class="line">Validating instance at dax-mysql-slave:3306...</span><br><span class="line"></span><br><span class="line">This instance reports its own address as dax-mysql-slave</span><br><span class="line">WARNING: The following tables do not have a Primary Key or equivalent column: </span><br><span class="line">aaaa.test</span><br><span class="line"></span><br><span class="line">Group Replication requires tables to use InnoDB and have a PRIMARY KEY or PRIMARY KEY Equivalent (non-null unique key). Tables that do not follow these requirements will be readable but not updateable when used with Group Replication. If your applications make updates (INSERT, UPDATE or DELETE) to these tables, ensure they use the InnoDB storage engine and have a PRIMARY KEY or PRIMARY KEY Equivalent.</span><br><span class="line"></span><br><span class="line">Instance configuration is suitable.</span><br><span class="line">WARNING: On instance &#39;dax-mysql-slave:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">WARNING: On instance &#39;dax-mysql-master:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">The instance &#39;root@dax-mysql-slave:3306&#39; was successfully added to the cluster.</span><br></pre></td></tr></table></figure>
<h4 id="7、查看集群状态，可以看到两个节点了："><a href="#7、查看集群状态，可以看到两个节点了：" class="headerlink" title="7、查看集群状态，可以看到两个节点了："></a>7、查看集群状态，可以看到两个节点了：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root@db 17:14:  [mysql_innodb_cluster_metadata]&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST      | MEMBER_PORT | MEMBER_STATE |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| group_replication_applier | bddd9c32-8fee-11e8-ac79-525400edbe8d | dax-mysql-slave  |        3306 | ONLINE       |</span><br><span class="line">| group_replication_applier | d5bd8edd-9a1d-11e8-993e-525400578639 | dax-mysql-master |        3306 | ONLINE       |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@db 17:14:  [mysql_innodb_cluster_metadata]&gt; show status like &#39;%primary%&#39;;</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">| Variable_name                    | Value                                |</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">| group_replication_primary_member | d5bd8edd-9a1d-11e8-993e-525400578639 |</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/09/mysql-mgr解散集群并重新添加/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/09/mysql-mgr单主模式切换为多主/"><span>[Mysql] mysql-mgr单主模式切换为多主，多主切换为单主</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/09/mysql-mgr单主模式切换为多主/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-09T03:54:00.000Z">
          2018-11-09
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、停止组复制-所有节点执行-："><a href="#1、停止组复制-所有节点执行-：" class="headerlink" title="1、停止组复制(所有节点执行)："></a>1、停止组复制(所有节点执行)：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; stop group_replication; </span><br><span class="line">mysql&gt; set global group_replication_single_primary_mode&#x3D;OFF; </span><br><span class="line">mysql&gt; set global group_replication_enforce_update_everywhere_checks&#x3D;ON;</span><br></pre></td></tr></table></figure>
<h4 id="2、随便选择某个节点执行"><a href="#2、随便选择某个节点执行" class="headerlink" title="2、随便选择某个节点执行"></a>2、随便选择某个节点执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL group_replication_bootstrap_group&#x3D;ON; </span><br><span class="line">mysql&gt; START GROUP_REPLICATION; </span><br><span class="line">mysql&gt; SET GLOBAL group_replication_bootstrap_group&#x3D;OFF;</span><br></pre></td></tr></table></figure>
<h4 id="3、其他节点执行"><a href="#3、其他节点执行" class="headerlink" title="3、其他节点执行"></a>3、其他节点执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure>
<p>查看节点启动报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2018-11-08T14:00:52.098660Z 56 [ERROR] Plugin group_replication reported: &#39;There was an error when connecting to the donor server. Please check that group_replication_recovery channel credentials and all MEMBER_HOST column values of performance_schema.replication_group_members table are correct and DNS resolvable.&#39;</span><br><span class="line">2018-11-08T14:00:52.098689Z 56 [ERROR] Plugin group_replication reported: &#39;For details please check performance_schema.replication_connection_status table and error log messages of Slave I&#x2F;O for channel group_replication_recovery.&#39;</span><br></pre></td></tr></table></figure>
<p>手动配置复制信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master to master_user&#x3D;&#39;repl&#39;,master_password&#x3D;&#39;12345678&#39; for channel &#39;group_replication_recovery&#39;;</span><br></pre></td></tr></table></figure>
<p>再次启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure>

<h4 id="4、查看组信息，所有节点的信息正常，所有节点均为主："><a href="#4、查看组信息，所有节点的信息正常，所有节点均为主：" class="headerlink" title="4、查看组信息，所有节点的信息正常，所有节点均为主："></a>4、查看组信息，所有节点的信息正常，所有节点均为主：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST      | MEMBER_PORT | MEMBER_STATE |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| group_replication_applier | bddd9c32-8fee-11e8-ac79-525400edbe8d | dax-mysql-slave  |        3306 | ONLINE       |</span><br><span class="line">| group_replication_applier | d5bd8edd-9a1d-11e8-993e-525400578639 | dax-mysql-master |        3306 | ONLINE       |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br></pre></td></tr></table></figure>

<h4 id="5、查看集群状态"><a href="#5、查看集群状态" class="headerlink" title="5、查看集群状态"></a>5、查看集群状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster &#x3D; dba.getCluster(&quot;prodCluster&quot;)</span><br><span class="line">&lt;Cluster:prodCluster&gt;</span><br><span class="line"></span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">Cluster.status: The InnoDB Cluster topology type (Single-Master) does not match the current Group Replication configuration (Multi-Master). Please use &lt;cluster&gt;.rescan() or change the Group Replication configuration accordingly. (RuntimeError)</span><br></pre></td></tr></table></figure>
<p>提示cluster 拓扑类型为单主与当前的mgr(多主)不匹配，使用cluster.rescan()参数重新扫描：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.rescan()</span><br><span class="line">Rescanning the cluster...</span><br><span class="line"></span><br><span class="line">Result of the rescanning operation:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;newlyDiscoveredInstances&quot;: [], </span><br><span class="line">        &quot;unavailableInstances&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次查看集群状态仍然报错：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">Cluster.status: The InnoDB Cluster topology type (Single-Master) does not match the current Group Replication configuration (Multi-Master). Please use &lt;cluster&gt;.rescan() or change the Group Replication configuration accordingly. (RuntimeError)</span><br></pre></td></tr></table></figure><br>尝试删除集群元数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dba.dropMetadataSchema();</span><br><span class="line">Are you sure you want to remove the Metadata? [y&#x2F;N]: y</span><br><span class="line">Metadata Schema successfully removed.</span><br></pre></td></tr></table></figure>
<p>重新创建集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var cluster &#x3D; dba.createCluster(&#39;prodCluster&#39;, &#123;adoptFromGR: true ,force: true&#125;);</span><br></pre></td></tr></table></figure>
<p>报错提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Plugin group_replication reported: &#39;Table instances has a foreign key with &#39;CASCADE&#39; clause. This is not compatible with Group Replication&#39;</span><br></pre></td></tr></table></figure>
<p>创建集群会在mysql_innodb_cluster_metadata库下建立一个instances的表，在单主模式下创建集群没有外键级联的报错问题，在多主模式下提示有外键级联的问题，表内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;instances&#96; (</span><br><span class="line">  &#96;instance_id&#96; int(10) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;host_id&#96; int(10) unsigned NOT NULL,</span><br><span class="line">  &#96;replicaset_id&#96; int(10) unsigned DEFAULT NULL,</span><br><span class="line">  &#96;mysql_server_uuid&#96; varchar(40) NOT NULL,</span><br><span class="line">  &#96;instance_name&#96; varchar(256) NOT NULL,</span><br><span class="line">  &#96;role&#96; enum(&#39;HA&#39;,&#39;readScaleOut&#39;) NOT NULL,</span><br><span class="line">  &#96;weight&#96; float DEFAULT NULL,</span><br><span class="line">  &#96;addresses&#96; json NOT NULL,</span><br><span class="line">  &#96;attributes&#96; json DEFAULT NULL,</span><br><span class="line">  &#96;version_token&#96; int(10) unsigned DEFAULT NULL,</span><br><span class="line">  &#96;description&#96; text,</span><br><span class="line">  PRIMARY KEY (&#96;instance_id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;mysql_server_uuid&#96; (&#96;mysql_server_uuid&#96;),</span><br><span class="line">  UNIQUE KEY &#96;instance_name&#96; (&#96;instance_name&#96;),</span><br><span class="line">  KEY &#96;host_id&#96; (&#96;host_id&#96;),</span><br><span class="line">  KEY &#96;instances_ibfk_2&#96; (&#96;replicaset_id&#96;),</span><br><span class="line">  CONSTRAINT &#96;instances_ibfk_1&#96; FOREIGN KEY (&#96;host_id&#96;) REFERENCES &#96;hosts&#96; (&#96;host_id&#96;),</span><br><span class="line">  CONSTRAINT &#96;instances_ibfk_2&#96; FOREIGN KEY (&#96;replicaset_id&#96;) REFERENCES &#96;replicasets&#96; (&#96;replicaset_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4</span><br></pre></td></tr></table></figure>
<p>查阅官方文档有提示说多主模式下存在这个<a href="https://bugs.mysql.com/bug.php?id=91972" target="_blank" rel="noopener">bug</a>，将该表下的外键约束去掉：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE &#96;mysql_innodb_cluster_metadata&#96;.&#96;instances&#96; DROP FOREIGN KEY &#96;instances_ibfk_1&#96;;</span><br><span class="line">ALTER TABLE &#96;mysql_innodb_cluster_metadata&#96;.&#96;instances&#96; DROP FOREIGN KEY &#96;instances_ibfk_2&#96;;</span><br></pre></td></tr></table></figure>
<p>重建添加外键使用下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE &#96;mysql_innodb_cluster_metadata&#96;.&#96;instances&#96; ADD CONSTRAINT &#96;instances_ibfk_1&#96; FOREIGN KEY (&#96;host_id&#96;) REFERENCES &#96;hosts&#96; (&#96;host_id&#96;);</span><br><span class="line">ALTER TABLE &#96;mysql_innodb_cluster_metadata&#96;.&#96;instances&#96; ADD CONSTRAINT &#96;instances_ibfk_2&#96; </span><br><span class="line">FOREIGN KEY (&#96;replicaset_id&#96;) REFERENCES &#96;replicasets&#96; (&#96;replicaset_id&#96;);</span><br></pre></td></tr></table></figure>
<p>将外键约束删除之后，重新创建集群：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; var cluster &#x3D; dba.createCluster(&#39;prodCluster&#39;, &#123;adoptFromGR: true ,force: true&#125;);</span><br><span class="line">A new InnoDB cluster will be created based on the existing replication group on instance &#39;repl@dax-mysql-master:3306&#39;.</span><br><span class="line"></span><br><span class="line">Creating InnoDB cluster &#39;prodCluster&#39; on &#39;repl@dax-mysql-master:3306&#39;...</span><br><span class="line">Adding Instance &#39;dax-mysql-slave:3306&#39;...</span><br><span class="line">Adding Instance &#39;dax-mysql-master:3306&#39;...</span><br><span class="line"></span><br><span class="line">Cluster successfully created based on existing replication group.</span><br></pre></td></tr></table></figure>
<p>集群创建成功，查看集群状态,两个节点均为读写模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status()</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6、mysql-mgr多主模式切换成功，现在将模式从多主切换为单主："><a href="#6、mysql-mgr多主模式切换成功，现在将模式从多主切换为单主：" class="headerlink" title="6、mysql-mgr多主模式切换成功，现在将模式从多主切换为单主："></a>6、mysql-mgr多主模式切换成功，现在将模式从多主切换为单主：</h4><h4 id="7、所有节点执行"><a href="#7、所有节点执行" class="headerlink" title="7、所有节点执行"></a>7、所有节点执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; stop group_replication; </span><br><span class="line">mysql&gt; set global group_replication_enforce_update_everywhere_checks&#x3D;OFF; </span><br><span class="line">mysql&gt; set global group_replication_single_primary_mode&#x3D;ON;</span><br></pre></td></tr></table></figure>
<h4 id="8、主节点（dax-mysql-master）执行"><a href="#8、主节点（dax-mysql-master）执行" class="headerlink" title="8、主节点（dax-mysql-master）执行"></a>8、主节点（dax-mysql-master）执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL group_replication_bootstrap_group&#x3D;ON; </span><br><span class="line">START GROUP_REPLICATION; </span><br><span class="line">SET GLOBAL group_replication_bootstrap_group&#x3D;OFF;</span><br></pre></td></tr></table></figure>
<h4 id="9、从节点执行："><a href="#9、从节点执行：" class="headerlink" title="9、从节点执行："></a>9、从节点执行：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure>
<h4 id="10、查看MGR组信息-所有节点同步正常："><a href="#10、查看MGR组信息-所有节点同步正常：" class="headerlink" title="10、查看MGR组信息,所有节点同步正常："></a>10、查看MGR组信息,所有节点同步正常：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST      | MEMBER_PORT | MEMBER_STATE |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| group_replication_applier | bddd9c32-8fee-11e8-ac79-525400edbe8d | dax-mysql-slave  |        3306 | ONLINE       |</span><br><span class="line">| group_replication_applier | d5bd8edd-9a1d-11e8-993e-525400578639 | dax-mysql-master |        3306 | ONLINE       |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br></pre></td></tr></table></figure>
<p>查看当前主节点信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;%primary%&#39;;</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">| Variable_name                    | Value                                |</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">| group_replication_primary_member | d5bd8edd-9a1d-11e8-993e-525400578639 |</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h4 id="11、登录mysql-shell查看集群信息："><a href="#11、登录mysql-shell查看集群信息：" class="headerlink" title="11、登录mysql-shell查看集群信息："></a>11、登录mysql-shell查看集群信息：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MySQL  dax-mysql-master:3306  JS &gt; cluster &#x3D; dba.getCluster(&quot;prodCluster&quot;)</span><br><span class="line">&lt;Cluster:prodCluster&gt;</span><br><span class="line"></span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">Cluster.status: The InnoDB Cluster topology type (Multi-Master) does not match the current Group Replication configuration (Single-Master). Please use &lt;cluster&gt;.rescan() or change the Group Replication configuration accordingly. (RuntimeError)</span><br><span class="line"></span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.rescan()</span><br><span class="line">Rescanning the cluster...</span><br><span class="line"></span><br><span class="line">Result of the rescanning operation:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;newlyDiscoveredInstances&quot;: [], </span><br><span class="line">        &quot;unavailableInstances&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">Cluster.status: The InnoDB Cluster topology type (Multi-Master) does not match the current Group Replication configuration (Single-Master). Please use &lt;cluster&gt;.rescan() or change the Group Replication configuration accordingly. (RuntimeError)</span><br></pre></td></tr></table></figure>
<p>跟多主切换为单主报错相同，尝试删除集群元数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dba.dropMetadataSchema();</span><br><span class="line">Are you sure you want to remove the Metadata? [y&#x2F;N]: y</span><br><span class="line">Metadata Schema successfully removed.</span><br></pre></td></tr></table></figure>
<p>重新创建集群：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; var cluster &#x3D; dba.createCluster(&#39;prodCluster&#39;, &#123;adoptFromGR: true&#125;);</span><br><span class="line">A new InnoDB cluster will be created based on the existing replication group on instance &#39;repl@dax-mysql-master:3306&#39;.</span><br><span class="line"></span><br><span class="line">Creating InnoDB cluster &#39;prodCluster&#39; on &#39;repl@dax-mysql-master:3306&#39;...</span><br><span class="line">Adding Seed Instance...</span><br><span class="line">Adding Instance &#39;dax-mysql-slave:3306&#39;...</span><br><span class="line"></span><br><span class="line">Cluster successfully created based on existing replication group.</span><br></pre></td></tr></table></figure>
<p>集群创建成功，查看集群状态为一主一从模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt;  cluster.status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/09/mysql-mgr单主模式切换为多主/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/09/mysql-mgr（双节点依次修改server-id)/"><span>[Mysql] mysql-mgr（双节点)依次修改server-id</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/09/mysql-mgr（双节点依次修改server-id)/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-09T02:18:00.000Z">
          2018-11-09
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、查看从节点server-id信息："><a href="#1、查看从节点server-id信息：" class="headerlink" title="1、查看从节点server-id信息："></a>1、查看从节点server-id信息：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:55:  [(none)]&gt; show variables like &quot;%server%&quot;;</span><br><span class="line">+---------------------------------------------------+--------------------------------------+</span><br><span class="line">| Variable_name                                     | Value                                |</span><br><span class="line">+---------------------------------------------------+--------------------------------------+</span><br><span class="line">| character_set_server                              | utf8mb4                              |</span><br><span class="line">| collation_server                                  | utf8mb4_general_ci                   |</span><br><span class="line">| group_replication_recovery_ssl_verify_server_cert | OFF                                  |</span><br><span class="line">| innodb_ft_server_stopword_table                   |                                      |</span><br><span class="line">| server_id                                         | 3306102                              |</span><br><span class="line">| server_id_bits                                    | 32                                   |</span><br><span class="line">| server_uuid                                       | bddd9c32-8fee-11e8-ac79-525400edbe8d |</span><br><span class="line">+---------------------------------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="2、登录mysql-shell查看集群信息："><a href="#2、登录mysql-shell查看集群信息：" class="headerlink" title="2、登录mysql-shell查看集群信息："></a>2、登录mysql-shell查看集群信息：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">MySQL  dax-mysql-master:3306  JS &gt; cluster &#x3D; dba.getCluster(&quot;prodCluster&quot;)</span><br><span class="line">MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将从节点移除集群：<br>MySQL  dax-mysql-master:3306  JS &gt; cluster.removeInstance(‘dax-mysql-slave:3306’)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">The instance will be removed from the InnoDB cluster. Depending on the </span><br><span class="line">instance being the Seed or not, the Metadata session might become invalid. </span><br><span class="line">If so, please start a new session to the Metadata Storage R&#x2F;W instance.</span><br><span class="line"></span><br><span class="line">WARNING: On instance &#39;dax-mysql-master:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">WARNING: On instance &#39;dax-mysql-slave:3306&#39; configuration cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please set the &#39;group_replication_start_on_boot&#39; variable to &#39;OFF&#39; in the server configuration file, otherwise it might rejoin the cluster upon restart.</span><br><span class="line">The instance &#39;dax-mysql-slave:3306&#39; was successfully removed from the cluster.</span><br><span class="line"></span><br><span class="line">WARNING: The &#39;group_replication_start_on_boot&#39; variable must be set to &#39;OFF&#39; in the server configuration file, otherwise it might silently rejoin the cluster upon restart.</span><br></pre></td></tr></table></figure>
<p>重新扫描集群信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.rescan();</span><br><span class="line">Rescanning the cluster...</span><br><span class="line"></span><br><span class="line">Result of the rescanning operation:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;newlyDiscoveredInstances&quot;: [], </span><br><span class="line">        &quot;unavailableInstances&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看集群信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3、从节点修改server-id，并重启库，之后将从节点加入集群："><a href="#3、从节点修改server-id，并重启库，之后将从节点加入集群：" class="headerlink" title="3、从节点修改server-id，并重启库，之后将从节点加入集群："></a>3、从节点修改server-id，并重启库，之后将从节点加入集群：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql-shell &gt; cluster.addInstance(&#39;dax-mysql-slave:3306&#39;)</span><br><span class="line">A new instance will be added to the InnoDB cluster. Depending on the amount of</span><br><span class="line">data on the cluster this might take from a few seconds to several hours.</span><br><span class="line"></span><br><span class="line">Please provide the password for &#39;root@dax-mysql-slave:3306&#39;: ********</span><br><span class="line">Adding instance to the cluster ...</span><br><span class="line"></span><br><span class="line">Validating instance at dax-mysql-slave:3306...</span><br><span class="line"></span><br><span class="line">This instance reports its own address as dax-mysql-slave</span><br><span class="line">WARNING: The following tables do not have a Primary Key or equivalent column: </span><br><span class="line">aaaa.test</span><br><span class="line"></span><br><span class="line">Group Replication requires tables to use InnoDB and have a PRIMARY KEY or PRIMARY KEY Equivalent (non-null unique key). Tables that do not follow these requirements will be readable but not updateable when used with Group Replication. If your applications make updates (INSERT, UPDATE or DELETE) to these tables, ensure they use the InnoDB storage engine and have a PRIMARY KEY or PRIMARY KEY Equivalent.</span><br><span class="line"></span><br><span class="line">Instance configuration is suitable.</span><br><span class="line">WARNING: On instance &#39;dax-mysql-slave:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">WARNING: On instance &#39;dax-mysql-master:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">The instance &#39;root@dax-mysql-slave:3306&#39; was successfully added to the cluster.</span><br></pre></td></tr></table></figure>
<p>查看集群信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status();</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他节点修改方法如上。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/09/mysql-mgr（双节点依次修改server-id)/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/07/oracle本地表空间在uniform、system等不同模式下分配extent方式/"><span>[Oracle] oracle本地表空间在uniform、system等不同模式下分配extent方式</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/07/oracle本地表空间在uniform、system等不同模式下分配extent方式/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-07T10:51:00.000Z">
          2018-11-07
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、表空间和表都使用oracle默认参数"><a href="#1、表空间和表都使用oracle默认参数" class="headerlink" title="1、表空间和表都使用oracle默认参数"></a>1、表空间和表都使用oracle默认参数</h4><p>查看scott用户默认表空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select username,default_tablespace from dba_users where username&#x3D;&#39;SCOTT&#39;;</span><br><span class="line">USERNAME		       DEFAULT_TABLESPACE</span><br><span class="line">------------------------------ ------------------------------</span><br><span class="line">SCOTT			       USERS</span><br></pre></td></tr></table></figure>
<p>查看users表空间初始化extent大小：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select TABLESPACE_NAME,BLOCK_SIZE,INITIAL_EXTENT,NEXT_EXTENT,MIN_EXTENTS,MAX_EXTENTS,EXTENT_MANAGEMENT,ALLOCATION_TYPE from user_tablespaces where tablespace_name&#x3D;&#39;USERS&#39;;</span><br><span class="line"></span><br><span class="line">TABLESPACE_NAME 	       BLOCK_SIZE INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS EXTENT_MAN ALLOCATIO</span><br><span class="line">------------------------------ ---------- -------------- ----------- ----------- ----------- ---------- ---------</span><br><span class="line">USERS				     8192	   65536		       1  2147483645 LOCAL	SYSTEM</span><br></pre></td></tr></table></figure>
<p>查看当前数据库块大小：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show parameter db_block_size;</span><br><span class="line"></span><br><span class="line">NAME				     TYPE	 VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">db_block_size			     integer	 8192</span><br></pre></td></tr></table></figure>

<p>创建测试表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">11:43:49 SCOTT@ boston&gt;  create table t1 as select * from emp where 0&#x3D;1;</span><br><span class="line">Table created.</span><br><span class="line">表数据为空，查看是否有extent区在：</span><br><span class="line">11:43:54 SYS@ boston&gt;  select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">no rows selected</span><br></pre></td></tr></table></figure>
<p>向t1表内插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">11:43:50 SCOTT@ boston&gt;  insert into t1  select * from emp;</span><br><span class="line">14 rows created.</span><br></pre></td></tr></table></figure>
<p>查看已分配出一个8个block的extent：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">11:43:55 SYS@ boston&gt;  select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      4        176	    8</span><br><span class="line">Elapsed: 00:00:00.50</span><br></pre></td></tr></table></figure>
<p>因数据量太小，只分配了一个区，需插入大量数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">12:00:40 SCOTT@ boston&gt;  insert into t1  select * from t1;</span><br><span class="line">42 rows created.</span><br><span class="line">...</span><br><span class="line">12:00:57 SCOTT@ boston&gt; &#x2F;</span><br><span class="line">2688 rows created.</span><br><span class="line">Elapsed: 00:00:00.02</span><br></pre></td></tr></table></figure>
<p>再次查看extent，当分配16个extent之后，数据量达到了16<em>8</em>8/1024=1M，当达到1m之后，在分配下一个extent会直接分配128个块，大小分为128*8/1024=1M：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">12:01:01 SYS@ boston&gt;  select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      4        176	    8</span><br><span class="line">...</span><br><span class="line">T1											  15	      4        296	    8</span><br><span class="line">T1											  16	      4        384	  128</span><br></pre></td></tr></table></figure>
<p>再次插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">12:28:36 SCOTT@ boston&gt; &#x2F;</span><br><span class="line">5376 rows created.</span><br><span class="line">Elapsed: 00:00:00.02</span><br><span class="line">....</span><br><span class="line">12:30:11 SCOTT@ boston&gt; &#x2F;</span><br><span class="line">688128 rows created.</span><br></pre></td></tr></table></figure>
<p>查看extent情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">12:30:14 SYS@ boston&gt;select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      4        176	    8</span><br><span class="line">....</span><br><span class="line">T1											  15	      4        296	    8</span><br><span class="line">T1											  16	      4        384	  128</span><br><span class="line">...</span><br><span class="line">T1											  78	      4       8320	  128</span><br><span class="line">T1											  79	      4       8448	 1024</span><br><span class="line">80 rows selected.</span><br></pre></td></tr></table></figure>
<p>当表数据量达到64M的时候，再次分配下一个extent会直接分配1024个block，大小为64M。</p>
<p>手动对表t1分配extent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">13:35:52 SCOTT@ boston&gt; alter table t1 allocate extent;</span><br><span class="line">Table altered.</span><br><span class="line">Elapsed: 00:00:00.49</span><br><span class="line">14:18:45 SCOTT@ boston&gt; &#x2F;</span><br><span class="line">Table altered.</span><br><span class="line">Elapsed: 00:00:00.07</span><br><span class="line">14:19:28 SCOTT@ boston&gt; &#x2F;</span><br><span class="line">Table altered.</span><br><span class="line">Elapsed: 00:00:00.06</span><br></pre></td></tr></table></figure>
<p>查看extent情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">14:19:06 SYS@ boston&gt; select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      4        176	    8</span><br><span class="line">...</span><br><span class="line">T1											  15	      4        296	    8</span><br><span class="line">T1											  16	      4        384	  128</span><br><span class="line">...</span><br><span class="line">T1											  78	      4       8320	  128</span><br><span class="line">T1											  79	      4       8448	 1024</span><br><span class="line">T1											  80	      4       9472	  128</span><br><span class="line">T1											  81	      4       9600	  128</span><br><span class="line">T1											  82	      4       9728	  128</span><br><span class="line">83 rows selected.</span><br><span class="line">Elapsed: 00:00:00.45</span><br></pre></td></tr></table></figure>
<p>使用alter table ** allocate extent手动分配的区大小为1M。</p>
<p>再次对表插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">14:19:30 SCOTT@ boston&gt;  insert into t1  select * from t1;</span><br><span class="line">1376256 rows created.</span><br><span class="line">Elapsed: 00:00:12.03</span><br></pre></td></tr></table></figure>
<p>查看extent情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">14:20:34 SYS@ boston&gt; select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      4        176	    8</span><br><span class="line">...</span><br><span class="line">T1											  15	      4        296	    8</span><br><span class="line">T1											  16	      4        384	  128</span><br><span class="line">...</span><br><span class="line">T1											  78	      4       8320	  128</span><br><span class="line">T1											  79	      4       8448	 1024</span><br><span class="line">T1											  80	      4       9472	  128</span><br><span class="line">T1											  81	      4       9600	  128</span><br><span class="line">T1											  82	      4       9728	  128</span><br><span class="line">T1											  83	      4       9856	 1024</span><br><span class="line">...</span><br><span class="line">T1											  88	      4      14976	 1024</span><br><span class="line">89 rows selected.</span><br></pre></td></tr></table></figure>
<p>插入数据分配的extent大小均为64M。</p>
<h4 id="2、表空间空间使用默认参数，表参数自定义（INITIAL参数小于65536）："><a href="#2、表空间空间使用默认参数，表参数自定义（INITIAL参数小于65536）：" class="headerlink" title="2、表空间空间使用默认参数，表参数自定义（INITIAL参数小于65536）："></a>2、表空间空间使用默认参数，表参数自定义（INITIAL参数小于65536）：</h4><p>创建测试表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table t2 as select * from emp where 0&#x3D;1;</span><br><span class="line">Table created.</span><br><span class="line"></span><br><span class="line">ALTER TABLE t2 MOVE STORAGE ( INITIAL 20k NEXT 40k) TABLESPACE users;</span><br><span class="line">Table altered.</span><br><span class="line">Elapsed: 00:00:00.23</span><br></pre></td></tr></table></figure>
<p>查看表参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT initial_extent, next_extent,  min_extents, max_extents, pct_increase, blocks, sample_size FROM   user_tables WHERE  table_name &#x3D; &#39;T2&#39;;</span><br><span class="line">INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS PCT_INCREASE     BLOCKS SAMPLE_SIZE</span><br><span class="line">-------------- ----------- ----------- ----------- ------------ ---------- -----------</span><br><span class="line">	 24576	     40960</span><br></pre></td></tr></table></figure>
<p>表数据为空，查看是否有extent区在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T2&#39;;</span><br><span class="line">no rows selected</span><br></pre></td></tr></table></figure>
<p>向表空插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t2 select * from emp;</span><br><span class="line">insert into t2 select * from t2;</span><br></pre></td></tr></table></figure>
<p>查看extent情况:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T2&#39;;</span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T2											   0	      4        168	    8</span><br></pre></td></tr></table></figure>
<p>分配出来的extent最少8个块。<br>多次插入数据查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T2&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T2											   0	      4        168	    8</span><br><span class="line">...</span><br><span class="line">T2											  15	      4      17184	    8</span><br><span class="line">T2											  16	      4      17280	  128</span><br><span class="line">...</span><br><span class="line">T2											  78	      4       7936	  128</span><br><span class="line">T2											  79	      4       8064	 1024</span><br><span class="line">T2											  80	      4       9088	 1024</span><br><span class="line">T2											  81	      4      10112	 1024</span><br><span class="line">T2											  82	      4      11136	 1024</span><br></pre></td></tr></table></figure>
<p>extent分配增长情况为（64k-1m-64m-…)。</p>
<h4 id="3、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next小于64k）："><a href="#3、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next小于64k）：" class="headerlink" title="3、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next小于64k）："></a>3、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next小于64k）：</h4><p>创建测试表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> create table t3 as select * from emp where 0&#x3D;1;</span><br><span class="line">Table created.</span><br><span class="line"></span><br><span class="line">ALTER TABLE t3 MOVE STORAGE ( INITIAL 100k NEXT 40k) TABLESPACE users;</span><br><span class="line">Table altered.</span><br><span class="line">Elapsed: 00:00:00.23</span><br></pre></td></tr></table></figure>
<p>查看表参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT initial_extent, next_extent,  min_extents, max_extents, pct_increase, blocks, sample_size FROM   user_tables WHERE  table_name &#x3D; &#39;T3&#39;;</span><br><span class="line"></span><br><span class="line">INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS PCT_INCREASE     BLOCKS SAMPLE_SIZE</span><br><span class="line">-------------- ----------- ----------- ----------- ------------ ---------- -----------</span><br><span class="line">	106496	     40960</span><br></pre></td></tr></table></figure>
<p>表数据为空，查看是否有extent区在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T3&#39;;</span><br><span class="line">no rows selected</span><br></pre></td></tr></table></figure>
<p>向表空插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t3 select * from emp;</span><br></pre></td></tr></table></figure>
<p>一次分配出来两个extent，每个extent8个block：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T3&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T3											   0	      4        176	    8</span><br><span class="line">T3											   1	      4        184	    8</span><br></pre></td></tr></table></figure>
<p>再次插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t3 select * from t3;</span><br></pre></td></tr></table></figure>
<p>不要插入太多数据，查看下一次分配的extent为1个，占8个块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T3&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T3											   0	      4        208	    8</span><br><span class="line">T3											   1	      4        216	    8</span><br><span class="line">T3											   2	      4        224	    8</span><br></pre></td></tr></table></figure>
<p>再次插入数据，extent增长情况（64k-1m-64m）</p>
<h4 id="4、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next大于64k）："><a href="#4、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next大于64k）：" class="headerlink" title="4、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next大于64k）："></a>4、表空间空间使用默认参数，表参数自定义（INITIAL参数大于64k，next大于64k）：</h4><p>创建测试表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> create table t4 as select * from emp where 0&#x3D;1;</span><br><span class="line">Table created.</span><br><span class="line"></span><br><span class="line">ALTER TABLE t4 MOVE STORAGE ( INITIAL 100k NEXT 140k) TABLESPACE users;</span><br><span class="line">Table altered.</span><br><span class="line">Elapsed: 00:00:00.23</span><br></pre></td></tr></table></figure>
<p>查看表参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">14:31:43 SCOTT@ boston&gt; SELECT initial_extent, next_extent,  min_extents, max_extents, pct_increase, blocks, sample_size FROM   user_tables WHERE  table_name &#x3D; &#39;T4&#39;;</span><br><span class="line"></span><br><span class="line">INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS PCT_INCREASE     BLOCKS SAMPLE_SIZE</span><br><span class="line">-------------- ----------- ----------- ----------- ------------ ---------- -----------</span><br><span class="line">	106496	    147456</span><br></pre></td></tr></table></figure>
<p>表数据为空，查看是否有extent区在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T4&#39;;</span><br><span class="line">no rows selected</span><br></pre></td></tr></table></figure>
<p>向表空插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t4 select * from emp;</span><br></pre></td></tr></table></figure>
<p>一次分配出来两个extent，每个extent8个block：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T4&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T4											   0	      4        176	    8</span><br><span class="line">T4											   1	      4        184	    8</span><br></pre></td></tr></table></figure>
<p>再次插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t4 select * from t4;</span><br></pre></td></tr></table></figure>
<p>不要插入太多数据，查看下一次分配的extent为1个，占8个块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T4&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T4											   0	      4        176	    8</span><br><span class="line">T4											   1	      4        184	    8</span><br><span class="line">T4											   2	      4        192	    8</span><br></pre></td></tr></table></figure>
<p>再次插入数据，extent增长情况（64k-1m-64m）</p>
<h4 id="5、创建表空间使用并设置extent大小，统一为2m："><a href="#5、创建表空间使用并设置extent大小，统一为2m：" class="headerlink" title="5、创建表空间使用并设置extent大小，统一为2m："></a>5、创建表空间使用并设置extent大小，统一为2m：</h4><p>创建测试表空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create tablespace test datafile &#39;&#x2F;data&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;boston&#x2F;test01.dbf&#39; size 100M extent management local uniform size 2m;</span><br></pre></td></tr></table></figure>
<p>查看表空间参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">15:28:39 SYS@ boston&gt; select TABLESPACE_NAME,BLOCK_SIZE,INITIAL_EXTENT,NEXT_EXTENT,MIN_EXTENTS,MAX_EXTENTS,EXTENT_MANAGEMENT,ALLOCATION_TYPE from user_tablespaces where tablespace_name&#x3D;&#39;TEST&#39;;</span><br><span class="line"></span><br><span class="line">TABLESPACE_NAME 	       BLOCK_SIZE INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS EXTENT_MAN ALLOCATIO</span><br><span class="line">------------------------------ ---------- -------------- ----------- ----------- ----------- ---------- ---------</span><br><span class="line">TEST				     8192	 2097152     2097152	       1  2147483645 LOCAL	UNIFORM</span><br></pre></td></tr></table></figure>

<h5 id="6、表空间使用上面创建的test表空间，表参数默认："><a href="#6、表空间使用上面创建的test表空间，表参数默认：" class="headerlink" title="6、表空间使用上面创建的test表空间，表参数默认："></a>6、表空间使用上面创建的test表空间，表参数默认：</h5><p>创建测试表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop table t1;</span><br><span class="line">create table t1 as select * from emp where 0&#x3D;1;</span><br><span class="line">alter table t1 move tablespace test;</span><br></pre></td></tr></table></figure>
<p>查看表t1参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT initial_extent,next_extent,min_extents,max_extents,pct_increase,blocks,sample_size FROM user_tables WHERE  table_name &#x3D; &#39;T1&#39;;</span><br><span class="line"></span><br><span class="line">INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS PCT_INCREASE     BLOCKS SAMPLE_SIZE</span><br><span class="line">-------------- ----------- ----------- ----------- ------------ ---------- -----------</span><br><span class="line">       2097152	   2097152	     1	2147483645	      0</span><br></pre></td></tr></table></figure>
<p>表数据为空，查看是否有extent区在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">15:32:51 SYS@ boston&gt; select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">no rows selected</span><br><span class="line">Elapsed: 00:00:00.04</span><br></pre></td></tr></table></figure>
<p>插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">15:33:16 SCOTT@ boston&gt; insert into t1  select * from emp;</span><br><span class="line">14 rows created.</span><br></pre></td></tr></table></figure>
<p>为t1表分配了一个2m大小的extent：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">15:32:54 SYS@ boston&gt; select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      5        128	  256</span><br></pre></td></tr></table></figure>
<p>批量插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">15:48:07 SYS@ boston&gt; select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T1&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T1											   0	      5        128	  256</span><br><span class="line">...</span><br><span class="line">T1											  80	      5      20608	  256</span><br><span class="line">81 rows selected.</span><br></pre></td></tr></table></figure>
<p>不管插入多少数据，因为设置了统一大小为2m，一个extent永远都是256个块。</p>
<h5 id="7、表空间使用上面创建的test表空间，表参数自定义："><a href="#7、表空间使用上面创建的test表空间，表参数自定义：" class="headerlink" title="7、表空间使用上面创建的test表空间，表参数自定义："></a>7、表空间使用上面创建的test表空间，表参数自定义：</h5><p>创建测试表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop table t2;</span><br><span class="line">create table t2 as select * from emp where 0&#x3D;1;</span><br><span class="line">ALTER TABLE t2 MOVE STORAGE ( INITIAL 5m NEXT 5m) TABLESPACE test;</span><br></pre></td></tr></table></figure>
<p>查看表t2参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT initial_extent,next_extent,min_extents,max_extents,pct_increase,blocks,sample_size FROM user_tables WHERE  table_name &#x3D; &#39;T2&#39;;</span><br><span class="line"></span><br><span class="line">INITIAL_EXTENT NEXT_EXTENT MIN_EXTENTS MAX_EXTENTS PCT_INCREASE     BLOCKS SAMPLE_SIZE</span><br><span class="line">-------------- ----------- ----------- ----------- ------------ ---------- -----------</span><br><span class="line">       5242880	   5242880</span><br></pre></td></tr></table></figure>
<p>表数据为空，查看是否有extent区在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T2&#39;;</span><br><span class="line">no rows selected</span><br><span class="line">Elapsed: 00:00:00.11</span><br></pre></td></tr></table></figure>
<p>插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t2 select * from emp;</span><br></pre></td></tr></table></figure>
<p>因为初始化设置为5m，而每个extent大小统一为2m，因此分配出三个extent：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T2&#39;;</span><br><span class="line"></span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T2											   0	      5       1920	  256</span><br><span class="line">T2											   1	      5       2176	  256</span><br><span class="line">T2											   2	      5       2432	  256</span><br></pre></td></tr></table></figure>
<p>再次插入数据，一次性不要插入太多：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into t2 select * from t2;</span><br><span class="line">...</span><br><span class="line">insert into t2 (select * from t2 where rownum &lt; 10000);</span><br></pre></td></tr></table></figure>
<p>当前三个extent用满之后再次分配extent时，分配1个extent，大小为2m。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select SEGMENT_NAME,EXTENT_ID,FILE_ID,BLOCK_ID,BLOCKS from dba_extents where OWNER&#x3D;&#39;SCOTT&#39; AND SEGMENT_NAME&#x3D;&#39;T2&#39;;</span><br><span class="line">SEGMENT_NAME									   EXTENT_ID	FILE_ID   BLOCK_ID     BLOCKS</span><br><span class="line">--------------------------------------------------------------------------------- ---------- ---------- ---------- ----------</span><br><span class="line">T2											   0	      5        640	  256</span><br><span class="line">T2											   1	      5        896	  256</span><br><span class="line">T2											   2	      5       1152	  256</span><br><span class="line">T2											   3	      5       1408	  256</span><br></pre></td></tr></table></figure>

<h4 id="8、测试总结"><a href="#8、测试总结" class="headerlink" title="8、测试总结"></a>8、测试总结</h4><p>在本地管理表空间的模式下，oracle分配extent，会根据initial指定的参数分配（按相应的倍数），但是next指定的值会被忽略。官方文档如下所示：<br><img src="https://i.imgur.com/ZsQ7zP1.png" alt=""><br><img src="https://i.imgur.com/hcElxSO.png" alt=""></p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/oracle/">oracle</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/07/oracle本地表空间在uniform、system等不同模式下分配extent方式/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/06/centos安装vsftp/"><span>[Linux] centos安装vsftp</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/06/centos安装vsftp/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-06T14:49:30.000Z">
          2018-11-06
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、检查vsftp是否安装，如果没有yum安装vsftp："><a href="#1、检查vsftp是否安装，如果没有yum安装vsftp：" class="headerlink" title="1、检查vsftp是否安装，如果没有yum安装vsftp："></a>1、检查vsftp是否安装，如果没有yum安装vsftp：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa| grep vsftpd</span><br><span class="line">yum install vsftpd -y</span><br></pre></td></tr></table></figure>

<h4 id="2、创建用户："><a href="#2、创建用户：" class="headerlink" title="2、创建用户："></a>2、创建用户：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adduser -s &#x2F;sbin&#x2F;nologin -d &#x2F;var&#x2F;ftp&#x2F;ftp1 ftp1 </span><br><span class="line">修改用户名：</span><br><span class="line">passwd ftp1</span><br></pre></td></tr></table></figure>
<h4 id="3、修改配置文件："><a href="#3、修改配置文件：" class="headerlink" title="3、修改配置文件："></a>3、修改配置文件：</h4><p>cat /etc/vsftpd/vsftpd.conf |grep -v ‘^#’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#禁止匿名用户登录</span><br><span class="line">anonymous_enable&#x3D;NO</span><br><span class="line">local_enable&#x3D;YES</span><br><span class="line">write_enable&#x3D;YES</span><br><span class="line">local_umask&#x3D;022</span><br><span class="line">dirmessage_enable&#x3D;YES</span><br><span class="line">xferlog_enable&#x3D;YES</span><br><span class="line">connect_from_port_20&#x3D;YES</span><br><span class="line">xferlog_std_format&#x3D;YES</span><br><span class="line">#不允许chroot_list下的用户访问其他目录：</span><br><span class="line">chroot_list_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;chroot_list</span><br><span class="line">chroot_local_user&#x3D;YES</span><br><span class="line">chroot_list_enable&#x3D;NO</span><br><span class="line">listen&#x3D;NO</span><br><span class="line">listen_ipv6&#x3D;YES</span><br><span class="line"></span><br><span class="line">pam_service_name&#x3D;vsftpd</span><br><span class="line">#只允许vsftpd.user_list文件下的用户登录：</span><br><span class="line">userlist_enable&#x3D;YES</span><br><span class="line">userlist_deny&#x3D;NO</span><br><span class="line">userlist_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.user_list</span><br><span class="line">tcp_wrappers&#x3D;YES</span><br><span class="line">allow_writeable_chroot&#x3D;YES</span><br></pre></td></tr></table></figure>

<h4 id="4、添加访问用户："><a href="#4、添加访问用户：" class="headerlink" title="4、添加访问用户："></a>4、添加访问用户：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.user_list</span><br><span class="line">ftp1</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;vsftpd&#x2F;chroot_list</span><br><span class="line">ftp1</span><br></pre></td></tr></table></figure>
<h4 id="5、启动，查看ftp服务状态"><a href="#5、启动，查看ftp服务状态" class="headerlink" title="5、启动，查看ftp服务状态"></a>5、启动，查看ftp服务状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service vsftpd status</span><br><span class="line">service vsftpd start</span><br><span class="line">service vsftpd stop</span><br><span class="line">service vsftpd restart</span><br></pre></td></tr></table></figure>
<h4 id="6、客户端安装ftp："><a href="#6、客户端安装ftp：" class="headerlink" title="6、客户端安装ftp："></a>6、客户端安装ftp：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ftp</span><br></pre></td></tr></table></figure>
<p>连接到ftp-server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; ftp *.*.*.*</span><br></pre></td></tr></table></figure>

<h4 id="7、配置过程遇到的问题："><a href="#7、配置过程遇到的问题：" class="headerlink" title="7、配置过程遇到的问题："></a>7、配置过程遇到的问题：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">500 OOPS: vsftpd: refusing to run with writable root inside chroot ()</span><br><span class="line">查看配置文件该行参数是否配置：</span><br><span class="line">allow_writeable_chroot&#x3D;YES</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">500 OOPS: chroot</span><br><span class="line">Login failed.</span><br><span class="line">421 Service not available, remote server has closed connection</span><br><span class="line">检查selinux是否为enforcing状态，并修改：</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ftp vsftpd 530 login incorrect</span><br><span class="line">解决方法：</span><br><span class="line">1.检查密码是否正常。</span><br><span class="line">2.检查&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf配置：</span><br><span class="line">pam_service_name&#x3D;vsftpd</span><br><span class="line">userlist_enable&#x3D;YES</span><br><span class="line">userlist_deny&#x3D;NO</span><br><span class="line">userlist_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.user_list</span><br><span class="line">3.检查&#x2F;etc&#x2F;pam.d&#x2F;vsftpd配置：</span><br><span class="line">#%PAM-1.0</span><br><span class="line">session    optional     pam_keyinit.so    force revoke</span><br><span class="line">auth       required	pam_listfile.so item&#x3D;user sense&#x3D;deny file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;ftpusers onerr&#x3D;succeed</span><br><span class="line">auth       required	pam_shells.so</span><br><span class="line">auth       include	password-auth</span><br><span class="line">account    include	password-auth</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">session    include	password-auth</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/linux/">linux</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/06/centos安装vsftp/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/06/mysql意外drop表之后，使用innobackupex恢复/"><span>[Mysql] mysql意外drop表之后，使用innobackupex恢复</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/06/mysql意外drop表之后，使用innobackupex恢复/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-06T14:28:00.000Z">
          2018-11-06
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="1、使用innodbackupex备份测试删除表："><a href="#1、使用innodbackupex备份测试删除表：" class="headerlink" title="1、使用innodbackupex备份测试删除表："></a>1、使用innodbackupex备份测试删除表：</h4><p>innobackupex备份某以一张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;innobackupex --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --databases&#x3D;&quot;aaaa.test_order&quot; --user&#x3D;root --password&#x3D;12345678 --port&#x3D;3306 &#x2F;tmp</span><br></pre></td></tr></table></figure>
<p>如果要备份多个表，使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;innobackupex --defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf --databases&#x3D;&quot;aaaa.test_order aaaa.test1&quot; --user&#x3D;root --password&#x3D;12345678 --port&#x3D;3306 &#x2F;tmp</span><br></pre></td></tr></table></figure>
<p>使用innobackupex备份出来的的数据在aaaa文件下面会存在table_name.frm和table_name.ibd两个文件。</p>
<h4 id="2、如果知道表结构重新建表即可，如果表结构也无法获得，可通过该链接，对表结构进行恢复"><a href="#2、如果知道表结构重新建表即可，如果表结构也无法获得，可通过该链接，对表结构进行恢复" class="headerlink" title="2、如果知道表结构重新建表即可，如果表结构也无法获得，可通过该链接，对表结构进行恢复"></a>2、如果知道表结构重新建表即可，如果表结构也无法获得，可通过该<a href="https://zeven0707.github.io/2018/11/01/mysql%E4%BD%BF%E7%94%A8%E5%A4%87%E4%BB%BD%E7%9A%84.frm%E6%96%87%E4%BB%B6%E6%81%A2%E5%A4%8D%E8%A1%A8%E7%BB%93%E6%9E%84/" target="_blank" rel="noopener">链接</a>，对表结构进行恢复</h4><h4 id="3、恢复完表结构之后，开始恢复数据，丢弃表空间："><a href="#3、恢复完表结构之后，开始恢复数据，丢弃表空间：" class="headerlink" title="3、恢复完表结构之后，开始恢复数据，丢弃表空间："></a>3、恢复完表结构之后，开始恢复数据，丢弃表空间：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#为防止新的数据写入，对表加锁：</span><br><span class="line">root@db 16:20:  [aaaa]&gt; lock tables tb1 write;</span><br><span class="line"></span><br><span class="line">root@db 16:20:  [aaaa]&gt; alter table test_order discard tablespace; </span><br><span class="line">Query OK, 0 rows affected (0.54 sec)</span><br></pre></td></tr></table></figure>
<p>将对应的ibd文件拷入对应的数据目录,修改数据文件权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell &gt; cp test_order.ibd &#x2F;data&#x2F;mysql&#x2F;data&#x2F;aaaa&#x2F;</span><br><span class="line">shell &gt; chown mysql.mysql test_order.ibd</span><br></pre></td></tr></table></figure>
<p>载入表空间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@db 16:24:  [aaaa]&gt; alter table test_order import tablespace;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (1 min 53.51 sec)</span><br></pre></td></tr></table></figure>
<p>查看有无报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show warnings;</span><br></pre></td></tr></table></figure>
<h4 id="4、对备份之后的数据进行恢复，查看备份开始的时间点"><a href="#4、对备份之后的数据进行恢复，查看备份开始的时间点" class="headerlink" title="4、对备份之后的数据进行恢复，查看备份开始的时间点"></a>4、对备份之后的数据进行恢复，查看备份开始的时间点</h4><p>cat xtrabackup_binlog_info </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-binlog.000489	748512183</span><br></pre></td></tr></table></figure>
<p>然后查找drop的pos点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog  -v --base64-output&#x3D;DECODE-ROWS &#x2F;data&#x2F;mysql&#x2F;log&#x2F;mysql-binlog.000489 | grep -C 10 -i  &quot;DROP&quot;</span><br></pre></td></tr></table></figure>
<p>找到删除的pos点，如果不在该log文件下，需要根据（show master status)的位置向前依次筛选,找到drop表的记录，内容如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server id 1  end_log_pos 748512209 CRC32 0x3fa6b448   Query   thread_id&#x3D;27    </span><br><span class="line">DROP TABLE &#96;test_order&#96; &#x2F;* generated by server *&#x2F;</span><br><span class="line">&#x2F;*!*&#x2F;;</span><br></pre></td></tr></table></figure>
<p>找到表删除的pos点（748512209），利用binlog2sql生成中间发生sql语句，（binlog2sql方法详解<a href="https://github.com/danfengcao/binlog2sql">此处</a>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python binlog2sql.py  -uroot -p12345678 -daaaa -ttest_order --start-position&#x3D;748512183 --stop-position&#x3D;748512209 --start-file&#x3D;&#39;mysql-binlog.000489&#39;  &gt; &#x2F;tmp&#x2F;re_aaaa_test_order.sql</span><br></pre></td></tr></table></figure>
<p>生成的sql内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@dax-mysql-master binlog2sql]# cat &#x2F;tmp&#x2F;re_aaaa_test_order.sql</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (12); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (11); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (10); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (9); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (8); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (7); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (6); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (5); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (4); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (2); #start 2804 end 2949 time 2018-11-06 18:45:45</span><br><span class="line">DELETE FROM &#96;aaaa&#96;.&#96;test_order&#96; WHERE &#96;id&#96;&#x3D;12 LIMIT 1; #start 2571 end 2716 time 2018-11-06 18:45:39</span><br><span class="line">DELETE FROM &#96;aaaa&#96;.&#96;test_order&#96; WHERE &#96;id&#96;&#x3D;11 LIMIT 1; #start 2338 end 2483 time 2018-11-06 18:45:33</span><br></pre></td></tr></table></figure>
<p>生成的sql顺序是倒序的，需要重新调整（github上关于binlog2sql的用法未有关于顺序的说明）：<br>sed -i ‘1!G;h;$!d’ /tmp/re_aaaa_test_order.sql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master binlog2sql]#  sed -i &#39;1!G;h;$!d&#39; &#x2F;tmp&#x2F;re_aaaa_test_order.sql</span><br><span class="line">[root@dax-mysql-master binlog2sql]# cat &#x2F;tmp&#x2F;re_aaaa_test_order.sql</span><br><span class="line">DELETE FROM &#96;aaaa&#96;.&#96;test_order&#96; WHERE &#96;id&#96;&#x3D;11 LIMIT 1; #start 2338 end 2483 time 2018-11-06 18:45:33</span><br><span class="line">DELETE FROM &#96;aaaa&#96;.&#96;test_order&#96; WHERE &#96;id&#96;&#x3D;12 LIMIT 1; #start 2571 end 2716 time 2018-11-06 18:45:39</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (2); #start 2804 end 2949 time 2018-11-06 18:45:45</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (4); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (5); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (6); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (7); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (8); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (9); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (10); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (11); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br><span class="line">INSERT INTO &#96;aaaa&#96;.&#96;test_order&#96;(&#96;id&#96;) VALUES (12); #start 3037 end 3222 time 2018-11-06 18:54:21</span><br></pre></td></tr></table></figure>
<h4 id="5、把这sql文件进入导入即可进行备份后的数据恢复"><a href="#5、把这sql文件进入导入即可进行备份后的数据恢复" class="headerlink" title="5、把这sql文件进入导入即可进行备份后的数据恢复"></a>5、把这sql文件进入导入即可进行备份后的数据恢复</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master binlog2sql]# mysql -u root -p12345678 aaaa &lt; &#x2F;tmp&#x2F;re_aaaa_test_order.sql</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">ERROR 1205 (HY000) at line 1: Lock wait timeout exceeded; try restarting transaction</span><br></pre></td></tr></table></figure>
<p>需要先解锁表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>
<p>解锁完成在重新导入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dax-mysql-master binlog2sql]# mysql -u root -p12345678 aaaa &lt; &#x2F;tmp&#x2F;re_aaaa_test_order.sql</span><br></pre></td></tr></table></figure>
<p>导入成功。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/06/mysql意外drop表之后，使用innobackupex恢复/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/01/mysql-Can't start group replication on secondary member with single primary-mode while asynchronous replication channels are running/"><span>[Mysql] Can&#39;t start group replication on secondary member with single primary-mode while asynchronous replication channels are running</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/01/mysql-Can't start group replication on secondary member with single primary-mode while asynchronous replication channels are running/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-01T10:28:00.000Z">
          2018-11-01
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="0、mysql-mgr双节点集群，节点信息如下："><a href="#0、mysql-mgr双节点集群，节点信息如下：" class="headerlink" title="0、mysql-mgr双节点集群，节点信息如下："></a>0、mysql-mgr双节点集群，节点信息如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select * from performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST      | MEMBER_PORT | MEMBER_STATE |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">| group_replication_applier | bddd9c32-8fee-11e8-ac79-525400edbe8d | dax-mysql-slave  |        3306 | ONLINE       |</span><br><span class="line">| group_replication_applier | d5bd8edd-9a1d-11e8-993e-525400578639 | dax-mysql-master |        3306 | ONLINE       |</span><br><span class="line">+---------------------------+--------------------------------------+------------------+-------------+--------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line">dax-mysql-master为主节点：</span><br><span class="line"> SHOW STATUS LIKE &#39;group_replication_primary_member&#39;;</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">| Variable_name                    | Value                                |</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br><span class="line">| group_replication_primary_member | d5bd8edd-9a1d-11e8-993e-525400578639 |</span><br><span class="line">+----------------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="1、因某种需要需要重启数据库，先后停止从节点group-replication"><a href="#1、因某种需要需要重启数据库，先后停止从节点group-replication" class="headerlink" title="1、因某种需要需要重启数据库，先后停止从节点group_replication;"></a>1、因某种需要需要重启数据库，先后停止从节点group_replication;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop group_replication;</span><br><span class="line">停止数据库：</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;mysql stop</span><br></pre></td></tr></table></figure>
<p>停止主节点group_replication;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stop group_replication;</span><br><span class="line">重启数据库</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;mysql restart</span><br><span class="line">启动组复制：</span><br><span class="line">start group_replication;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 3092 (HY000): The server is not configured properly to be an active member of the group. Please see more details on error log.</span><br></pre></td></tr></table></figure>
<p>error.log日志报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2018-11-01T06:57:09.766303Z 6 [Note] Plugin group_replication reported: &#39;Group communication SSL configuration: group_replication_ssl_mode: &quot;DISABLED&quot;&#39;</span><br><span class="line">2018-11-01T06:57:09.768075Z 6 [Note] Plugin group_replication reported: &#39;[GCS] Added automatically IP ranges 127.0.0.1&#x2F;8,192.168.168.178&#x2F;24 to the whitelist&#39;</span><br><span class="line">2018-11-01T06:57:09.769536Z 6 [Note] Plugin group_replication reported: &#39;[GCS] Translated &#39;dax-mysql-master&#39; to 192.168.168.178&#39;</span><br><span class="line">2018-11-01T06:57:09.770000Z 6 [Warning] Plugin group_replication reported: &#39;[GCS] Automatically adding IPv4 localhost address to the whitelist. It is mandatory that it is added.&#39;</span><br><span class="line">2018-11-01T06:57:09.770200Z 6 [Note] Plugin group_replication reported: &#39;[GCS] SSL was not enabled&#39;</span><br><span class="line">2018-11-01T06:57:09.770253Z 6 [Note] Plugin group_replication reported: &#39;Initialized group communication with configuration: group_replication_group_name: &quot;740442c0-cc67-11e8-993e-525400578639&quot;; group_replication_local_address: &quot;dax-mysql-master:24901&quot;; group_replication_group_seeds: &quot;dax-mysql-master:24901,dax-mysql-slave:24901&quot;; group_replication_bootstrap_group: false; group_replication_poll_spin_loops: 0; group_replication_compression_threshold: 1000000; group_replication_ip_whitelist: &quot;AUTOMATIC&quot;&#39;</span><br><span class="line">2018-11-01T06:57:09.770341Z 6 [Note] Plugin group_replication reported: &#39;[GCS] Configured number of attempts to join: 0&#39;</span><br><span class="line">2018-11-01T06:57:09.770356Z 6 [Note] Plugin group_replication reported: &#39;[GCS] Configured time between attempts to join: 5 seconds&#39;</span><br><span class="line">2018-11-01T06:57:09.770494Z 6 [Note] Plugin group_replication reported: &#39;Member configuration: member_id: 3306103; member_uuid: &quot;d5bd8edd-9a1d-11e8-993e-525400578639&quot;; single-primary mode: &quot;true&quot;; group_replication_auto_increment_increment: 7; &#39;</span><br><span class="line">2018-11-01T06:57:09.770589Z 6 [ERROR] Plugin group_replication reported: &#39;Can&#39;t start group replication on secondary member with single primary-mode while asynchronous replication channels are running.&#39;</span><br><span class="line">2018-11-01T06:57:09.770682Z 6 [Note] Plugin group_replication reported: &#39;Requesting to leave the group despite of not being a member&#39;</span><br><span class="line">2018-11-01T06:57:09.770696Z 6 [ERROR] Plugin group_replication reported: &#39;[GCS] The member is leaving a group without being on one.&#39;</span><br></pre></td></tr></table></figure>

<p>尝试重启dax-mysql-slave节点组复制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> start group_replication;</span><br><span class="line">ERROR 3092 (HY000): The server is not configured properly to be an active member of the group. Please see more details on error log.</span><br></pre></td></tr></table></figure>
<p>error.log日志报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">2018-11-01T06:59:20.617005Z 114 [Note] &#39;CHANGE MASTER TO FOR CHANNEL &#39;group_replication_applier&#39; executed&#39;. Previous state master_host&#x3D;&#39;&lt;NULL&gt;&#39;, master_port&#x3D; 0, master_log_file&#x3D;&#39;&#39;, master_log_pos&#x3D; 128090715, master_bind&#x3D;&#39;&#39;. New state master_host&#x3D;&#39;&lt;NULL&gt;&#39;, master_port&#x3D; 0, master_log_file&#x3D;&#39;&#39;, master_log_pos&#x3D; 4, master_bind&#x3D;&#39;&#39;.</span><br><span class="line">2018-11-01T06:59:21.516164Z 111 [Note] Plugin group_replication reported: &#39;Group Replication applier module successfully initialized!&#39;</span><br><span class="line">2018-11-01T06:59:21.516264Z 117 [Note] Slave SQL thread for channel &#39;group_replication_applier&#39; initialized, starting replication in log &#39;FIRST&#39; at position 0, relay log &#39;.&#x2F;relay-log-group_replication_applier.000002&#39; position: 4</span><br><span class="line">2018-11-01T06:59:21.516277Z 111 [Note] Plugin group_replication reported: &#39;auto_increment_increment is set to 7&#39;</span><br><span class="line">2018-11-01T06:59:21.516298Z 111 [Note] Plugin group_replication reported: &#39;auto_increment_offset is set to 3306102&#39;</span><br><span class="line">2018-11-01T06:59:21.553616Z 0 [Note] Plugin group_replication reported: &#39;XCom protocol version: 3&#39;</span><br><span class="line">2018-11-01T06:59:21.553718Z 0 [Note] Plugin group_replication reported: &#39;XCom initialized and ready to accept incoming connections on port 24901&#39;</span><br><span class="line">2018-11-01T06:59:21.620998Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.621468Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.621794Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.621988Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.622185Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.622379Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.622658Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.622875Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.623043Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.623201Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error on opening a connection to dax-mysql-master:24901 on local port: 24901.&#39;</span><br><span class="line">2018-11-01T06:59:21.623220Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] Error connecting to all peers. Member join failed. Local port: 24901&#39;</span><br><span class="line">2018-11-01T06:59:21.624544Z 0 [Warning] Plugin group_replication reported: &#39;read failed&#39;</span><br><span class="line">2018-11-01T06:59:21.656139Z 0 [ERROR] Plugin group_replication reported: &#39;[GCS] The member was unable to join the group. Local port: 24901&#39;</span><br><span class="line">2018-11-01T07:00:21.516998Z 111 [ERROR] Plugin group_replication reported: &#39;Timeout on wait for view after joining group&#39;</span><br><span class="line">2018-11-01T07:00:21.517630Z 111 [Note] Plugin group_replication reported: &#39;Requesting to leave the group despite of not being a member&#39;</span><br><span class="line">2018-11-01T07:00:21.517820Z 111 [ERROR] Plugin group_replication reported: &#39;[GCS] The member is leaving a group without being on one.&#39;</span><br><span class="line">2018-11-01T07:00:21.519413Z 111 [Note] Plugin group_replication reported: &#39;auto_increment_increment is reset to 1&#39;</span><br><span class="line">2018-11-01T07:00:21.519442Z 111 [Note] Plugin group_replication reported: &#39;auto_increment_offset is reset to 1&#39;</span><br><span class="line">2018-11-01T07:00:21.521022Z 117 [Note] Error reading relay log event for channel &#39;group_replication_applier&#39;: slave SQL thread was killed</span><br><span class="line">2018-11-01T07:00:21.595775Z 114 [Note] Plugin group_replication reported: &#39;The group replication applier thread was killed&#39;</span><br><span class="line">2018-11-01T07:10:22.699429Z 111 [Note] Aborted connection 111 to db: &#39;unconnected&#39; user: &#39;root&#39; host: &#39;localhost&#39; (Got timeout reading communication packets)</span><br></pre></td></tr></table></figure>
<p>使用mysql-shell查看集群信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;data&#x2F;soft&#x2F;mysql-shell&#x2F;bin&#x2F;mysqlsh --uri repl@dax-mysql-master:3306</span><br></pre></td></tr></table></figure>
<p>尝试查看集群信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster &#x3D; dba.getCluster(&quot;prodCluster&quot;)</span><br><span class="line">Dba.getCluster: This function is not available through a session to a standalone instance (metadata exists, but GR is not active) (RuntimeError)</span><br></pre></td></tr></table></figure>
<p>提示集群系统没有激活，尝试重启集群系统：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">dba.rebootClusterFromCompleteOutage(&#39;prodCluster&#39;)</span><br><span class="line">Reconfiguring the cluster &#39;prodCluster&#39; from complete outage...</span><br><span class="line">The instance &#39;dax-mysql-slave:3306&#39; was part of the cluster configuration.</span><br><span class="line">Would you like to rejoin it to the cluster? [y&#x2F;N]: y</span><br><span class="line">WARNING: On instance &#39;dax-mysql-master:3306&#39; membership change cannot be persisted since MySQL version 5.7.22 does not support the SET PERSIST command (MySQL version &gt;&#x3D; 8.0.5 required). Please use the &lt;Dba&gt;.configureLocalInstance command locally to persist the changes.</span><br><span class="line">The cluster was successfully rebooted.</span><br><span class="line">&lt;Cluster:prodCluster&gt;</span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster &#x3D; dba.getCluster(&quot;prodCluster&quot;)</span><br><span class="line">&lt;Cluster:prodCluster&gt;</span><br><span class="line"> MySQL  dax-mysql-master:3306  JS &gt; cluster.status()</span><br><span class="line">&#123;</span><br><span class="line">    &quot;clusterName&quot;: &quot;prodCluster&quot;, </span><br><span class="line">    &quot;defaultReplicaSet&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;, </span><br><span class="line">        &quot;primary&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">        &quot;ssl&quot;: &quot;DISABLED&quot;, </span><br><span class="line">        &quot;status&quot;: &quot;OK_NO_TOLERANCE&quot;, </span><br><span class="line">        &quot;statusText&quot;: &quot;Cluster is NOT tolerant to any failures.&quot;, </span><br><span class="line">        &quot;topology&quot;: &#123;</span><br><span class="line">            &quot;dax-mysql-master:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-master:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;W&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;dax-mysql-slave:3306&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;dax-mysql-slave:3306&quot;, </span><br><span class="line">                &quot;mode&quot;: &quot;R&#x2F;O&quot;, </span><br><span class="line">                &quot;readReplicas&quot;: &#123;&#125;, </span><br><span class="line">                &quot;role&quot;: &quot;HA&quot;, </span><br><span class="line">                &quot;status&quot;: &quot;ONLINE&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;groupInformationSourceMember&quot;: &quot;mysql:&#x2F;&#x2F;repl@dax-mysql-master:3306&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>集群状态恢复正常。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/01/mysql-Can't start group replication on secondary member with single primary-mode while asynchronous replication channels are running/"><span>点击阅读</span></a></h3>
    
  
</article>





  <article class="article-container ">

  
    
    <h3 class="article-title"><a href="/2018/11/01/mysql使用备份的.frm文件恢复表结构/"><span>[Mysql] mysql使用备份的.frm文件恢复表结构</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/11/01/mysql使用备份的.frm文件恢复表结构/" rel="bookmark">
        <time class="entry-date published" datetime="2018-11-01T06:04:00.000Z">
          2018-11-01
        </time>
      </a>
    </span>
    <br />
    
  </div>


  

  <div class="article-content">
    <div class="entry">
      
          <h4 id="0、例如备份的表为test-order-则备份出来的-frm文件为test-order-frm"><a href="#0、例如备份的表为test-order-则备份出来的-frm文件为test-order-frm" class="headerlink" title="0、例如备份的表为test_order,则备份出来的.frm文件为test_order.frm"></a>0、例如备份的表为test_order,则备份出来的.frm文件为test_order.frm</h4><h4 id="1、在只知道表名的情况下，随意创建一个表名为test-order的表："><a href="#1、在只知道表名的情况下，随意创建一个表名为test-order的表：" class="headerlink" title="1、在只知道表名的情况下，随意创建一个表名为test_order的表："></a>1、在只知道表名的情况下，随意创建一个表名为test_order的表：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table test_order (id1 int(2));</span><br></pre></td></tr></table></figure>
<p>替换test_order.frm文件，替换完成之后重启mysql数据库,查看表信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@db 11:29:  [test]&gt; desc test_order;</span><br><span class="line">ERROR 1146 (42S02): Table &#39;test.test_order&#39; doesn&#39;t exist</span><br><span class="line">root@db 11:29:  [test]&gt; show create table test_order;</span><br><span class="line">ERROR 1146 (42S02): Table &#39;test.test_order&#39; doesn&#39;t exist</span><br></pre></td></tr></table></figure>
<p>报错提示表不存在，之后查看error.log：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-11-01T11:29:10.359514Z 2 [Warning] InnoDB: Table test&#x2F;test_order contains 1 user defined columns in InnoDB, but 25 columns in MySQL. Please check INFORMATION_SCHEMA.INNODB_SYS_COLUMNS and http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-11-01T11:29:10.359631Z 2 [Warning] InnoDB: Cannot open table test&#x2F;test_order from the internal data dictionary of InnoDB though the .frm file for the table exists. Please refer to http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;innodb-troubleshooting.html for how to resolve the issue.</span><br><span class="line">2018-11-01T11:29:25.514189Z 2 [Note] InnoDB: Table &#96;test&#96;.&#96;test_order&#96; is corrupted. Please drop the table and recreate it</span><br><span class="line">2018-11-01T11:29:25.514313Z 2 [Warning] InnoDB: Cannot open table test&#x2F;test_order from the internal data dictionary of InnoDB though the .frm file for the table exists. Please refer to http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;innodb-troubleshooting.html for how to resolve the issue.</span><br></pre></td></tr></table></figure>
<p>报错提示手动创建的表只有1列，但是mysql中记录的表有25列</p>
<h4 id="2、删除test-order表，并创建一个25列的test-order表："><a href="#2、删除test-order表，并创建一个25列的test-order表：" class="headerlink" title="2、删除test_order表，并创建一个25列的test_order表："></a>2、删除test_order表，并创建一个25列的test_order表：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@db 11:40:  [test]&gt; drop table test_order;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">root@db 11:40:  [test]&gt; create table test_order (id1 int(2),id2 int(2),id3 int(2),id4 int(2),id5 int(2),id6 int(2),id7 int(2),id8 int(2),id9 int(2),id10 int(2),id11 int(2),id12 int(2),id13 int(2),id14 int(2),id15 int(2),id16 int(2),id17 int(2),id18 int(2),id19 int(2),id20 int(2),id21 int(2),id22 int(2),id23 int(2),id24 int(2),id25  int(2));</span><br></pre></td></tr></table></figure>
<p>替换test_order.frm文件，替换完成之后重启mysql数据库,查看表信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@db 11:41:  [test]&gt; desc test_order;</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">root@db 11:42:  [test]&gt; show create table test_order;</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    2</span><br><span class="line">Current database: test</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br></pre></td></tr></table></figure>
<p>查看error.log：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2018-11-01T11:42:25.566095Z 2 [ERROR] Build InnoDB index translation table for Table .&#x2F;test&#x2F;test_order failed</span><br><span class="line">2018-11-01T11:42:25.566445Z 2 [ERROR] Table .&#x2F;test&#x2F;test_order has no primary key in InnoDB data dictionary, but has one in MySQL! If you created the table with a MySQL version &lt; 3.23.54 and did not define a primary key, but defined a unique key with all non-NULL columns, then MySQL internally treats that key as the primary key. You can fix this error by dump + DROP + CREATE + reimport of the table.</span><br><span class="line">2018-11-01T11:42:25.566519Z 2 [Warning] Table .&#x2F;test&#x2F;test_order key_used_on_scan is 0 even though there is no primary key inside InnoDB.</span><br><span class="line">2018-11-01T11:42:25.566576Z 2 [ERROR] InnoDB could not find key no 0 with name PRIMARY from dict cache for table test&#x2F;test_order</span><br><span class="line">11:42:25 UTC - mysqld got signal 11 ;</span><br><span class="line">This could be because you hit a bug. It is also possible that this binary</span><br><span class="line">or one of the libraries it was linked against is corrupt, improperly built,</span><br><span class="line">or misconfigured. This error can also be caused by malfunctioning hardware.</span><br><span class="line">Attempting to collect some information that could help diagnose the problem.</span><br><span class="line">As this is a crash and something is definitely wrong, the information</span><br><span class="line">collection process might fail.</span><br></pre></td></tr></table></figure>
<p>报错提示test_order表没有主键</p>
<h4 id="3、删除test-order表，并创建一个25列的带有主键的test-order表："><a href="#3、删除test-order表，并创建一个25列的带有主键的test-order表：" class="headerlink" title="3、删除test_order表，并创建一个25列的带有主键的test_order表："></a>3、删除test_order表，并创建一个25列的带有主键的test_order表：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@db 11:45:  [test]&gt; drop table test_order;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">root@db 11:45:  [test]&gt; create table test_order (id1 int(2) primary key,id2 int(2),id3 int(2),id4 int(2),id5 int(2),id6 int(2),id7 int(2),id8 int(2),id9 int(2),id10 int(2),id11 int(2),id12 int(2),id13 int(2),id14 int(2),id15 int(2),id16 int(2),id17 int(2),id18 int(2),id19 int(2),id20 int(2),id21 int(2),id22 int(2),id23 int(2),id24 int(2),id25  int(2));</span><br></pre></td></tr></table></figure>
<p>替换test_order.frm文件，替换完成之后重启mysql数据库,查看表信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">root@db 11:46:  [test]&gt; desc test_order;</span><br><span class="line">+-----------------+----------------+------+-----+---------+----------------+</span><br><span class="line">| Field           | Type           | Null | Key | Default | Extra          |</span><br><span class="line">+-----------------+----------------+------+-----+---------+----------------+</span><br><span class="line">| id              | bigint(20)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| order_no        | varchar(24)    | NO   | UNI | NULL    |                |</span><br><span class="line">| broker_id       | varchar(24)    | NO   | MUL | NULL    |                |</span><br><span class="line">| broker_uid      | bigint(20)     | NO   |     | NULL    |                |</span><br><span class="line">| plat_id         | varchar(24)    | NO   |     | NULL    |                |</span><br><span class="line">| price_asset     | varchar(8)     | NO   |     | NULL    |                |</span><br><span class="line">| test_type      | varchar(16)    | NO   |     | NULL    |                |</span><br><span class="line">| order_type      | varchar(16)    | NO   |     | NULL    |                |</span><br><span class="line">| price           | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| number          | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| test_asset     | varchar(8)     | NO   | MUL | NULL    |                |</span><br><span class="line">| testd_number   | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| over_number     | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| testd_money    | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| fee_asset       | varchar(8)     | NO   |     | NULL    |                |</span><br><span class="line">| fee             | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| broker_fee      | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| cloud_fee       | decimal(32,20) | NO   |     | NULL    |                |</span><br><span class="line">| client_order_no | varchar(36)    | NO   |     | NULL    |                |</span><br><span class="line">| state           | varchar(16)    | NO   |     | NULL    |                |</span><br><span class="line">| send_state      | varchar(16)    | NO   |     | NULL    |                |</span><br><span class="line">| error_code      | varchar(24)    | YES  |     | NULL    |                |</span><br><span class="line">| error_msg       | varchar(64)    | YES  |     | NULL    |                |</span><br><span class="line">| create_time     | datetime       | NO   |     | NULL    |                |</span><br><span class="line">| update_time     | datetime       | NO   |     | NULL    |                |</span><br><span class="line">+-----------------+----------------+------+-----+---------+----------------+</span><br><span class="line">25 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@db 11:46:  [test]&gt; show create table test_order\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test_order</span><br><span class="line">Create Table: CREATE TABLE &#96;test_order&#96; (</span><br><span class="line">  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;order_no&#96; varchar(24) NOT NULL,</span><br><span class="line">  &#96;broker_id&#96; varchar(24) NOT NULL,</span><br><span class="line">  &#96;broker_uid&#96; bigint(20) NOT NULL,</span><br><span class="line">  &#96;plat_id&#96; varchar(24) NOT NULL,</span><br><span class="line">  &#96;price_asset&#96; varchar(8) NOT NULL,</span><br><span class="line">  &#96;test_type&#96; varchar(16) NOT NULL,</span><br><span class="line">  &#96;order_type&#96; varchar(16) NOT NULL,</span><br><span class="line">  &#96;price&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;number&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;test_asset&#96; varchar(8) NOT NULL,</span><br><span class="line">  &#96;testd_number&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;over_number&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;testd_money&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;fee_asset&#96; varchar(8) NOT NULL,</span><br><span class="line">  &#96;fee&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;broker_fee&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;cloud_fee&#96; decimal(32,20) NOT NULL,</span><br><span class="line">  &#96;client_order_no&#96; varchar(36) NOT NULL,</span><br><span class="line">  &#96;state&#96; varchar(16) NOT NULL,</span><br><span class="line">  &#96;send_state&#96; varchar(16) NOT NULL,</span><br><span class="line">  &#96;error_code&#96; varchar(24) DEFAULT NULL,</span><br><span class="line">  &#96;error_msg&#96; varchar(64) DEFAULT NULL,</span><br><span class="line">  &#96;create_time&#96; datetime NOT NULL,</span><br><span class="line">  &#96;update_time&#96; datetime NOT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;test_order_order_no_uindex&#96; (&#96;order_no&#96;),</span><br><span class="line">  UNIQUE KEY &#96;test_order_broker_id_client_order_no_uindex&#96; (&#96;broker_id&#96;,&#96;client_order_no&#96;),</span><br><span class="line">  KEY &#96;multi_price_test_id_uid_state_index&#96; (&#96;test_asset&#96;,&#96;price_asset&#96;,&#96;broker_uid&#96;,&#96;broker_id&#96;,&#96;state&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>查看error.log有无其他报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018-11-01T11:45:09.272752Z 2 [ERROR] Build InnoDB index translation table for Table .&#x2F;test&#x2F;test_order failed</span><br><span class="line">2018-11-01T11:45:09.272904Z 2 [ERROR] InnoDB: MySQL and InnoDB data dictionaries are out of sync. Unable to find the AUTOINC column id in the InnoDB table &#96;test&#96;.&#96;test_order&#96;. We set the next AUTOINC column value to 0, in effect disabling the AUTOINC next value generation.</span><br><span class="line">2018-11-01T11:45:09.272935Z 2 [Note] InnoDB: You can either set the next AUTOINC value explicitly using ALTER TABLE or fix the data dictionary by recreating the table.</span><br><span class="line">2018-11-01T11:45:09.272959Z 2 [ERROR] InnoDB: Table test&#x2F;test_order contains 1 indexes inside InnoDB, which is different from the number of indexes 4 defined in MySQL</span><br><span class="line">2018-11-01T11:45:09.272976Z 2 [ERROR] InnoDB could not find key no 1 with name test_order_order_no_uindex from dict cache for table test&#x2F;test_order</span><br><span class="line">2018-11-01T11:45:09.272988Z 2 [ERROR] Table test&#x2F;test_order contains fewer indexes inside InnoDB than are defined in the MySQL .frm file. Have you mixed up .frm files from different installations? Please refer to http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;innodb-troubleshooting.html for how to resolve the issue.</span><br></pre></td></tr></table></figure>
<p>log日志依旧有报错，提示innodb只有一个索引，但mysql下存在4个索引，但是已经通过show create table test_order获取到了建表的语句，因此可以通过上面的建表语句，重新创建test_order表了。</p>

      
    </div>
    
  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/mysql/">mysql</a>
    </span>
    

    </div>

    
  </div>
  
    
    <h3 class="article-read"><a href="/2018/11/01/mysql使用备份的.frm文件恢复表结构/"><span>点击阅读</span></a></h3>
    
  
</article>






<nav class="pagination">
  
  <a href="/page/9/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/11/" class="pagination-next">下一页</a>
  
</nav>
            </main>
            <div class="sidebar
                    col-lg-3 col-lg-offset-0
                    col-md-3 col-md-offset-0
                    col-sm-12
                    col-xs-12
                    sidebar-container
                ">

                <div class="sidebar-container">



<div class="search-container">
<form class="site-search-form">
    <span class="glyphicon glyphicon-search"></span><input type="text" id="local-search-input" class="st-search-input" placeholder="Search..." />
</form>
<div id="local-search-result" class="local-search-result-cls"></div>
</div>
<script type="text/javascript" id="local.search.active">
var inputArea       = document.querySelector("#local-search-input");
inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script>




    <div class="categories-container" style="margin-top:40px;">
        <p>归档:</p>
            
    </div>




    <div class="social-container" style="margin-top:40px;">
        <p>Links:</p>
            
                
                    <li class="social-item"><i class="fa fa-fw fa-github"></i><a href="https://github.com/zeven0707">GitHub</a></li>
                
            
    </div>

</div>
            </div>
          </div>
        </div>
        
    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/BosenY/Lap" target="_blank">Lap</a>
    <br/><span id="busuanzi_container_site_uv"> 
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    </br>
    
      
        &copy; 2020 zeven0707&#39;s blog
      
    
  </p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92842840-1', 'auto');
    ga('send', 'pageview');

</script>


  </div>

</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/draw-something/dist/draw.min.js"></script>
  <script>
    let maxNum = Number.parseInt('30')
    let iconText = '❤'
    let color = 'red'
    new Draw({maxNum, iconText, color})
  </script>

<script src="/js/index.js"></script>
<script src="/js/search.js"></script>

</body>
</html>